import{_ as n,c as a,e,o as t}from"./app-DtXLoKBz.js";const l="/assets/image-20260203213130479-B91LAXbD.png",p={};function i(c,s){return t(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="es-中文分词器-ik-analyzer-配置指南" tabindex="-1"><a class="header-anchor" href="#es-中文分词器-ik-analyzer-配置指南"><span>ES 中文分词器（IK Analyzer）配置指南</span></a></h1><blockquote><p><strong>问题背景</strong>：默认 ES 对中文处理为单个字符分词，需要安装第三方中文分词插件才能实现中文词语匹配。</p></blockquote><p><strong>期望效果</strong>：<code>content: &quot;方向&quot;</code> → 匹配&quot;方向&quot;整体，而非单个字符&quot;方&quot;和&quot;向&quot;</p><hr><h2 id="一、安装-ik-分词器" tabindex="-1"><a class="header-anchor" href="#一、安装-ik-分词器"><span>一、安装 IK 分词器</span></a></h2><h3 id="_1-版本要求" tabindex="-1"><a class="header-anchor" href="#_1-版本要求"><span>1. 版本要求</span></a></h3><p>IK 分词器版本必须与 ES 版本对应。</p><p><strong>下载地址</strong>：https://release.infinilabs.com/analysis-ik/stable</p><h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h2><p>（三个节点都需要）</p><p><strong>在线安装</strong>:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">/usr/share/elasticsearch/bin/elasticsearch-plugin install https://release.infinilabs.com/analysis-ik/stable/elasticsearch-analysis-ik-7.9.1.zip</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>离线安装</strong>:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">/usr/share/elasticsearch/bin/elasticsearch-plugin install file:///root/elasticsearch-analysis-ik-7.9.1.zip</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>安装后需要<strong>重启所有节点</strong>的ES服务：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">systemctl restart elasticsearch.service</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="二、ik-分词器使用" tabindex="-1"><a class="header-anchor" href="#二、ik-分词器使用"><span>二、IK 分词器使用</span></a></h2><h3 id="_1-创建支持中文分词的索引" tabindex="-1"><a class="header-anchor" href="#_1-创建支持中文分词的索引"><span>1. 创建支持中文分词的索引</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line">PUT /colors_directions_cn</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token key atrule">&quot;mappings&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token key atrule">&quot;properties&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token key atrule">&quot;content&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token key atrule">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;text&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token key atrule">&quot;analyzer&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ik_max_word&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token key atrule">&quot;search_analyzer&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;ik_smart&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token key atrule">&quot;color&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token key atrule">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;keyword&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token key atrule">&quot;direction&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token key atrule">&quot;type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;keyword&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th style="text-align:left;">字段类型</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">content</td><td style="text-align:left;">使用 <code>ik_max_word</code> 分词器，进行中文分词</td></tr><tr><td style="text-align:left;">color, direction</td><td style="text-align:left;">keyword 类型，不进行分词</td></tr></tbody></table><h3 id="_2-分词模式对比" tabindex="-1"><a class="header-anchor" href="#_2-分词模式对比"><span>2. 分词模式对比</span></a></h3><table><thead><tr><th style="text-align:left;">模式</th><th style="text-align:left;">说明</th><th style="text-align:left;">适用场景</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>ik_max_word</strong></td><td style="text-align:left;">最细粒度拆分，穷尽所有组合</td><td style="text-align:left;">Term Query</td></tr><tr><td style="text-align:left;"><strong>ik_smart</strong></td><td style="text-align:left;">最粗粒度拆分</td><td style="text-align:left;">Phrase 查询</td></tr></tbody></table><h3 id="_3-分词效果测试" tabindex="-1"><a class="header-anchor" href="#_3-分词效果测试"><span>3. 分词效果测试</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">POST /colors_directions_cn/_analyze</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;analyzer&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ik_max_word&quot;</span>,</span>
<span class="line">  <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;中华人民共和国国歌&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">POST /colors_directions_cn/_analyze</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;analyzer&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ik_smart&quot;</span>,</span>
<span class="line">  <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;中华人民共和国国歌&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token string">&quot;中华人民共和国国歌&quot;</span></span>
<span class="line">ik_max_word</span>
<span class="line">中华人民共和国,中华人民,中华,华人,人民共和国,人民,共和国,共和,国,国歌</span>
<span class="line">ik_smart</span>
<span class="line">中华人民共和国,国歌</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="三、测试数据插入" tabindex="-1"><a class="header-anchor" href="#三、测试数据插入"><span>三、测试数据插入</span></a></h2><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line">PUT /colors_directions_cn/_doc/<span class="token number">1</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;黑色的汽车在夏天比较吸热，无论停放在哪个方向&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;黑色&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;direction&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">PUT /colors_directions_cn/_doc/<span class="token number">2</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;白色的建筑物在北方地区能更好地反射阳光&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;白色&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;direction&quot;</span><span class="token operator">:</span> <span class="token string">&quot;北&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">PUT /colors_directions_cn/_doc/<span class="token number">3</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;中国的五星红旗是红色和黄色的组合&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;红色&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;direction&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-搜索示例" tabindex="-1"><a class="header-anchor" href="#_4-搜索示例"><span>4.搜索示例</span></a></h2><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json"><pre><code class="language-json"><span class="line">POST /colors_directions_cn/_search</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;红色&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;highlight&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;pre_tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;begin&gt;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;post_tags&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;end&gt;&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token property">&quot;fields&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 同时搜索颜色 or 方向</span></span>
<span class="line">POST /colors_directions_cn/_search</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;query&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token property">&quot;bool&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;should&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;红色&quot;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">{</span></span>
<span class="line">          <span class="token property">&quot;match&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token property">&quot;content&quot;</span><span class="token operator">:</span> <span class="token string">&quot;北方&quot;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_5-自定义中文词库" tabindex="-1"><a class="header-anchor" href="#_5-自定义中文词库"><span>5.自定义中文词库</span></a></h2><h3 id="_5-1-配置热更新词库" tabindex="-1"><a class="header-anchor" href="#_5-1-配置热更新词库"><span>5.1 配置热更新词库</span></a></h3><h4 id="_5-11-安装nginx-用于提供词库文件" tabindex="-1"><a class="header-anchor" href="#_5-11-安装nginx-用于提供词库文件"><span>5.11 安装Nginx（用于提供词库文件）</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yum install nginx -y</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_5-1-2-创建自定义词典文件" tabindex="-1"><a class="header-anchor" href="#_5-1-2-创建自定义词典文件"><span>5.1.2 创建自定义词典文件</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cat &gt; /usr/share/nginx/html/my_word.txt &lt;&lt; &#39;EOF&#39;</span>
<span class="line">北京</span>
<span class="line">上海</span>
<span class="line">江苏</span>
<span class="line">淮安</span>
<span class="line">山东</span>
<span class="line">王权富贵</span>
<span class="line">张老三</span>
<span class="line">周杰伦</span>
<span class="line">EOF</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-1-3-启动nginx" tabindex="-1"><a class="header-anchor" href="#_5-1-3-启动nginx"><span>5.1.3 启动Nginx</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">systemctl start nginx</span>
<span class="line">curl 10.0.0.90/my_word.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-1-4-配置ik分词器" tabindex="-1"><a class="header-anchor" href="#_5-1-4-配置ik分词器"><span>5.1.4 配置IK分词器</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">vim /etc/elasticsearch/analysis-ik/IKAnalyzer.cfg.xml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-xml line-numbers-mode" data-highlighter="prismjs" data-ext="xml"><pre><code class="language-xml"><span class="line"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">properties</span> <span class="token name">SYSTEM</span> <span class="token string">&quot;http://java.sun.com/dtd/properties.dtd&quot;</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comment</span><span class="token punctuation">&gt;</span></span>IK Analyzer 扩展配置<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comment</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token comment">&lt;!--用户可以在这里配置自己的扩展字典 --&gt;</span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ext_dict<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token comment">&lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;</span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>ext_stopwords<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">  <span class="token comment">&lt;!--用户可以在这里配置远程扩展字典 --&gt;</span></span>
<span class="line">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>remote_ext_dict<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>http://10.0.0.90/my_word.txt<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">&gt;</span></span> </span>
<span class="line">  <span class="token comment">&lt;!--用户可以在这里配置远程扩展停止词字典--&gt;</span></span>
<span class="line">  <span class="token comment">&lt;!-- &lt;entry key=&quot;remote_ext_stopwords&quot;&gt;words_location&lt;/entry&gt; --&gt;</span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-1-5-同步到所有节点并重启" tabindex="-1"><a class="header-anchor" href="#_5-1-5-同步到所有节点并重启"><span>5.1.5 同步到所有节点并重启</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 同步配置文件</span></span>
<span class="line"><span class="token builtin class-name">cd</span> /etc/elasticsearch/analysis-ik/</span>
<span class="line"><span class="token function">scp</span> IKAnalyzer.cfg.xml root@10.0.0.91:/etc/elasticsearch/analysis-ik/</span>
<span class="line"><span class="token function">scp</span> IKAnalyzer.cfg.xml root@10.0.0.92:/etc/elasticsearch/analysis-ik/</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 重启所有节点</span></span>
<span class="line">systemctl restart elasticsearch.service</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-2测试分词" tabindex="-1"><a class="header-anchor" href="#_5-2测试分词"><span>5.2测试分词</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">POST /colors_directions_cn/_analyze</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;analyzer&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ik_max_word&quot;</span>,</span>
<span class="line">  <span class="token string">&quot;text&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;王权富贵&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line">在未添加词库前无法得到王权富贵  四字分词</span>
<span class="line">IK分词器每60秒从远程URL检查更新</span>
<span class="line">稍等后  再次测试分词可得到王权富贵  四字</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+l+`" alt="image-20260203213130479"></p><h3 id="_5-3创建索引" tabindex="-1"><a class="header-anchor" href="#_5-3创建索引"><span>5.3创建索引</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">PUT /colors_directions_cn</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;mappings&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;properties&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string">&quot;content&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;text&quot;</span>,</span>
<span class="line">        <span class="token string">&quot;analyzer&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ik_max_word&quot;</span>,</span>
<span class="line">        <span class="token string">&quot;search_analyzer&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ik_smart&quot;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">PUT /names/_doc/1</span>
<span class="line"><span class="token punctuation">{</span><span class="token string">&quot;content&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;张三李四王二麻&quot;</span><span class="token punctuation">}</span></span>
<span class="line">PUT /names/_doc/2</span>
<span class="line"><span class="token punctuation">{</span><span class="token string">&quot;content&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;张三王老五&quot;</span><span class="token punctuation">}</span></span>
<span class="line">PUT /names/_doc/3</span>
<span class="line"><span class="token punctuation">{</span><span class="token string">&quot;content&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;马斯克和王老五&quot;</span><span class="token punctuation">}</span></span>
<span class="line">PUT /names/_doc/4</span>
<span class="line"><span class="token punctuation">{</span><span class="token string">&quot;content&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;王权富贵&quot;</span><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-3测试查询" tabindex="-1"><a class="header-anchor" href="#_5-3测试查询"><span>5.3测试查询</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">POST /names/_search</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string">&quot;content&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;王老五&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span>,</span>
<span class="line">  <span class="token string">&quot;highlight&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;pre_tags&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;begin&gt;&quot;</span><span class="token punctuation">]</span>,</span>
<span class="line">    <span class="token string">&quot;post_tags&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;end&gt;&quot;</span><span class="token punctuation">]</span>,</span>
<span class="line">    <span class="token string">&quot;fields&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string">&quot;content&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">POST /names/_search</span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token string">&quot;query&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;match&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string">&quot;content&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;王权富贵&quot;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span>,</span>
<span class="line">  <span class="token string">&quot;highlight&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;pre_tags&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;begin&gt;&quot;</span><span class="token punctuation">]</span>,</span>
<span class="line">    <span class="token string">&quot;post_tags&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&lt;end&gt;&quot;</span><span class="token punctuation">]</span>,</span>
<span class="line">    <span class="token string">&quot;fields&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token string">&quot;content&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="四、热更新说明" tabindex="-1"><a class="header-anchor" href="#四、热更新说明"><span>四、热更新说明</span></a></h2><h3 id="_4-1-特性" tabindex="-1"><a class="header-anchor" href="#_4-1-特性"><span>4.1 特性</span></a></h3><ul><li><strong>60秒更新间隔</strong>: IK分词器每60秒从远程URL检查更新</li><li><strong>无需重启</strong>: 修改词库后自动生效</li><li><strong>注意事项</strong>: <ol><li>后端开发需在更新词典后，再录入相关数据</li><li>新产品的关键词需要先更新词典</li></ol></li></ul><h3 id="_4-2-验证步骤" tabindex="-1"><a class="header-anchor" href="#_4-2-验证步骤"><span>4.2 验证步骤</span></a></h3><ol><li>修改Nginx上的<code>my_word.txt</code>文件</li><li>等待60秒自动更新</li><li>测试分词效果</li></ol><h3 id="_4-3-删除词语" tabindex="-1"><a class="header-anchor" href="#_4-3-删除词语"><span>4.3 删除词语</span></a></h3><p>从<code>my_word.txt</code>中删除词语后，同样在60秒后生效，ES将不再识别该词语。</p><hr><h2 id="五、注意事项" tabindex="-1"><a class="header-anchor" href="#五、注意事项"><span>五、注意事项</span></a></h2><ol><li><strong>版本匹配</strong>: IK分词器版本必须与ES版本严格对应</li><li><strong>所有节点</strong>: 插件需要在所有ES节点上安装</li><li><strong>重启服务</strong>: 安装插件后必须重启ES服务</li><li><strong>索引重建</strong>: 已存在的索引需要重建或重新设置mapping才能使用新分词器</li><li><strong>热更新延迟</strong>: 远程词库更新有60秒延迟</li></ol>`,61)])])}const u=n(p,[["render",i]]),r=JSON.parse('{"path":"/11-ELK%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/01-elasticsearch%E4%B8%8Eelk/4-ES%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D%E5%99%A8.html","title":"ES 中文分词器（IK Analyzer）配置指南","lang":"zh-CN","frontmatter":{},"git":{"contributors":[{"name":"opsjjq","username":"opsjjq","email":"wangyp987@gmail.com","commits":1,"url":"https://github.com/opsjjq"}],"changelog":[{"hash":"ca8e661b7c6729c958583ed3d1a001b6de398273","time":1771558748000,"email":"wangyp987@gmail.com","author":"opsjjq","message":"222"}]},"filePathRelative":"11-ELK日志系统/01-elasticsearch与elk/4-ES中文分词器.md"}');export{u as comp,r as data};
