import{_ as n,c as a,e,o as l}from"./app-DtXLoKBz.js";const i={};function p(t,s){return l(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="一、集群概述" tabindex="-1"><a class="header-anchor" href="#一、集群概述"><span>一、集群概述</span></a></h2><p><strong>集群</strong> 是一组相互连接的计算机（节点），通过网络协作，作为一个统一的系统来提供服务或任务。核心目标：</p><ul><li>提升系统可用性</li><li>提升系统可扩展性</li><li>提升系统整体性能</li></ul><p><strong>只有基于服务器集群的环境，才能实现负载均衡。</strong></p><hr><h2 id="二、集群类型与负载均衡" tabindex="-1"><a class="header-anchor" href="#二、集群类型与负载均衡"><span>二、集群类型与负载均衡</span></a></h2><h3 id="_1-负载均衡集群-load-balancing-cluster" tabindex="-1"><a class="header-anchor" href="#_1-负载均衡集群-load-balancing-cluster"><span>1. 负载均衡集群（Load Balancing Cluster）</span></a></h3><ul><li>将用户请求均匀分配到多个节点，避免单点过载</li><li>提升系统性能和响应速度</li><li>负载均衡器依据算法（如轮询、加权轮询等）分配请求</li></ul><h3 id="_2-高可用集群-high-availability-cluster" tabindex="-1"><a class="header-anchor" href="#_2-高可用集群-high-availability-cluster"><span>2. 高可用集群（High Availability Cluster）</span></a></h3><ul><li>确保服务持续可用，单点故障不影响整体</li><li>常用于数据库、关键业务系统</li></ul><h3 id="_3-其他集群类型" tabindex="-1"><a class="header-anchor" href="#_3-其他集群类型"><span>3. 其他集群类型</span></a></h3><ul><li>Web 集群、数据库集群、缓存集群、负载均衡集群等</li></ul><hr><h2 id="三、正向代理与反向代理" tabindex="-1"><a class="header-anchor" href="#三、正向代理与反向代理"><span>三、正向代理与反向代理</span></a></h2><h3 id="_1-正向代理-forward-proxy" tabindex="-1"><a class="header-anchor" href="#_1-正向代理-forward-proxy"><span>1. 正向代理（Forward Proxy）</span></a></h3><ul><li><p><strong>代理客户端</strong>，隐藏客户端真实 IP</p></li><li><p>用途：</p><ul><li>突破网络限制（如访问国外资源）</li><li>保护客户端身份</li></ul></li><li><p>配置示例（nginx）：</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">proxy_pass</span> http://目标服务器IP:端口</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_2-反向代理-reverse-proxy" tabindex="-1"><a class="header-anchor" href="#_2-反向代理-reverse-proxy"><span>2. 反向代理（Reverse Proxy）</span></a></h3><ul><li><p><strong>代理服务端</strong>，隐藏后端服务器真实 IP</p></li><li><p>是负载均衡的核心实现方式</p></li><li><p>配置示例（nginx）：</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">upstream</span> backend</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 后端服务器1:端口</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 后端服务器2:端口</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://backend</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><hr><h2 id="四、负载均衡实现方式" tabindex="-1"><a class="header-anchor" href="#四、负载均衡实现方式"><span>四、负载均衡实现方式</span></a></h2><h3 id="_1-硬件负载均衡" tabindex="-1"><a class="header-anchor" href="#_1-硬件负载均衡"><span>1. 硬件负载均衡</span></a></h3><ul><li>如 F5、Netscaler 等商业设备</li></ul><h3 id="_2-软件负载均衡-开源常用" tabindex="-1"><a class="header-anchor" href="#_2-软件负载均衡-开源常用"><span>2. 软件负载均衡（开源常用）</span></a></h3><ul><li>Nginx（七层/四层）</li><li>LVS（四层）</li><li>HAProxy</li><li>Keepalived（高可用）</li></ul><hr><h2 id="五、nginx-负载均衡实践" tabindex="-1"><a class="header-anchor" href="#五、nginx-负载均衡实践"><span>五、Nginx 负载均衡实践</span></a></h2><h3 id="_1-四层负载均衡-tcp-udp" tabindex="-1"><a class="header-anchor" href="#_1-四层负载均衡-tcp-udp"><span>1. 四层负载均衡（TCP/UDP）</span></a></h3><ul><li><p>基于 OSI 第四层（传输层）进行转发</p></li><li><p>配置示例（MySQL 转发）：</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">stream</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">upstream</span> mysql_backend</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">server</span> 172.16.1.51:3306</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">server</span> 172.16.1.52:3306</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">3306</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_pass</span> mysql_backend</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_2-七层负载均衡-http-https" tabindex="-1"><a class="header-anchor" href="#_2-七层负载均衡-http-https"><span>2. 七层负载均衡（HTTP/HTTPS）</span></a></h3><ul><li><p>基于 OSI 第七层（应用层）进行转发</p></li><li><p>可基于域名、URL 等转发</p></li><li><p>配置示例：</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">upstream</span> web_backend</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.7:8080</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.8:8080</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://web_backend</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">include</span> proxy_params.conf</span><span class="token punctuation">;</span> <span class="token comment"># 包含代理参数文件</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h3 id="_3-代理参数文件示例-proxy-params-conf" tabindex="-1"><a class="header-anchor" href="#_3-代理参数文件示例-proxy-params-conf"><span>3. 代理参数文件示例（proxy_params.conf）</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$http_host</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token directive"><span class="token keyword">proxy_connect_timeout</span> <span class="token number">30</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token directive"><span class="token keyword">proxy_send_timeout</span> <span class="token number">60</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token directive"><span class="token keyword">proxy_read_timeout</span> <span class="token number">60</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token directive"><span class="token keyword">proxy_buffering</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token directive"><span class="token keyword">proxy_buffer_size</span> <span class="token number">32k</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token directive"><span class="token keyword">proxy_buffers</span> <span class="token number">4</span> <span class="token number">128k</span></span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="六、实战案例-nginx-反向代理-wordpress" tabindex="-1"><a class="header-anchor" href="#六、实战案例-nginx-反向代理-wordpress"><span>六、实战案例：Nginx 反向代理 WordPress</span></a></h2><h3 id="环境准备" tabindex="-1"><a class="header-anchor" href="#环境准备"><span>环境准备</span></a></h3><ul><li>客户端（Client）</li><li>负载均衡器（lb-5）</li><li>后端服务器（web-7、web-8）</li></ul><h3 id="配置步骤" tabindex="-1"><a class="header-anchor" href="#配置步骤"><span>配置步骤</span></a></h3><h4 id="_1-负载均衡器-lb-5-配置" tabindex="-1"><a class="header-anchor" href="#_1-负载均衡器-lb-5-配置"><span>1. 负载均衡器（lb-5）配置</span></a></h4><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> wordpress.linux0224.cn</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://172.16.1.7:8080</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">include</span> /etc/nginx/proxy_params.conf</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-后端服务器-web-7-配置" tabindex="-1"><a class="header-anchor" href="#_2-后端服务器-web-7-配置"><span>2. 后端服务器（web-7）配置</span></a></h4><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">8080</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> wordpress.linux0224.cn</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">root</span> /code/wordpress</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">index</span> index.php index.html</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> ~ \\.php$</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">root</span> /code/wordpress</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">fastcgi_pass</span> 127.0.0.1:9000</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">fastcgi_param</span> SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">include</span> fastcgi_params</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-客户端访问流程" tabindex="-1"><a class="header-anchor" href="#_3-客户端访问流程"><span>3. 客户端访问流程</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">客户端 → lb-5（反向代理） → web-7（WordPress）</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="七、关键概念总结" tabindex="-1"><a class="header-anchor" href="#七、关键概念总结"><span>七、关键概念总结</span></a></h2><table><thead><tr><th style="text-align:left;">概念</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;">集群</td><td style="text-align:left;">一组机器协作提供服务</td></tr><tr><td style="text-align:left;">负载均衡</td><td style="text-align:left;">将请求均匀分配到多个服务器</td></tr><tr><td style="text-align:left;">正向代理</td><td style="text-align:left;">代理客户端，隐藏客户端 IP</td></tr><tr><td style="text-align:left;">反向代理</td><td style="text-align:left;">代理服务端，隐藏服务端 IP</td></tr><tr><td style="text-align:left;">四层负载均衡</td><td style="text-align:left;">基于 IP + 端口转发</td></tr><tr><td style="text-align:left;">七层负载均衡</td><td style="text-align:left;">基于 HTTP 头部、URL 等转发</td></tr><tr><td style="text-align:left;">高可用</td><td style="text-align:left;">系统持续可用，无单点故障</td></tr></tbody></table><hr><h2 id="八、学习建议" tabindex="-1"><a class="header-anchor" href="#八、学习建议"><span>八、学习建议</span></a></h2><ol><li>先理解代理与转发的区别</li><li>掌握 Nginx 的 <code>proxy_pass</code> 和 <code>upstream</code> 配置</li><li>动手搭建简单的负载均衡环境（如 WordPress）</li><li>通过日志分析请求流向，理解转发过程</li><li>逐步扩展到四层、七层负载均衡的实际应用</li></ol><hr><h2 id="九、常见问题" tabindex="-1"><a class="header-anchor" href="#九、常见问题"><span>九、常见问题</span></a></h2><h3 id="q-正向代理和反向代理有什么区别" tabindex="-1"><a class="header-anchor" href="#q-正向代理和反向代理有什么区别"><span>Q：正向代理和反向代理有什么区别？</span></a></h3><p>A：正向代理代理客户端，反向代理代理服务端。</p><h3 id="q-负载均衡有哪些常用算法" tabindex="-1"><a class="header-anchor" href="#q-负载均衡有哪些常用算法"><span>Q：负载均衡有哪些常用算法？</span></a></h3><p>A：轮询、加权轮询、IP Hash、最少连接等。</p><h3 id="q-nginx-如何实现四层负载均衡" tabindex="-1"><a class="header-anchor" href="#q-nginx-如何实现四层负载均衡"><span>Q：Nginx 如何实现四层负载均衡？</span></a></h3><p>A：使用 <code>stream</code> 模块，配置 TCP/UDP 转发。</p><h3 id="q-为什么需要-x-forwarded-for-头部" tabindex="-1"><a class="header-anchor" href="#q-为什么需要-x-forwarded-for-头部"><span>Q：为什么需要 <code>X-Forwarded-For</code> 头部？</span></a></h3><p>A：用于传递客户端真实 IP，便于后端日志记录和业务处理。</p>`,59)])])}const r=n(i,[["render",p]]),d=JSON.parse('{"path":"/04-Web%E6%9E%B6%E6%9E%84/04-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/53%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1.html","title":"","lang":"zh-CN","frontmatter":{},"git":{"contributors":[{"name":"opsjjq","username":"opsjjq","email":"wangyp987@gmail.com","commits":1,"url":"https://github.com/opsjjq"}],"changelog":[{"hash":"ca8e661b7c6729c958583ed3d1a001b6de398273","time":1771558748000,"email":"wangyp987@gmail.com","author":"opsjjq","message":"222"}]},"filePathRelative":"04-Web架构/04-负载均衡/53负载均衡.md"}');export{r as comp,d as data};
