import{_ as a,c as n,e,o as l}from"./app-DtXLoKBz.js";const i={};function r(t,s){return l(),n("div",null,[...s[0]||(s[0]=[e(`<h2 id="一、nfs在企业中的应用架构" tabindex="-1"><a class="header-anchor" href="#一、nfs在企业中的应用架构"><span>一、NFS在企业中的应用架构</span></a></h2><p>NFS（Network File System）广泛应用于企业环境中，主要用于存储和共享视频、图片、HTML等静态文件。例如：</p><ul><li>网站用户上传的文件（如图片、附件、头像等）</li><li>BBS、论坛等产品生成的静态资源</li><li>企业官网中的大量图片、动态图和网页文件</li></ul><p>公有云平台如阿里云的NAS服务即为云化NFS服务。</p><hr><h2 id="二、企业集群为什么需要共享存储" tabindex="-1"><a class="header-anchor" href="#二、企业集群为什么需要共享存储"><span>二、企业集群为什么需要共享存储</span></a></h2><ol><li><strong>数据一致性保障</strong> 确保多台服务器访问同一份数据，避免数据冲突。</li><li><strong>高可用性与故障切换</strong> 如邮件服务器故障时，共享存储可被其他节点接管，保障服务连续性。</li><li><strong>资源高效利用与负载均衡</strong> 多节点可同时访问共享存储，实现负载分摊。</li><li><strong>数据集中管理与备份</strong> 数据统一存储，便于管理、备份和恢复。</li></ol><hr><h2 id="三、nfs与rpc的关系" tabindex="-1"><a class="header-anchor" href="#三、nfs与rpc的关系"><span>三、NFS与RPC的关系</span></a></h2><p>NFS依赖RPC（Remote Procedure Call）实现客户端与服务器之间的通信：</p><ul><li>RPC为NFS提供远程调用抽象，使客户端像调用本地函数一样访问远程文件。</li><li>NFS客户端通过RPC发送请求，服务端通过RPC响应，实现文件操作的网络传输。</li></ul><hr><h2 id="四、nfs架构与通信原理" tabindex="-1"><a class="header-anchor" href="#四、nfs架构与通信原理"><span>四、NFS架构与通信原理</span></a></h2><h3 id="服务端组件" tabindex="-1"><a class="header-anchor" href="#服务端组件"><span>服务端组件：</span></a></h3><ul><li><strong>rpcbind</strong>：端口映射服务（端口111）</li><li><strong>nfs-utils</strong>：共享目录与权限管理</li><li><strong>nfsd</strong>：NFS守护进程（端口2049）</li><li><strong>mountd</strong>：挂载请求验证</li><li><strong>idmapd</strong>：用户身份映射</li></ul><h3 id="客户端组件" tabindex="-1"><a class="header-anchor" href="#客户端组件"><span>客户端组件：</span></a></h3><ul><li>NFS文件系统（内核模块）</li><li>RPC模块（封装请求与响应）</li></ul><h3 id="通信流程" tabindex="-1"><a class="header-anchor" href="#通信流程"><span>通信流程：</span></a></h3><ol><li>NFS服务端启动，向rpcbind注册端口信息。</li><li>客户端通过rpcbind获取服务端端口。</li><li>客户端发送RPC请求至服务端对应端口。</li><li>服务端验证权限并执行文件操作。</li><li>操作结果通过RPC返回客户端。</li></ol><hr><h2 id="五、nfs服务端配置" tabindex="-1"><a class="header-anchor" href="#五、nfs服务端配置"><span>五、NFS服务端配置</span></a></h2><h3 id="_1-安装与启动" tabindex="-1"><a class="header-anchor" href="#_1-安装与启动"><span>1. 安装与启动：</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">yum <span class="token function">install</span> nfs-utils rpcbind <span class="token parameter variable">-y</span></span>
<span class="line">systemctl start rpcbind.service</span>
<span class="line">systemctl start rpcbind.socket</span>
<span class="line">systemctl start nfs</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-配置文件-etc-exports" tabindex="-1"><a class="header-anchor" href="#_2-配置文件-etc-exports"><span>2. 配置文件 <code>/etc/exports</code>：</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">/nfs-data  <span class="token number">172.16</span>.1.0/24<span class="token punctuation">(</span>rw,sync,all_squash,anonuid<span class="token operator">=</span><span class="token number">1500</span>,anongid<span class="token operator">=</span><span class="token number">1500</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li><strong>共享目录</strong>：绝对路径，需设置适当本地权限</li><li><strong>客户端地址</strong>：支持IP、网段、域名（推荐使用IP或网段）</li><li><strong>权限参数</strong>： <ul><li><code>rw</code>：读写</li><li><code>ro</code>：只读</li><li><code>sync</code>：同步写入（安全）</li><li><code>async</code>：异步写入（性能高）</li><li><code>all_squash</code>：所有用户映射为匿名用户</li><li><code>anonuid/anongid</code>：指定映射用户UID/GID</li></ul></li></ul><h3 id="_3-重新加载配置" tabindex="-1"><a class="header-anchor" href="#_3-重新加载配置"><span>3. 重新加载配置：</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">systemctl reload nfs</span>
<span class="line"><span class="token comment"># 或</span></span>
<span class="line">exportfs <span class="token parameter variable">-r</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="六、nfs客户端配置" tabindex="-1"><a class="header-anchor" href="#六、nfs客户端配置"><span>六、NFS客户端配置</span></a></h2><h3 id="_1-安装与挂载" tabindex="-1"><a class="header-anchor" href="#_1-安装与挂载"><span>1. 安装与挂载：</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">yum <span class="token function">install</span> nfs-utils <span class="token parameter variable">-y</span></span>
<span class="line"><span class="token function">mkdir</span> /mnt/nfs-data</span>
<span class="line"><span class="token function">mount</span> <span class="token parameter variable">-t</span> nfs <span class="token number">172.16</span>.1.31:/nfs-data /mnt/nfs-data</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-查看挂载" tabindex="-1"><a class="header-anchor" href="#_2-查看挂载"><span>2. 查看挂载：</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">df</span> <span class="token parameter variable">-h</span></span>
<span class="line"><span class="token function">mount</span> <span class="token parameter variable">-l</span> <span class="token operator">|</span> <span class="token function">grep</span> nfs</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="七、nfs结合nginx实现共享存储" tabindex="-1"><a class="header-anchor" href="#七、nfs结合nginx实现共享存储"><span>七、NFS结合Nginx实现共享存储</span></a></h2><h3 id="服务端" tabindex="-1"><a class="header-anchor" href="#服务端"><span>服务端：</span></a></h3><ol><li>创建用户www（UID=1500）</li><li>创建共享目录并授权</li><li>配置<code>/etc/exports</code>，指定anonuid/anongid为1500</li><li>重新加载NFS</li></ol><h3 id="客户端" tabindex="-1"><a class="header-anchor" href="#客户端"><span>客户端：</span></a></h3><ol><li>创建相同UID的www用户</li><li>安装Nginx并配置以www用户运行</li><li>挂载NFS共享到Nginx网页目录：</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">mount</span> <span class="token parameter variable">-t</span> nfs <span class="token number">172.16</span>.1.31:/nfs-nginx /usr/share/nginx/html</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol><li>在共享目录中放置HTML、图片等静态资源</li></ol><hr><h2 id="八、常见故障与处理" tabindex="-1"><a class="header-anchor" href="#八、常见故障与处理"><span>八、常见故障与处理</span></a></h2><h3 id="_1-客户端未挂载或挂载失效" tabindex="-1"><a class="header-anchor" href="#_1-客户端未挂载或挂载失效"><span>1. 客户端未挂载或挂载失效：</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"># 重新挂载</span>
<span class="line">mount -t nfs 服务器IP:/共享目录 /本地目录</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-nfs服务端故障" tabindex="-1"><a class="header-anchor" href="#_2-nfs服务端故障"><span>2. NFS服务端故障：</span></a></h3><ul><li>检查NFS服务状态：<code>systemctl status nfs</code></li><li>重启服务：<code>systemctl restart nfs</code></li></ul><h3 id="_3-强制卸载挂载点-紧急恢复" tabindex="-1"><a class="header-anchor" href="#_3-强制卸载挂载点-紧急恢复"><span>3. 强制卸载挂载点（紧急恢复）：</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">umount -fl /挂载点</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_4-权限或映射问题" tabindex="-1"><a class="header-anchor" href="#_4-权限或映射问题"><span>4. 权限或映射问题：</span></a></h3><ul><li>确保服务端与客户端用户UID/GID一致</li><li>检查<code>/etc/exports</code>中的squash与anonuid设置</li></ul>`,52)])])}const c=a(i,[["render",r]]),p=JSON.parse('{"path":"/02-Linux%E8%BF%9B%E9%98%B6/04-%E6%96%87%E4%BB%B6%E5%90%8C%E6%AD%A5%E4%B8%8E%E5%AD%98%E5%82%A8/%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8nfs.html","title":"","lang":"zh-CN","frontmatter":{},"git":{"contributors":[{"name":"opsjjq","username":"opsjjq","email":"wangyp987@gmail.com","commits":1,"url":"https://github.com/opsjjq"}],"changelog":[{"hash":"ca8e661b7c6729c958583ed3d1a001b6de398273","time":1771558748000,"email":"wangyp987@gmail.com","author":"opsjjq","message":"222"}]},"filePathRelative":"02-Linux进阶/04-文件同步与存储/共享存储nfs.md"}');export{c as comp,p as data};
