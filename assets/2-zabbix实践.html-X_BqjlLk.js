import{_ as s,c as e,e as n,o as l}from"./app-DtXLoKBz.js";const t={};function i(r,a){return l(),e("div",null,[...a[0]||(a[0]=[n(`<h2 id="zabbix实践-agent部署与自定义监控" tabindex="-1"><a class="header-anchor" href="#zabbix实践-agent部署与自定义监控"><span>Zabbix实践：Agent部署与自定义监控</span></a></h2><h3 id="一、zabbix-agent部署" tabindex="-1"><a class="header-anchor" href="#一、zabbix-agent部署"><span>一、Zabbix Agent部署</span></a></h3><h4 id="_1-安装agent" tabindex="-1"><a class="header-anchor" href="#_1-安装agent"><span>1. 安装Agent</span></a></h4><p>在被监控主机上安装Zabbix Agent：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 配置Zabbix yum源</span></span>
<span class="line"><span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/4.0/rhel/7/x86_64/zabbix-release-4.0-1.el7.noarch.rpm</span>
<span class="line"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;s#repo.zabbix.com#mirrors.tuna.tsinghua.edu.cn/zabbix#g&#39;</span> /etc/yum.repos.d/zabbix.repo</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 安装Agent</span></span>
<span class="line">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> zabbix-agent</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-配置agent" tabindex="-1"><a class="header-anchor" href="#_2-配置agent"><span>2. 配置Agent</span></a></h4><p>编辑 <code>/etc/zabbix/zabbix_agentd.conf</code>：</p><div class="language-ini line-numbers-mode" data-highlighter="prismjs" data-ext="ini"><pre><code class="language-ini"><span class="line"><span class="token key attr-name">PidFile</span><span class="token punctuation">=</span><span class="token value attr-value">/var/run/zabbix/zabbix_agentd.pid</span></span>
<span class="line"><span class="token key attr-name">LogFile</span><span class="token punctuation">=</span><span class="token value attr-value">/var/log/zabbix/zabbix_agentd.log</span></span>
<span class="line"><span class="token key attr-name">LogFileSize</span><span class="token punctuation">=</span><span class="token value attr-value">0</span></span>
<span class="line"><span class="token key attr-name">Server</span><span class="token punctuation">=</span><span class="token value attr-value">10.0.0.71  # Zabbix Server IP</span></span>
<span class="line"><span class="token key attr-name">Include</span><span class="token punctuation">=</span><span class="token value attr-value">/etc/zabbix/zabbix_agentd.d/*.conf</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-启动agent" tabindex="-1"><a class="header-anchor" href="#_3-启动agent"><span>3. 启动Agent</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">systemctl start zabbix-agent <span class="token operator">&amp;&amp;</span> systemctl <span class="token builtin class-name">enable</span> zabbix-agent</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h3 id="二、添加监控主机" tabindex="-1"><a class="header-anchor" href="#二、添加监控主机"><span>二、添加监控主机</span></a></h3><h4 id="_1-web界面添加主机" tabindex="-1"><a class="header-anchor" href="#_1-web界面添加主机"><span>1. Web界面添加主机</span></a></h4><ul><li>登录Zabbix Web界面</li><li>配置 → 主机 → 创建主机</li><li>填写主机名称、可见名称、IP地址</li><li>选择监控模板（如：Linux by Zabbix Agent）</li></ul><h4 id="_2-验证监控状态" tabindex="-1"><a class="header-anchor" href="#_2-验证监控状态"><span>2. 验证监控状态</span></a></h4><ul><li>监控 → 最新数据 → 选择主机</li><li>查看监控项数据是否正常采集</li></ul><hr><h3 id="三、自定义监控项" tabindex="-1"><a class="header-anchor" href="#三、自定义监控项"><span>三、自定义监控项</span></a></h3><h4 id="_1-自定义tcp状态监控" tabindex="-1"><a class="header-anchor" href="#_1-自定义tcp状态监控"><span>1. 自定义TCP状态监控</span></a></h4><p>创建自定义监控脚本：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 创建监控配置文件</span></span>
<span class="line"><span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/zabbix/zabbix_agentd.d/tcp_status.conf <span class="token operator">&lt;&lt;</span><span class="token string">&#39;EOF&#39;</span>
<span class="line">UserParameter=tcp_status[*],netstat -ant | grep -c $1</span>
<span class="line">EOF</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 重启Agent</span></span>
<span class="line">systemctl restart zabbix-agent</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试监控项</span></span>
<span class="line">zabbix_agentd <span class="token parameter variable">-t</span> tcp_status<span class="token punctuation">[</span>ESTABLISHED<span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-在zabbix-server端创建监控项" tabindex="-1"><a class="header-anchor" href="#_2-在zabbix-server端创建监控项"><span>2. 在Zabbix Server端创建监控项</span></a></h4><ul><li>配置 → 主机 → 选择主机 → 监控项 → 创建监控项</li><li>名称：TCP ESTABLISHED连接数</li><li>键值：tcp_status[ESTABLISHED]</li><li>数据类型：数值（整数）</li><li>信息类型：无符号整型</li><li>单位：个</li></ul><h4 id="_3-创建触发器" tabindex="-1"><a class="header-anchor" href="#_3-创建触发器"><span>3. 创建触发器</span></a></h4><ul><li>配置 → 主机 → 选择主机 → 触发器 → 创建触发器</li><li>名称：TCP ESTABLISHED连接数过高</li><li>表达式：<code>{主机名:tcp_status[ESTABLISHED].last()}&gt;5000</code></li><li>严重性：警告</li></ul><hr><h3 id="四、监控项类型" tabindex="-1"><a class="header-anchor" href="#四、监控项类型"><span>四、监控项类型</span></a></h3><table><thead><tr><th style="text-align:left;">类型</th><th style="text-align:left;">说明</th><th style="text-align:left;">适用场景</th></tr></thead><tbody><tr><td style="text-align:left;">Zabbix Agent</td><td style="text-align:left;">通过Agent采集数据</td><td style="text-align:left;">服务器监控</td></tr><tr><td style="text-align:left;">SNMP</td><td style="text-align:left;">网络设备协议</td><td style="text-align:left;">交换机、路由器</td></tr><tr><td style="text-align:left;">IPMI</td><td style="text-align:left;">硬件监控</td><td style="text-align:left;">服务器硬件状态</td></tr><tr><td style="text-align:left;">JMX</td><td style="text-align:left;">Java应用监控</td><td style="text-align:left;">Java应用</td></tr><tr><td style="text-align:left;">Simple check</td><td style="text-align:left;">简单检查</td><td style="text-align:left;">端口、ICMP等</td></tr></tbody></table><hr><h3 id="五、常用监控命令" tabindex="-1"><a class="header-anchor" href="#五、常用监控命令"><span>五、常用监控命令</span></a></h3><h4 id="_1-agent端测试" tabindex="-1"><a class="header-anchor" href="#_1-agent端测试"><span>1. Agent端测试</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 测试指定监控项</span></span>
<span class="line">zabbix_agentd <span class="token parameter variable">-t</span> system.cpu.util</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试所有监控项</span></span>
<span class="line">zabbix_agentd <span class="token parameter variable">-p</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-server端测试" tabindex="-1"><a class="header-anchor" href="#_2-server端测试"><span>2. Server端测试</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 使用zabbix_get获取Agent数据</span></span>
<span class="line">zabbix_get <span class="token parameter variable">-s</span> <span class="token number">10.0</span>.0.72 <span class="token parameter variable">-p</span> <span class="token number">10050</span> <span class="token parameter variable">-k</span> system.cpu.util</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="六、监控最佳实践" tabindex="-1"><a class="header-anchor" href="#六、监控最佳实践"><span>六、监控最佳实践</span></a></h3><h4 id="_1-监控项命名规范" tabindex="-1"><a class="header-anchor" href="#_1-监控项命名规范"><span>1. 监控项命名规范</span></a></h4><ul><li>使用清晰的名称描述监控内容</li><li>包含单位信息（如：CPU使用率%、内存使用MB）</li><li>示例：<code>CPU使用率</code>、<code>磁盘使用率_根分区%</code></li></ul><h4 id="_2-触发器设计原则" tabindex="-1"><a class="header-anchor" href="#_2-触发器设计原则"><span>2. 触发器设计原则</span></a></h4><ul><li>设置合理的阈值</li><li>避免告警风暴</li><li>区分严重性级别</li></ul><h4 id="_3-数据保留策略" tabindex="-1"><a class="header-anchor" href="#_3-数据保留策略"><span>3. 数据保留策略</span></a></h4><ul><li>历史数据：保留7-30天</li><li>趋势数据：保留365天</li><li>根据磁盘空间调整</li></ul><hr><h3 id="七、常见问题排查" tabindex="-1"><a class="header-anchor" href="#七、常见问题排查"><span>七、常见问题排查</span></a></h3><h4 id="_1-agent无法连接" tabindex="-1"><a class="header-anchor" href="#_1-agent无法连接"><span>1. Agent无法连接</span></a></h4><ul><li>检查防火墙规则：<code>firewall-cmd --list-all</code></li><li>确认Agent服务状态：<code>systemctl status zabbix-agent</code></li><li>查看Agent日志：<code>tail -f /var/log/zabbix/zabbix_agentd.log</code></li></ul><h4 id="_2-监控项无数据" tabindex="-1"><a class="header-anchor" href="#_2-监控项无数据"><span>2. 监控项无数据</span></a></h4><ul><li>验证监控项键值是否正确</li><li>检查Agent端是否支持该监控项</li><li>使用zabbix_get测试连接</li></ul><h4 id="_3-触发器不触发" tabindex="-1"><a class="header-anchor" href="#_3-触发器不触发"><span>3. 触发器不触发</span></a></h4><ul><li>检查触发器表达式语法</li><li>确认监控项数据是否正常</li><li>查看触发器依赖关系</li></ul><hr><h3 id="八、总结" tabindex="-1"><a class="header-anchor" href="#八、总结"><span>八、总结</span></a></h3><p>通过本实践文档，我们学习了Zabbix Agent的部署、主机添加、自定义监控项的创建以及常见问题的排查。掌握这些技能后，可以构建一个完整的监控体系，实现对服务器和应用的全面监控。</p><blockquote><p>下一步：学习Zabbix多媒介报警配置，实现邮件、微信、钉钉等多种告警方式。</p></blockquote>`,54)])])}const c=s(t,[["render",i]]),d=JSON.parse('{"path":"/07-%E7%9B%91%E6%8E%A7%E4%BD%93%E7%B3%BB/01-zabbix%E7%9B%91%E6%8E%A7/2-zabbix%E5%AE%9E%E8%B7%B5.html","title":"","lang":"zh-CN","frontmatter":{},"git":{"contributors":[{"name":"opsjjq","username":"opsjjq","email":"wangyp987@gmail.com","commits":1,"url":"https://github.com/opsjjq"}],"changelog":[{"hash":"ca8e661b7c6729c958583ed3d1a001b6de398273","time":1771558748000,"email":"wangyp987@gmail.com","author":"opsjjq","message":"222"}]},"filePathRelative":"07-监控体系/01-zabbix监控/2-zabbix实践.md"}');export{c as comp,d as data};
