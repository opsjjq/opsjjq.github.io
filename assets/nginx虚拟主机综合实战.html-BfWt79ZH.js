import{_ as n,c as a,e,o as l}from"./app-DtXLoKBz.js";const i={};function p(t,s){return l(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="nginx-核心功能与配置文件详解" tabindex="-1"><a class="header-anchor" href="#nginx-核心功能与配置文件详解"><span>Nginx 核心功能与配置文件详解</span></a></h1><h2 id="nginx-配置文件基础语法" tabindex="-1"><a class="header-anchor" href="#nginx-配置文件基础语法"><span>Nginx 配置文件基础语法</span></a></h2><h3 id="基本语法规则" tabindex="-1"><a class="header-anchor" href="#基本语法规则"><span>基本语法规则</span></a></h3><ol><li><strong>每条语句必须以分号结束</strong></li><li><strong>区段配置用花括号 {} 包裹</strong></li><li><strong>作用域不能随意嵌套</strong><ul><li><code>server{}</code> 必须放在 <code>http{}</code> 内</li><li>写在 <code>http{}</code> 外层会导致语法错误</li></ul></li><li><strong>include 参数用于导入外部配置</strong><ul><li>必须写在相应区段的花括号内</li><li>只对当前区段生效</li></ul></li></ol><h3 id="配置文件示例" tabindex="-1"><a class="header-anchor" href="#配置文件示例"><span>配置文件示例</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># /etc/nginx/nginx.conf </span></span>
<span class="line"><span class="token comment"># 导入外部虚拟主机配置</span></span>
<span class="line"><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment"># 全局配置参数</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">xxxxx</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">xxxxx</span></span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># 导入外部配置文件</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">include</span> /etc/nginx/extra/*.conf</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="nginx-配置文件结构" tabindex="-1"><a class="header-anchor" href="#nginx-配置文件结构"><span>Nginx 配置文件结构</span></a></h2><h3 id="主配置文件层次" tabindex="-1"><a class="header-anchor" href="#主配置文件层次"><span>主配置文件层次</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">user</span> www</span><span class="token punctuation">;</span>  <span class="token comment"># 运行用户</span></span>
<span class="line"></span>
<span class="line"><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment"># HTTP 核心模块参数</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># 虚拟主机1</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">root</span> /www/site1/</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># 虚拟主机2</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">server_name</span> test.com</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">root</span> /www/site2/</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="作业-1-多版本-nginx-管理" tabindex="-1"><a class="header-anchor" href="#作业-1-多版本-nginx-管理"><span>作业 1：多版本 Nginx 管理</span></a></h2><h3 id="要求" tabindex="-1"><a class="header-anchor" href="#要求"><span>要求</span></a></h3><ol><li><p><strong>编译安装 Tengine 最新版</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"># 安装到 /opt/ngx/</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>Yum 安装官方 Nginx</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">yum install nginx -y</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>管理多个版本</strong></p><ul><li><p>Yum 安装路径：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">/usr/sbin/nginx               # 二进制文件</span>
<span class="line">/etc/nginx/nginx.conf         # 配置文件</span>
<span class="line">/var/log/nginx/access.log     # 访问日志</span>
<span class="line">/usr/share/nginx/html/index.html  # 默认页面</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>编译安装路径：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">/opt/ngx/sbin/nginx           # 二进制文件</span>
<span class="line">/opt/ngx/conf/nginx.conf      # 配置文件</span>
<span class="line">/opt/ngx/logs/access.log      # 访问日志</span>
<span class="line">/opt/ngx/html/index.html      # 默认页面</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p><strong>确定当前运行的 Nginx 版本</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"># 查看进程打开的文件</span>
<span class="line">lsof -p $(pidof nginx)</span>
<span class="line"></span>
<span class="line"># 或查看二进制路径</span>
<span class="line">ps aux | grep nginx</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h3 id="nginx-常用命令" tabindex="-1"><a class="header-anchor" href="#nginx-常用命令"><span>Nginx 常用命令</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">nginx -s stop        # 快速停止</span>
<span class="line">nginx -s quit        # 优雅停止</span>
<span class="line">nginx -s reload      # 重新加载配置</span>
<span class="line">nginx -s reopen      # 重新打开日志文件</span>
<span class="line">nginx -t             # 测试配置文件语法</span>
<span class="line">nginx -c /path/to/nginx.conf  # 指定配置文件</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="作业-2-虚拟主机配置实践" tabindex="-1"><a class="header-anchor" href="#作业-2-虚拟主机配置实践"><span>作业 2：虚拟主机配置实践</span></a></h2><h3 id="要求-1-单虚拟主机" tabindex="-1"><a class="header-anchor" href="#要求-1-单虚拟主机"><span>要求 1：单虚拟主机</span></a></h3><ul><li>部署 <code>www.linux0224.cc</code></li><li>支持静态资源：png、txt、html</li><li>提供访问 URL 和效果截图</li></ul><h3 id="要求-2-多端口虚拟主机" tabindex="-1"><a class="header-anchor" href="#要求-2-多端口虚拟主机"><span>要求 2：多端口虚拟主机</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># 10.0.0.8:81</span></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">81</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> _</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">root</span> /www/81/</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 10.0.0.8:82</span></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">82</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> _</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">root</span> /www/82/</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="要求-3-多-ip-虚拟主机" tabindex="-1"><a class="header-anchor" href="#要求-3-多-ip-虚拟主机"><span>要求 3：多 IP 虚拟主机</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># 10.0.0.77</span></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> 10.0.0.77:80</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> _</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">root</span> /www/77/</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 10.0.0.78</span></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> 10.0.0.78:80</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> _</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">root</span> /www/78/</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="要求-4-多域名虚拟主机" tabindex="-1"><a class="header-anchor" href="#要求-4-多域名虚拟主机"><span>要求 4：多域名虚拟主机</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># blog.linux0224.cc</span></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> blog.linux0224.cc</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">root</span> /www/blog/</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># movie.linux0224.cc</span></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> movie.linux0224.cc</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">root</span> /www/movie/</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="要求-5-配置管理" tabindex="-1"><a class="header-anchor" href="#要求-5-配置管理"><span>要求 5：配置管理</span></a></h3><ul><li>使用 <code>include</code> 语法统一管理</li><li>配置文件放在 <code>/etc/nginx/extra/</code></li><li>清楚展示请求匹配过程</li></ul><h2 id="作业-3-nginx-模块化功能" tabindex="-1"><a class="header-anchor" href="#作业-3-nginx-模块化功能"><span>作业 3：Nginx 模块化功能</span></a></h2><h3 id="nginx-官方文档" tabindex="-1"><a class="header-anchor" href="#nginx-官方文档"><span>Nginx 官方文档</span></a></h3><ul><li>官网：https://nginx.org/en/docs/</li><li>Windows 部署：https://nginx.org/en/docs/windows.html</li></ul><h3 id="核心功能模块" tabindex="-1"><a class="header-anchor" href="#核心功能模块"><span>核心功能模块</span></a></h3><ul><li><strong>访客日志模块</strong>：记录客户端请求信息</li><li><strong>错误日志模块</strong>：记录服务器错误信息</li></ul><h2 id="作业-4-日志处理与分析" tabindex="-1"><a class="header-anchor" href="#作业-4-日志处理与分析"><span>作业 4：日志处理与分析</span></a></h2><h3 id="生产环境日志实践" tabindex="-1"><a class="header-anchor" href="#生产环境日志实践"><span>生产环境日志实践</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"># 提取日志时间</span>
<span class="line">awk -F &#39;[][]&#39; &#39;{print $2}&#39; /var/log/nginx/access.log</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="日志模块详解" tabindex="-1"><a class="header-anchor" href="#日志模块详解"><span>日志模块详解</span></a></h3><ul><li>官方文档：https://nginx.org/en/docs/http/ngx_http_log_module.html</li></ul><h3 id="nginx-内置变量" tabindex="-1"><a class="header-anchor" href="#nginx-内置变量"><span>Nginx 内置变量</span></a></h3><ul><li>官方文档：https://nginx.org/en/docs/http/ngx_http_core_module.html</li></ul><h3 id="默认日志格式" tabindex="-1"><a class="header-anchor" href="#默认日志格式"><span>默认日志格式</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">log_format</span> main <span class="token string">&#39;<span class="token variable">$remote_addr</span> - <span class="token variable">$remote_user</span> [<span class="token variable">$time_local]</span> &quot;<span class="token variable">$request</span>&quot; &#39;</span></span>
<span class="line">                <span class="token string">&#39;<span class="token variable">$status</span> <span class="token variable">$body_bytes_sent</span> &quot;<span class="token variable">$http_referer</span>&quot; &#39;</span></span>
<span class="line">                <span class="token string">&#39;&quot;<span class="token variable">$http_user_agent</span>&quot; &quot;<span class="token variable">$http_x_forwarded_for</span>&quot;&#39;</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token directive"><span class="token keyword">access_log</span> logs/access.log main</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="变量说明" tabindex="-1"><a class="header-anchor" href="#变量说明"><span>变量说明</span></a></h4><table><thead><tr><th style="text-align:left;">变量</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><code>$remote_addr</code></td><td style="text-align:left;">客户端 IP 地址（可能是代理 IP）</td></tr><tr><td style="text-align:left;"><code>$remote_user</code></td><td style="text-align:left;">远程客户端用户名</td></tr><tr><td style="text-align:left;"><code>$time_local</code></td><td style="text-align:left;">访问时间和时区</td></tr><tr><td style="text-align:left;"><code>$request</code></td><td style="text-align:left;">HTTP 请求起始行</td></tr><tr><td style="text-align:left;"><code>$status</code></td><td style="text-align:left;">HTTP 状态码</td></tr><tr><td style="text-align:left;"><code>$body_bytes_sent</code></td><td style="text-align:left;">响应体字节数</td></tr><tr><td style="text-align:left;"><code>$http_referer</code></td><td style="text-align:left;">来源页面 URL</td></tr><tr><td style="text-align:left;"><code>$http_user_agent</code></td><td style="text-align:left;">客户端浏览器信息</td></tr><tr><td style="text-align:left;"><code>$http_x_forwarded_for</code></td><td style="text-align:left;">客户端真实 IP（需代理配置）</td></tr></tbody></table><h3 id="日志配置实践" tabindex="-1"><a class="header-anchor" href="#日志配置实践"><span>日志配置实践</span></a></h3><h4 id="_1-默认日志配置" tabindex="-1"><a class="header-anchor" href="#_1-默认日志配置"><span>1. 默认日志配置</span></a></h4><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">log_format</span> main <span class="token string">&#39;<span class="token variable">$remote_addr</span> - <span class="token variable">$remote_user</span> [<span class="token variable">$time_local]</span> &quot;<span class="token variable">$request</span>&quot; &#39;</span></span>
<span class="line">                    <span class="token string">&#39;<span class="token variable">$status</span> <span class="token variable">$body_bytes_sent</span> &quot;<span class="token variable">$http_referer</span>&quot; &#39;</span></span>
<span class="line">                    <span class="token string">&#39;&quot;<span class="token variable">$http_user_agent</span>&quot; &quot;<span class="token variable">$http_x_forwarded_for</span>&quot;&#39;</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">access_log</span> /var/log/nginx/access.log main</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-关闭日志功能" tabindex="-1"><a class="header-anchor" href="#_2-关闭日志功能"><span>2. 关闭日志功能</span></a></h4><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-自定义日志格式" tabindex="-1"><a class="header-anchor" href="#_3-自定义日志格式"><span>3. 自定义日志格式</span></a></h4><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">http</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">log_format</span> detailed <span class="token string">&#39;<span class="token variable">$document_uri</span> <span class="token variable">$remote_addr</span> - <span class="token variable">$remote_user</span> [<span class="token variable">$time_local]</span> &quot;<span class="token variable">$request</span>&quot; &#39;</span></span>
<span class="line">                       <span class="token string">&#39;<span class="token variable">$status</span> <span class="token variable">$body_bytes_sent</span> &quot;<span class="token variable">$http_referer</span>&quot; &#39;</span></span>
<span class="line">                       <span class="token string">&#39;&quot;<span class="token variable">$http_user_agent</span>&quot; &quot;<span class="token variable">$http_x_forwarded_for</span>&quot;&#39;</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">access_log</span> /var/log/nginx/access.log detailed</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-虚拟主机单独日志" tabindex="-1"><a class="header-anchor" href="#_4-虚拟主机单独日志"><span>4. 虚拟主机单独日志</span></a></h4><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># dnf.linux0224.cc 虚拟主机</span></span>
<span class="line"><span class="token directive"><span class="token keyword">log_format</span> dnf_format <span class="token string">&#39;<span class="token variable">$document_uri</span> <span class="token variable">$remote_addr</span> - <span class="token variable">$remote_user</span> [<span class="token variable">$time_local]</span> &quot;<span class="token variable">$request</span>&quot; &#39;</span></span>
<span class="line">                     <span class="token string">&#39;<span class="token variable">$status</span> <span class="token variable">$body_bytes_sent</span> &quot;<span class="token variable">$http_referer</span>&quot; &#39;</span></span>
<span class="line">                     <span class="token string">&#39;&quot;<span class="token variable">$http_user_agent</span>&quot; &quot;<span class="token variable">$http_x_forwarded_for</span>&quot;&#39;</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">access_log</span> /var/log/nginx/dnf.linux0224.cc.access.log dnf_format</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">error_log</span> /var/log/nginx/dnf-error.log error</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> dnf.linux0224.cc</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">root</span> /www/dnf/</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-统一管理日志" tabindex="-1"><a class="header-anchor" href="#_5-统一管理日志"><span>5. 统一管理日志</span></a></h4><ul><li>特定虚拟主机：单独配置日志</li><li>其他虚拟主机：使用全局日志配置</li></ul><h3 id="错误日志配置" tabindex="-1"><a class="header-anchor" href="#错误日志配置"><span>错误日志配置</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># 语法</span></span>
<span class="line"><span class="token directive"><span class="token keyword">error_log</span> file [level]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 示例</span></span>
<span class="line"><span class="token directive"><span class="token keyword">error_log</span> /var/log/nginx/error.log error</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 日志级别（详细程度从高到低）</span></span>
<span class="line">debug, info, notice, warn, error, crit, alert</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="错误页面优化" tabindex="-1"><a class="header-anchor" href="#错误页面优化"><span>错误页面优化</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># 40x 错误页面</span></span>
<span class="line"><span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span> /404.html</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token directive"><span class="token keyword">error_page</span> <span class="token number">403</span> /403.html</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 50x 错误页面</span></span>
<span class="line"><span class="token directive"><span class="token keyword">error_page</span> <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span> /50x.html</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 跳转到外部 URL</span></span>
<span class="line"><span class="token directive"><span class="token keyword">error_page</span> <span class="token number">403</span> https://error.taobao.com/app/tbhome/common/error.html</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="实战配置示例" tabindex="-1"><a class="header-anchor" href="#实战配置示例"><span>实战配置示例</span></a></h2><h3 id="完整虚拟主机配置" tabindex="-1"><a class="header-anchor" href="#完整虚拟主机配置"><span>完整虚拟主机配置</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">log_format</span> site_format <span class="token string">&#39;<span class="token variable">$remote_addr</span> - <span class="token variable">$remote_user</span> [<span class="token variable">$time_local]</span> &quot;<span class="token variable">$request</span>&quot; &#39;</span></span>
<span class="line">                      <span class="token string">&#39;<span class="token variable">$status</span> <span class="token variable">$body_bytes_sent</span> &quot;<span class="token variable">$http_referer</span>&quot; &#39;</span></span>
<span class="line">                      <span class="token string">&#39;&quot;<span class="token variable">$http_user_agent</span>&quot; &quot;<span class="token variable">$http_x_forwarded_for</span>&quot;&#39;</span></span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">access_log</span> /var/log/nginx/site.access.log site_format</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">error_log</span> /var/log/nginx/site-error.log error</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">404</span> /my404.html</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">error_page</span> <span class="token number">403</span> /my403.html</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> example.com</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">charset</span> utf-8</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">root</span> /www/site/</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="总结要点" tabindex="-1"><a class="header-anchor" href="#总结要点"><span>总结要点</span></a></h2><ol><li><strong>配置管理</strong>：使用 <code>include</code> 优化配置文件结构</li><li><strong>版本控制</strong>：清楚区分不同安装方式的文件路径</li><li><strong>日志管理</strong>：根据业务需求配置不同级别的日志</li><li><strong>错误处理</strong>：优化错误页面提升用户体验</li><li><strong>请求追踪</strong>：理解请求匹配虚拟主机的完整过程</li></ol>`,61)])])}const r=n(i,[["render",p]]),o=JSON.parse('{"path":"/04-Web%E6%9E%B6%E6%9E%84/02-nginx/nginx%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA%E7%BB%BC%E5%90%88%E5%AE%9E%E6%88%98.html","title":"Nginx 核心功能与配置文件详解","lang":"zh-CN","frontmatter":{},"git":{"contributors":[{"name":"opsjjq","username":"opsjjq","email":"wangyp987@gmail.com","commits":1,"url":"https://github.com/opsjjq"}],"changelog":[{"hash":"ca8e661b7c6729c958583ed3d1a001b6de398273","time":1771558748000,"email":"wangyp987@gmail.com","author":"opsjjq","message":"222"}]},"filePathRelative":"04-Web架构/02-nginx/nginx虚拟主机综合实战.md"}');export{r as comp,o as data};
