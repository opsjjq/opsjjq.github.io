import{_ as e,c as a,e as s,o as n}from"./app-DtXLoKBz.js";const l={};function d(i,t){return n(),a("div",null,[...t[0]||(t[0]=[s(`<h1 id="磁盘管理" tabindex="-1"><a class="header-anchor" href="#磁盘管理"><span>磁盘管理</span></a></h1><h2 id="网站架构与存储" tabindex="-1"><a class="header-anchor" href="#网站架构与存储"><span>网站架构与存储</span></a></h2><p>数据存储是网站架构中的重点之一。在设计存储方案时，需从硬件与软件两个角度综合考虑。</p><h3 id="硬件角度" tabindex="-1"><a class="header-anchor" href="#硬件角度"><span>硬件角度</span></a></h3><ul><li><strong>存储读写性能</strong>：选择固态硬盘（SSD）还是机械硬盘（HDD）。</li><li><strong>数据备份与安全性</strong>：使用RAID磁盘阵列技术提高数据冗余与可靠性。</li><li><strong>数据扩容与容量管理</strong>：合理规划磁盘容量，避免磁盘写满，并制定应对策略。</li></ul><h3 id="软件角度" tabindex="-1"><a class="header-anchor" href="#软件角度"><span>软件角度</span></a></h3><ul><li><strong>系统对存储的优化参数</strong>：如文件系统配置、I/O调度策略等。</li><li><strong>数据库类软件的优化参数</strong>：如MySQL的InnoDB配置、缓存策略等。</li></ul><hr><h2 id="磁盘管理业务背景" tabindex="-1"><a class="header-anchor" href="#磁盘管理业务背景"><span>磁盘管理业务背景</span></a></h2><p>随着数据量不断增长，现有磁盘空间已接近极限。需要新增一块磁盘，将数据迁移至新硬盘，并采用逻辑卷管理（LVM）以支持未来动态扩容。</p><hr><h2 id="磁盘维护业务流程" tabindex="-1"><a class="header-anchor" href="#磁盘维护业务流程"><span>磁盘维护业务流程</span></a></h2><ol><li><strong>数据迁移</strong>：在保证数据库数据完整性的前提下，将用户数据迁移至新硬盘。</li><li><strong>逻辑卷管理</strong>：新硬盘采用LVM管理，便于未来动态扩容，应对数据持续增长。</li></ol><hr><h2 id="windows下的磁盘使用流程" tabindex="-1"><a class="header-anchor" href="#windows下的磁盘使用流程"><span>Windows下的磁盘使用流程</span></a></h2><h3 id="硬盘是什么" tabindex="-1"><a class="header-anchor" href="#硬盘是什么"><span>硬盘是什么</span></a></h3><p>硬盘是计算机中用于持久化存储数据的设备，主流分为机械硬盘（HDD）和固态硬盘（SSD）。与内存不同，硬盘中的数据在关机后仍会保留。硬盘也称为磁盘，因其存储数据与电磁相关，机械硬盘内部由多个盘片组成。</p><p><strong>定义</strong>： 硬盘（Hard Disk Drive, HDD）是利用磁记录技术存储和读取数据的主要存储设备。</p><p><strong>内部结构</strong>：</p><ul><li><strong>盘片</strong>：存储数据的圆形磁性介质。</li><li><strong>磁头</strong>：读写数据的部件，悬浮于盘片上方。</li><li><strong>电机与控制电路</strong>：驱动盘片旋转并协调读写操作。</li></ul><p><strong>接口类型</strong>：</p><ul><li>IDE（ATA）：早期接口，已逐渐淘汰。</li><li>SATA：当前主流接口，传输速度快。</li><li>SCSI：用于服务器和高性能工作站。</li></ul><p><strong>性能指标</strong>：</p><ul><li>存储容量（GB/TB）</li><li>读写速度（MB/s）</li><li>转速（RPM，仅机械硬盘）</li></ul><p><strong>分类</strong>：</p><ul><li>机械硬盘（HDD）：容量大、价格低，适合大容量存储。</li><li>固态硬盘（SSD）：速度快、无机械部件，适合系统与高速应用。</li></ul><hr><h2 id="磁盘使用流程-linux" tabindex="-1"><a class="header-anchor" href="#磁盘使用流程-linux"><span>磁盘使用流程（Linux）</span></a></h2><p>磁盘从接入到可用需经过以下步骤：</p><ol><li>磁盘接入并被系统识别。</li><li>对磁盘进行分区。</li><li>格式化分区并创建文件系统。</li><li>挂载分区到目录，方可存储数据。</li></ol><hr><h2 id="磁盘结构" tabindex="-1"><a class="header-anchor" href="#磁盘结构"><span>磁盘结构</span></a></h2><p>机械硬盘主要由以下五部分组成：</p><ul><li>机械臂</li><li>主轴轴承马达</li><li>磁盘（盘片）</li><li>磁头</li><li>硬盘接口</li></ul><hr><h2 id="磁盘内部原理" tabindex="-1"><a class="header-anchor" href="#磁盘内部原理"><span>磁盘内部原理</span></a></h2><ul><li><strong>扇区（Sector）</strong>：最小物理存储单位，通常为512字节。</li><li><strong>块（Block）</strong>：多个连续扇区组成，是文件系统读写的最小单位（Linux中通常为4KB）。</li></ul><p>操作系统以块为单位进行I/O操作，提高管理效率与读写性能。</p><hr><h2 id="磁盘原理名词" tabindex="-1"><a class="header-anchor" href="#磁盘原理名词"><span>磁盘原理名词</span></a></h2><ul><li><strong>磁头数</strong>：每个盘片对应上下两个磁头。</li><li><strong>磁道</strong>：盘片上的同心圆轨道。</li><li><strong>柱面</strong>：所有盘片上相同位置的磁道组成的柱状区域。</li><li><strong>扇区数</strong>：每个磁道划分的扇形区域，通常为512字节。</li><li><strong>圆盘数</strong>：硬盘内盘片的数量。</li></ul><p><strong>块是操作系统为提高效率而虚拟的概念</strong>，并非物理结构。</p><hr><h2 id="磁盘分区类型-mbr-vs-gpt" tabindex="-1"><a class="header-anchor" href="#磁盘分区类型-mbr-vs-gpt"><span>磁盘分区类型：MBR vs GPT</span></a></h2><table><thead><tr><th style="text-align:left;">特性</th><th style="text-align:left;">MBR</th><th style="text-align:left;">GPT</th></tr></thead><tbody><tr><td style="text-align:left;">最大支持容量</td><td style="text-align:left;">约2TB</td><td style="text-align:left;">远大于2TB</td></tr><tr><td style="text-align:left;">分区数量</td><td style="text-align:left;">最多4个主分区（或3主+1扩）</td><td style="text-align:left;">支持最多128个主分区</td></tr><tr><td style="text-align:left;">分区表大小</td><td style="text-align:left;">固定</td><td style="text-align:left;">动态可调</td></tr><tr><td style="text-align:left;">兼容性</td><td style="text-align:left;">所有系统支持</td><td style="text-align:left;">较新系统和UEFI支持</td></tr></tbody></table><hr><h2 id="linux磁盘命名规则" tabindex="-1"><a class="header-anchor" href="#linux磁盘命名规则"><span>Linux磁盘命名规则</span></a></h2><table><thead><tr><th style="text-align:left;">设备类型</th><th style="text-align:left;">命名规则</th><th style="text-align:left;">示例</th></tr></thead><tbody><tr><td style="text-align:left;">SATA/SCSI/USB</td><td style="text-align:left;"><code>sdX</code></td><td style="text-align:left;"><code>/dev/sda</code></td></tr><tr><td style="text-align:left;">IDE</td><td style="text-align:left;"><code>hdX</code></td><td style="text-align:left;"><code>/dev/hda</code></td></tr><tr><td style="text-align:left;">NVMe</td><td style="text-align:left;"><code>nvmeXnY</code></td><td style="text-align:left;"><code>/dev/nvme0n1</code></td></tr><tr><td style="text-align:left;">RAID阵列</td><td style="text-align:left;"><code>mdX</code></td><td style="text-align:left;"><code>/dev/md0</code></td></tr><tr><td style="text-align:left;">虚拟磁盘</td><td style="text-align:left;"><code>vdX</code></td><td style="text-align:left;"><code>/dev/vda</code></td></tr><tr><td style="text-align:left;">光驱</td><td style="text-align:left;"><code>srX</code></td><td style="text-align:left;"><code>/dev/sr0</code></td></tr></tbody></table><p><strong>分区命名</strong>：</p><ul><li>主分区与扩展分区：<code>sdX1</code>~<code>sdX4</code></li><li>逻辑分区：从<code>sdX5</code>开始</li></ul><p>建议使用UUID或磁盘标签进行挂载，避免设备名变动导致的问题。</p><hr><h2 id="磁盘分区工具" tabindex="-1"><a class="header-anchor" href="#磁盘分区工具"><span>磁盘分区工具</span></a></h2><h3 id="fdisk" tabindex="-1"><a class="header-anchor" href="#fdisk"><span>fdisk</span></a></h3><p>适用于MBR分区表，常用命令：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">fdisk</span> <span class="token parameter variable">-l</span>          <span class="token comment"># 查看分区表</span></span>
<span class="line"><span class="token function">fdisk</span> /dev/sdb    <span class="token comment"># 对新硬盘分区</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="gdisk" tabindex="-1"><a class="header-anchor" href="#gdisk"><span>gdisk</span></a></h3><p>适用于GPT分区表，操作类似fdisk。</p><h3 id="parted" tabindex="-1"><a class="header-anchor" href="#parted"><span>parted</span></a></h3><p>支持MBR与GPT，可用于转换分区表类型：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">parted</span> /dev/sdb</span>
<span class="line">mklabel gpt       <span class="token comment"># 转换为GPT</span></span>
<span class="line">mklabel msdos     <span class="token comment"># 转换为MBR</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="linux挂载分区" tabindex="-1"><a class="header-anchor" href="#linux挂载分区"><span>Linux挂载分区</span></a></h2><p>挂载是将分区连接到目录（挂载点）的过程：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">mount</span> /dev/sdc1 /mnt/data</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>挂载注意事项</strong>：</p><ol><li>一个目录同一时间只能被一个设备挂载。</li><li>一个设备可挂载到多个目录。</li><li>若目录被多个设备挂载，仅显示最后一个设备的数据。</li><li>建议使用空目录作为挂载点，避免原有数据被覆盖。</li></ol><hr><h2 id="主流文件系统介绍" tabindex="-1"><a class="header-anchor" href="#主流文件系统介绍"><span>主流文件系统介绍</span></a></h2><table><thead><tr><th style="text-align:left;">系统</th><th style="text-align:left;">常见文件系统</th></tr></thead><tbody><tr><td style="text-align:left;">Windows</td><td style="text-align:left;">FAT32、exFAT、NTFS、ReFS</td></tr><tr><td style="text-align:left;">macOS</td><td style="text-align:left;">HFS/HFS+、APFS</td></tr><tr><td style="text-align:left;">Linux</td><td style="text-align:left;">Ext2/3/4、XFS、Btrfs</td></tr></tbody></table><p><strong>区别</strong>：</p><ul><li>兼容性：不同系统对文件系统的支持不同。</li><li>容量限制：不同文件系统支持的最大分区与文件大小不同。</li></ul><p><strong>Linux常用</strong>：</p><ul><li><strong>Ext4</strong>：稳定，支持日志功能。</li><li><strong>XFS</strong>：CentOS 7+默认文件系统，支持大容量、高性能。</li></ul><hr><h2 id="linux特殊设备文件" tabindex="-1"><a class="header-anchor" href="#linux特殊设备文件"><span>Linux特殊设备文件</span></a></h2><table><thead><tr><th style="text-align:left;">设备文件</th><th style="text-align:left;">用途</th></tr></thead><tbody><tr><td style="text-align:left;"><code>/dev/null</code></td><td style="text-align:left;">数据黑洞，丢弃所有写入内容</td></tr><tr><td style="text-align:left;"><code>/dev/zero</code></td><td style="text-align:left;">提供无限的空字符流，常用于生成测试文件</td></tr><tr><td style="text-align:left;"><code>/dev/random</code></td><td style="text-align:left;">提供真随机数</td></tr><tr><td style="text-align:left;"><code>/dev/urandom</code></td><td style="text-align:left;">提供伪随机数，速度更快</td></tr></tbody></table><hr><h2 id="磁盘使用实践" tabindex="-1"><a class="header-anchor" href="#磁盘使用实践"><span>磁盘使用实践</span></a></h2><h3 id="光盘弹出" tabindex="-1"><a class="header-anchor" href="#光盘弹出"><span>光盘弹出</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">eject</span>                 <span class="token comment"># 弹出光驱</span></span>
<span class="line"><span class="token function">eject</span> <span class="token parameter variable">-r</span> /dev/sr0     <span class="token comment"># 指定设备弹出</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="自动挂载-etc-fstab" tabindex="-1"><a class="header-anchor" href="#自动挂载-etc-fstab"><span>自动挂载（/etc/fstab）</span></a></h3><p>编辑<code>/etc/fstab</code>，添加如下格式的行：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">UUID=&lt;uuid&gt;  /mount/point  xfs  defaults  0 0</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>使用<code>blkid</code>查看UUID。</p><h3 id="mount选项详解" tabindex="-1"><a class="header-anchor" href="#mount选项详解"><span>mount选项详解</span></a></h3><table><thead><tr><th style="text-align:left;">选项</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><code>ro</code> / <code>rw</code></td><td style="text-align:left;">只读 / 读写</td></tr><tr><td style="text-align:left;"><code>noexec</code></td><td style="text-align:left;">禁止执行二进制文件</td></tr><tr><td style="text-align:left;"><code>nosuid</code></td><td style="text-align:left;">禁止SUID权限生效</td></tr><tr><td style="text-align:left;"><code>noatime</code></td><td style="text-align:left;">不更新访问时间，提升I/O性能</td></tr><tr><td style="text-align:left;"><code>remount</code></td><td style="text-align:left;">重新挂载</td></tr></tbody></table><hr><h2 id="inode与block原理" tabindex="-1"><a class="header-anchor" href="#inode与block原理"><span>inode与block原理</span></a></h2><h3 id="inode-索引节点" tabindex="-1"><a class="header-anchor" href="#inode-索引节点"><span>inode（索引节点）</span></a></h3><p>存储文件的元数据（属性），如权限、所有者、时间戳、大小等。每个文件有唯一的inode编号。</p><h3 id="block-数据块" tabindex="-1"><a class="header-anchor" href="#block-数据块"><span>block（数据块）</span></a></h3><p>存储文件的实际内容。</p><p><strong>文件读取流程</strong>： 文件名 → inode编号 → 定位block → 读取数据。</p><h3 id="查看inode与block信息" tabindex="-1"><a class="header-anchor" href="#查看inode与block信息"><span>查看inode与block信息</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">df</span> <span class="token parameter variable">-i</span>          <span class="token comment"># 查看inode使用情况</span></span>
<span class="line"><span class="token function">df</span> <span class="token parameter variable">-h</span>          <span class="token comment"># 查看block使用情况</span></span>
<span class="line">xfs_info       <span class="token comment"># 查看XFS文件系统信息（仅XFS）</span></span>
<span class="line">dumpe2fs       <span class="token comment"># 查看Ext文件系统信息（仅Ext）</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="软链接与硬链接" tabindex="-1"><a class="header-anchor" href="#软链接与硬链接"><span>软链接与硬链接</span></a></h2><table><thead><tr><th style="text-align:left;">特性</th><th style="text-align:left;">软链接</th><th style="text-align:left;">硬链接</th></tr></thead><tbody><tr><td style="text-align:left;">inode</td><td style="text-align:left;">与源文件不同</td><td style="text-align:left;">与源文件相同</td></tr><tr><td style="text-align:left;">跨分区</td><td style="text-align:left;">支持</td><td style="text-align:left;">不支持</td></tr><tr><td style="text-align:left;">对目录</td><td style="text-align:left;">支持</td><td style="text-align:left;">不支持</td></tr><tr><td style="text-align:left;">删除源文件</td><td style="text-align:left;">链接失效</td><td style="text-align:left;">不影响其他硬链接</td></tr><tr><td style="text-align:left;">创建命令</td><td style="text-align:left;"><code>ln -s 源文件 链接文件</code></td><td style="text-align:left;"><code>ln 源文件 链接文件</code></td></tr></tbody></table><hr><h2 id="raid磁盘阵列技术" tabindex="-1"><a class="header-anchor" href="#raid磁盘阵列技术"><span>RAID磁盘阵列技术</span></a></h2><h3 id="常见raid级别" tabindex="-1"><a class="header-anchor" href="#常见raid级别"><span>常见RAID级别</span></a></h3><ul><li><strong>RAID 0</strong>：条带化，提升性能，无冗余。</li><li><strong>RAID 1</strong>：镜像，提供冗余，性能一般。</li><li><strong>RAID 5</strong>：条带化+分布式校验，兼顾性能与冗余。</li><li><strong>RAID 10</strong>：RAID 1+0，先镜像后条带，高性能高可靠。</li></ul><h3 id="软raid实践-mdadm" tabindex="-1"><a class="header-anchor" href="#软raid实践-mdadm"><span>软RAID实践（mdadm）</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 创建RAID 10</span></span>
<span class="line"><span class="token function">mdadm</span> <span class="token parameter variable">-Cv</span> /dev/md0 <span class="token parameter variable">-a</span> <span class="token function">yes</span> <span class="token parameter variable">-n</span> <span class="token number">4</span> <span class="token parameter variable">-l</span> <span class="token number">10</span> /dev/sdb /dev/sdc /dev/sdd /dev/sde</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 格式化并挂载</span></span>
<span class="line">mkfs.xfs /dev/md0</span>
<span class="line"><span class="token function">mount</span> /dev/md0 /mnt/raid</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看状态</span></span>
<span class="line"><span class="token function">mdadm</span> <span class="token parameter variable">-D</span> /dev/md0</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="生产环境建议" tabindex="-1"><a class="header-anchor" href="#生产环境建议"><span>生产环境建议</span></a></h3><ul><li>物理服务器推荐使用硬件RAID卡。</li><li>云服务器通常由云厂商提供底层存储保障，无需手动配置RAID。</li></ul><hr><h2 id="常见问题与排查" tabindex="-1"><a class="header-anchor" href="#常见问题与排查"><span>常见问题与排查</span></a></h2><h3 id="磁盘空间未释放" tabindex="-1"><a class="header-anchor" href="#磁盘空间未释放"><span>磁盘空间未释放</span></a></h3><ul><li>检查是否有进程占用已删除的文件：<code>lsof | grep deleted</code>。</li><li>执行<code>sync</code>强制写入缓存。</li><li>对于SSD或虚拟化环境，可尝试<code>fstrim</code>。</li></ul><h3 id="挂载目录忙无法卸载" tabindex="-1"><a class="header-anchor" href="#挂载目录忙无法卸载"><span>挂载目录忙无法卸载</span></a></h3><ul><li>离开挂载目录或结束相关进程。</li><li>使用<code>lsof</code>或<code>fuser</code>查看占用进程并结束。</li></ul>`,113)])])}const o=e(l,[["render",d]]),c=JSON.parse('{"path":"/02-Linux%E8%BF%9B%E9%98%B6/01-%E7%A3%81%E7%9B%98%E5%AD%98%E5%82%A8%E7%AE%A1%E7%90%86/%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86.html","title":"磁盘管理","lang":"zh-CN","frontmatter":{},"git":{"contributors":[{"name":"opsjjq","username":"opsjjq","email":"wangyp987@gmail.com","commits":1,"url":"https://github.com/opsjjq"}],"changelog":[{"hash":"ca8e661b7c6729c958583ed3d1a001b6de398273","time":1771558748000,"email":"wangyp987@gmail.com","author":"opsjjq","message":"222"}]},"filePathRelative":"02-Linux进阶/01-磁盘存储管理/磁盘管理.md"}');export{o as comp,c as data};
