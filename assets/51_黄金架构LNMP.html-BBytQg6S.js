import{_ as n,c as a,e,o as l}from"./app-DtXLoKBz.js";const p={};function t(i,s){return l(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="黄金架构-lnmp" tabindex="-1"><a class="header-anchor" href="#黄金架构-lnmp"><span>黄金架构 LNMP</span></a></h1><p>静态网站只需 Nginx 即可；动态网站需要 <strong>Nginx + 编程语言 + 数据库</strong> 的组合。Nginx 通过不同协议将请求转发给后端处理程序（PHP 使用 FastCGI，Python 使用 uWSGI 等）。LNMP 即 Linux + Nginx + MySQL/MariaDB + PHP，是最常见的动态网站黄金架构。</p><hr><h2 id="lnmp-协同工作流程" tabindex="-1"><a class="header-anchor" href="#lnmp-协同工作流程"><span>LNMP 协同工作流程</span></a></h2><p>Nginx 负责处理静态资源请求；<code>.php</code> 等动态请求通过 <strong>FastCGI</strong> 协议转发给 PHP-FPM 处理，PHP 程序再连接 MySQL 数据库进行数据读写。</p><h3 id="核心转发机制对比" tabindex="-1"><a class="header-anchor" href="#核心转发机制对比"><span>核心转发机制对比</span></a></h3><table><thead><tr><th style="text-align:left;">协议/指令</th><th style="text-align:left;">用途</th><th style="text-align:left;">场景</th></tr></thead><tbody><tr><td style="text-align:left;"><code>proxy_pass</code></td><td style="text-align:left;">HTTP 反向代理</td><td style="text-align:left;">Nginx→Nginx/其他 HTTP 服务</td></tr><tr><td style="text-align:left;"><code>fastcgi_pass</code></td><td style="text-align:left;">FastCGI 协议转发</td><td style="text-align:left;">Nginx→PHP</td></tr><tr><td style="text-align:left;"><code>uwsgi_pass</code></td><td style="text-align:left;">uWSGI 协议转发</td><td style="text-align:left;">Nginx→Python</td></tr></tbody></table><p><strong>参考文档</strong>：<a href="https://nginx.org/en/docs/http/ngx_http_fastcgi_module.html" target="_blank" rel="noopener noreferrer">ngx_http_fastcgi_module</a></p><hr><h2 id="部署-nginx-php-环境" tabindex="-1"><a class="header-anchor" href="#部署-nginx-php-环境"><span>部署 Nginx + PHP 环境</span></a></h2><h3 id="_1-创建统一的运行用户" tabindex="-1"><a class="header-anchor" href="#_1-创建统一的运行用户"><span>1. 创建统一的运行用户</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 创建 www 组和用户，指定 UID/GID 为 666</span></span>
<span class="line"><span class="token function">groupadd</span> www <span class="token parameter variable">-g</span> <span class="token number">666</span></span>
<span class="line"><span class="token function">useradd</span> www <span class="token parameter variable">-s</span> /sbin/nologin <span class="token parameter variable">-M</span> <span class="token parameter variable">-u</span> <span class="token number">666</span> <span class="token parameter variable">-g</span> <span class="token number">666</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-安装-nginx-官方源" tabindex="-1"><a class="header-anchor" href="#_2-安装-nginx-官方源"><span>2. 安装 Nginx（官方源）</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 配置 Nginx 官方 yum 源（CentOS 7）</span></span>
<span class="line"><span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/yum.repos.d/nginx.repo <span class="token operator">&lt;&lt;</span> <span class="token string">&#39;EOF&#39;</span>
<span class="line">[nginx-stable]</span>
<span class="line">name=nginx stable repo</span>
<span class="line">baseurl=http://nginx.org/packages/centos/$releasever/$basearch/</span>
<span class="line">gpgcheck=1</span>
<span class="line">enabled=1</span>
<span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span>
<span class="line">EOF</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 清理缓存并安装</span></span>
<span class="line">yum clean all <span class="token operator">&amp;&amp;</span> yum <span class="token function">install</span> nginx <span class="token parameter variable">-y</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启动并设置开机自启</span></span>
<span class="line">systemctl start nginx <span class="token operator">&amp;&amp;</span> systemctl <span class="token builtin class-name">enable</span> nginx</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-安装-php-7-webtatic-源" tabindex="-1"><a class="header-anchor" href="#_3-安装-php-7-webtatic-源"><span>3. 安装 PHP 7（Webtatic 源）</span></a></h3><p>CentOS 7 默认仓库只有 PHP 5.4，建议使用 Webtatic 源安装 PHP 7：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 移除旧版 PHP（如有）</span></span>
<span class="line">yum remove php-mysql-5.4 php php-fpm php-common <span class="token parameter variable">-y</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 添加 EPEL 和 Webtatic 源</span></span>
<span class="line">yum <span class="token function">install</span> epel-release <span class="token parameter variable">-y</span></span>
<span class="line"><span class="token function">rpm</span> <span class="token parameter variable">-Uvh</span> https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</span>
<span class="line"><span class="token function">rpm</span> <span class="token parameter variable">--import</span> https://mirror.webtatic.com/yum/RPM-GPG-KEY-webtatic-andy</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 安装 PHP 7.1 及相关扩展</span></span>
<span class="line">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> php71w-cli php71w-common php71w-fpm php71w-mysqlnd <span class="token punctuation">\\</span></span>
<span class="line">                php71w-gd php71w-mbstring php71w-pdo php71w-xml <span class="token punctuation">\\</span></span>
<span class="line">                php71w-opcache php71w-json</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>网络受限环境解决方案</strong>：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 1. 下载 RPM 包到本地</span></span>
<span class="line">yum <span class="token function">install</span> <span class="token parameter variable">--downloadonly</span> <span class="token parameter variable">--downloaddir</span><span class="token operator">=</span>/path/to/rpms 包名</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. 创建本地仓库</span></span>
<span class="line">createrepo /path/to/rpms</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. 配置本地源</span></span>
<span class="line"><span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/yum.repos.d/local-rpm.repo <span class="token operator">&lt;&lt;</span> <span class="token string">EOF</span>
<span class="line">[local-rpm]</span>
<span class="line">name=Local RPM Repository</span>
<span class="line">baseurl=file:///path/to/rpms</span>
<span class="line">enabled=1</span>
<span class="line">gpgcheck=0</span>
<span class="line">EOF</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 4. 从本地源安装</span></span>
<span class="line">yum <span class="token function">install</span> <span class="token parameter variable">--enablerepo</span><span class="token operator">=</span>local-rpm php71w-*</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-配置-php-fpm-与-nginx-使用相同用户" tabindex="-1"><a class="header-anchor" href="#_4-配置-php-fpm-与-nginx-使用相同用户"><span>4. 配置 PHP-FPM 与 Nginx 使用相同用户</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 修改 PHP-FPM 运行用户</span></span>
<span class="line"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;/^user/c user = www&#39;</span> /etc/php-fpm.d/www.conf</span>
<span class="line"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;/^group/c group = www&#39;</span> /etc/php-fpm.d/www.conf</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启动 PHP-FPM</span></span>
<span class="line">systemctl start php-fpm <span class="token operator">&amp;&amp;</span> systemctl <span class="token builtin class-name">enable</span> php-fpm</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 确认监听端口（默认 127.0.0.1:9000）</span></span>
<span class="line"><span class="token function">netstat</span> <span class="token parameter variable">-tunlp</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">9000</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="部署-mariadb-mysql" tabindex="-1"><a class="header-anchor" href="#部署-mariadb-mysql"><span>部署 MariaDB/MySQL</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 安装 MariaDB（MySQL 的替代品）</span></span>
<span class="line">yum <span class="token function">install</span> mariadb-server mariadb <span class="token parameter variable">-y</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启动并设置开机自启</span></span>
<span class="line">systemctl start mariadb <span class="token operator">&amp;&amp;</span> systemctl <span class="token builtin class-name">enable</span> mariadb</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="mysql-基本操作命令" tabindex="-1"><a class="header-anchor" href="#mysql-基本操作命令"><span>MySQL 基本操作命令</span></a></h3><table><thead><tr><th style="text-align:left;">命令</th><th style="text-align:left;">用途</th><th style="text-align:left;">示例</th></tr></thead><tbody><tr><td style="text-align:left;">修改密码</td><td style="text-align:left;">设置/修改 root 密码</td><td style="text-align:left;"><code>mysqladmin -uroot password &#39;新密码&#39;</code></td></tr><tr><td style="text-align:left;">本地登录</td><td style="text-align:left;">通过 socket 连接</td><td style="text-align:left;"><code>mysql -uroot -p密码</code></td></tr><tr><td style="text-align:left;">远程登录</td><td style="text-align:left;">通过网络连接</td><td style="text-align:left;"><code>mysql -uroot -p -hIP -P3306</code></td></tr><tr><td style="text-align:left;">查看数据库</td><td style="text-align:left;">列出所有数据库</td><td style="text-align:left;"><code>show databases;</code></td></tr><tr><td style="text-align:left;">使用数据库</td><td style="text-align:left;">切换到指定库</td><td style="text-align:left;"><code>use 数据库名;</code></td></tr><tr><td style="text-align:left;">查看表</td><td style="text-align:left;">列出当前库所有表</td><td style="text-align:left;"><code>show tables;</code></td></tr><tr><td style="text-align:left;">查看表结构</td><td style="text-align:left;">显示表字段信息</td><td style="text-align:left;"><code>desc 表名;</code></td></tr><tr><td style="text-align:left;">查询数据</td><td style="text-align:left;">从表中读取数据</td><td style="text-align:left;"><code>select 字段 from 表名;</code></td></tr></tbody></table><hr><h2 id="nginx-配置-php-转发-fastcgi" tabindex="-1"><a class="header-anchor" href="#nginx-配置-php-转发-fastcgi"><span>Nginx 配置 PHP 转发（FastCGI）</span></a></h2><h3 id="基础配置语法" tabindex="-1"><a class="header-anchor" href="#基础配置语法"><span>基础配置语法</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># 转发到 TCP 端口</span></span>
<span class="line"><span class="token directive"><span class="token keyword">fastcgi_pass</span> 127.0.0.1:9000</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 或转发到 Unix Socket（性能更好）</span></span>
<span class="line"><span class="token directive"><span class="token keyword">fastcgi_pass</span> unix:/tmp/fastcgi.socket</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="标准-php-站点配置" tabindex="-1"><a class="header-anchor" href="#标准-php-站点配置"><span>标准 PHP 站点配置</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> www.linux0224.cc</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">root</span> /code</span><span class="token punctuation">;</span>                     <span class="token comment"># 网站根目录</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">index</span> index.php index.html</span><span class="token punctuation">;</span>     <span class="token comment"># 默认索引文件</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># PHP 文件处理</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> ~ \\.php$</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">fastcgi_pass</span> 127.0.0.1:9000</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">fastcgi_index</span> index.php</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment"># 关键：指定 PHP 脚本路径</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">fastcgi_param</span> SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">include</span> fastcgi_params</span><span class="token punctuation">;</span>     <span class="token comment"># 包含其他 FastCGI 参数</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>测试步骤</strong>：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 1. 创建网站目录并设置权限</span></span>
<span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /code <span class="token operator">&amp;&amp;</span> <span class="token function">chown</span> <span class="token parameter variable">-R</span> www.www /code</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. 创建测试 PHP 文件</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&#39;&lt;?php phpinfo(); ?&gt;&#39;</span> <span class="token operator">&gt;</span> /code/test-phpinfo.php</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. 重载 Nginx 配置</span></span>
<span class="line">nginx <span class="token parameter variable">-s</span> reload</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>访问 <code>http://域名/test-phpinfo.php</code> 查看 PHP 信息页面。</p><h3 id="动静态分离配置示例" tabindex="-1"><a class="header-anchor" href="#动静态分离配置示例"><span>动静态分离配置示例</span></a></h3><p>静态资源（图片、文本）由 Nginx 直接处理，动态请求转发给 PHP-FPM。</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">809</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> _</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 静态资源处理</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> ~* \\.(jpg|gif|png|txt)$</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">root</span> /www/static/</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">expires</span> <span class="token number">30d</span></span><span class="token punctuation">;</span>  <span class="token comment"># 浏览器缓存30天</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># 动态请求处理</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">root</span> /code</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">fastcgi_pass</span> 127.0.0.1:9000</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">fastcgi_index</span> index.php</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">fastcgi_param</span> SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">include</span> fastcgi_params</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>准备测试环境</strong>：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 创建目录结构</span></span>
<span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /www/static/ /code</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 准备测试文件</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;Static file content&quot;</span> <span class="token operator">&gt;</span> /www/static/test.txt</span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&#39;&lt;?php echo &quot;Dynamic content&quot;; ?&gt;&#39;</span> <span class="token operator">&gt;</span> /code/index.php</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 设置权限</span></span>
<span class="line"><span class="token function">chown</span> <span class="token parameter variable">-R</span> www.www /code /www/static</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="php-连接-mysql-测试" tabindex="-1"><a class="header-anchor" href="#php-连接-mysql-测试"><span>PHP 连接 MySQL 测试</span></a></h3><p>创建测试文件 <code>/code/test-mysql.php</code>：</p><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php"><pre><code class="language-php"><span class="line"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span>
<span class="line"><span class="token variable">$conn</span> <span class="token operator">=</span> <span class="token function">mysqli_connect</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;root&quot;</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">&quot;123123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;MySQL 连接成功！&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">echo</span> <span class="token string double-quoted-string">&quot;连接失败: &quot;</span> <span class="token operator">.</span> <span class="token function">mysqli_connect_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token delimiter important">?&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>访问该文件，显示&quot;MySQL 连接成功！&quot;即表示 PHP→MySQL 连接正常。</p><hr><h2 id="实际产品部署示例" tabindex="-1"><a class="header-anchor" href="#实际产品部署示例"><span>实际产品部署示例</span></a></h2><h3 id="_1-wecenter-知识社区部署" tabindex="-1"><a class="header-anchor" href="#_1-wecenter-知识社区部署"><span>1. WeCenter 知识社区部署</span></a></h3><p>WeCenter 是前后端不分离的知识问答系统。</p><p><strong>部署步骤</strong>：</p><ol><li><p><strong>下载并解压</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 假设下载文件为 WeCenter_3-6-1.zip</span></span>
<span class="line"><span class="token function">unzip</span> WeCenter_3-6-1.zip <span class="token parameter variable">-d</span> /code/wecenter</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Nginx 配置</strong></p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> wecenter.linux0224.cn</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">root</span> /code/wecenter</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">index</span> index.php index.html</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> ~ \\.php$</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">fastcgi_pass</span> 127.0.0.1:9000</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">fastcgi_index</span> index.php</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">fastcgi_param</span> SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">include</span> fastcgi_params</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>设置权限</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">chown</span> <span class="token parameter variable">-R</span> www.www /code/wecenter</span>
<span class="line">nginx <span class="token parameter variable">-s</span> reload</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>创建数据库</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;CREATE DATABASE wecenter DEFAULT CHARACTER SET utf8mb4;&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>Web 安装</strong></p><ul><li>访问 <code>http://wecenter.linux0224.cn</code></li><li>按照向导填写数据库信息</li><li>完成安装</li></ul></li><li><p><strong>验证数据</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;USE wecenter; SELECT user_name,password FROM aws_users;&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><h3 id="_2-wordpress-博客部署" tabindex="-1"><a class="header-anchor" href="#_2-wordpress-博客部署"><span>2. WordPress 博客部署</span></a></h3><p><strong>部署步骤</strong>：</p><ol><li><p><strong>解压程序</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 假设下载 wordpress-5.9.zip</span></span>
<span class="line"><span class="token function">unzip</span> wordpress-5.9.zip <span class="token parameter variable">-d</span> /code/wordpress</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Nginx 配置</strong></p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> wordpress.linux0224.cn</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">root</span> /code/wordpress</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">index</span> index.php index.html</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment"># WordPress 固定链接支持</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.php?<span class="token variable">$args</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> ~ \\.php$</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">fastcgi_pass</span> 127.0.0.1:9000</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">fastcgi_index</span> index.php</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">fastcgi_param</span> SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">include</span> fastcgi_params</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>设置权限</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">chown</span> <span class="token parameter variable">-R</span> www.www /code/wordpress</span>
<span class="line">nginx <span class="token parameter variable">-s</span> reload</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>创建数据库</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;CREATE DATABASE wordpress DEFAULT CHARACTER SET utf8mb4;&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>客户端配置</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"># 修改本地 hosts 文件（客户端）</span>
<span class="line"># 添加：服务器IP wecenter.linux0224.cn wordpress.linux0224.cn</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Web 安装</strong></p><ul><li>访问 <code>http://wordpress.linux0224.cn</code></li><li>填写数据库信息</li><li>设置站点信息和管理员账号</li></ul></li><li><p><strong>查看数据</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">mysql <span class="token parameter variable">-uroot</span> <span class="token parameter variable">-p</span> <span class="token parameter variable">-e</span> <span class="token string">&#39;USE wordpress; SHOW TABLES; SELECT post_content FROM wp_posts LIMIT 1;&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><hr><h2 id="性能优化建议" tabindex="-1"><a class="header-anchor" href="#性能优化建议"><span>性能优化建议</span></a></h2><ol><li><p><strong>PHP-FPM 配置优化</strong> (<code>/etc/php-fpm.d/www.conf</code>)</p><div class="language-ini line-numbers-mode" data-highlighter="prismjs" data-ext="ini"><pre><code class="language-ini"><span class="line"><span class="token key attr-name">pm</span> <span class="token punctuation">=</span> <span class="token value attr-value">dynamic                    # 进程管理方式</span></span>
<span class="line"><span class="token key attr-name">pm.max_children</span> <span class="token punctuation">=</span> <span class="token value attr-value">50           # 最大子进程数</span></span>
<span class="line"><span class="token key attr-name">pm.start_servers</span> <span class="token punctuation">=</span> <span class="token value attr-value">5           # 启动时进程数</span></span>
<span class="line"><span class="token key attr-name">pm.min_spare_servers</span> <span class="token punctuation">=</span> <span class="token value attr-value">5       # 最小空闲进程</span></span>
<span class="line"><span class="token key attr-name">pm.max_spare_servers</span> <span class="token punctuation">=</span> <span class="token value attr-value">35      # 最大空闲进程</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Nginx 缓存配置</strong></p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># 静态资源缓存</span></span>
<span class="line"><span class="token directive"><span class="token keyword">location</span> ~* \\.(js|css|png|jpg|jpeg|gif|ico)$</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">expires</span> <span class="token number">1y</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">add_header</span> Cache-Control <span class="token string">&quot;public, immutable&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>OPcache 加速</strong> (<code>/etc/php.d/10-opcache.ini</code>)</p><div class="language-ini line-numbers-mode" data-highlighter="prismjs" data-ext="ini"><pre><code class="language-ini"><span class="line"><span class="token key attr-name">opcache.enable</span><span class="token punctuation">=</span><span class="token value attr-value">1</span></span>
<span class="line"><span class="token key attr-name">opcache.memory_consumption</span><span class="token punctuation">=</span><span class="token value attr-value">128</span></span>
<span class="line"><span class="token key attr-name">opcache.interned_strings_buffer</span><span class="token punctuation">=</span><span class="token value attr-value">8</span></span>
<span class="line"><span class="token key attr-name">opcache.max_accelerated_files</span><span class="token punctuation">=</span><span class="token value attr-value">4000</span></span>
<span class="line"><span class="token key attr-name">opcache.revalidate_freq</span><span class="token punctuation">=</span><span class="token value attr-value">60</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>MySQL 基础优化</strong></p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql"><pre><code class="language-sql"><span class="line"><span class="token comment">-- 创建索引提高查询速度</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">INDEX</span> idx_user_name <span class="token keyword">ON</span> aws_users<span class="token punctuation">(</span>user_name<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- 优化表结构</span></span>
<span class="line"><span class="token keyword">OPTIMIZE</span> <span class="token keyword">TABLE</span> wp_posts<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><h2 id="故障排查指南" tabindex="-1"><a class="header-anchor" href="#故障排查指南"><span>故障排查指南</span></a></h2><table><thead><tr><th style="text-align:left;">问题现象</th><th style="text-align:left;">可能原因</th><th style="text-align:left;">解决方案</th></tr></thead><tbody><tr><td style="text-align:left;">502 Bad Gateway</td><td style="text-align:left;">PHP-FPM 未运行或端口错误</td><td style="text-align:left;"><code>systemctl status php-fpm</code>，检查端口监听</td></tr><tr><td style="text-align:left;">403 Forbidden</td><td style="text-align:left;">文件权限问题</td><td style="text-align:left;"><code>chown -R www.www /code</code>，检查文件权限</td></tr><tr><td style="text-align:left;">404 Not Found</td><td style="text-align:left;">文件不存在或路径错误</td><td style="text-align:left;">确认 <code>root</code> 目录和文件路径正确</td></tr><tr><td style="text-align:left;">数据库连接失败</td><td style="text-align:left;">权限或网络问题</td><td style="text-align:left;">检查 MySQL 用户权限、防火墙设置</td></tr><tr><td style="text-align:left;">中文乱码</td><td style="text-align:left;">字符集设置问题</td><td style="text-align:left;">确保数据库、PHP、Nginx 统一使用 UTF-8</td></tr></tbody></table>`,59)])])}const r=n(p,[["render",t]]),d=JSON.parse('{"path":"/04-Web%E6%9E%B6%E6%9E%84/03-lnmp%E6%9E%B6%E6%9E%84/51_%E9%BB%84%E9%87%91%E6%9E%B6%E6%9E%84LNMP.html","title":"黄金架构 LNMP","lang":"zh-CN","frontmatter":{},"git":{"contributors":[{"name":"opsjjq","username":"opsjjq","email":"wangyp987@gmail.com","commits":1,"url":"https://github.com/opsjjq"}],"changelog":[{"hash":"ca8e661b7c6729c958583ed3d1a001b6de398273","time":1771558748000,"email":"wangyp987@gmail.com","author":"opsjjq","message":"222"}]},"filePathRelative":"04-Web架构/03-lnmp架构/51_黄金架构LNMP.md"}');export{r as comp,d as data};
