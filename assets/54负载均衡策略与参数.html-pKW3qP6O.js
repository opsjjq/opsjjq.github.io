import{_ as n,c as a,e,o as l}from"./app-DtXLoKBz.js";const t={};function i(p,s){return l(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="nginx-负载均衡策略与参数" tabindex="-1"><a class="header-anchor" href="#nginx-负载均衡策略与参数"><span>Nginx 负载均衡策略与参数</span></a></h1><h2 id="一、负载均衡策略" tabindex="-1"><a class="header-anchor" href="#一、负载均衡策略"><span>一、负载均衡策略</span></a></h2><h3 id="_1-轮询-round-robin-默认策略" tabindex="-1"><a class="header-anchor" href="#_1-轮询-round-robin-默认策略"><span>1. 轮询（Round Robin） - 默认策略</span></a></h3><ul><li>按请求顺序逐一分配至后端服务器</li><li>自动健康检查：宕机服务器会被自动剔除</li></ul><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">upstream</span> web-pool</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.7:9999</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.8:9999</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-加权轮询-weighted-round-robin" tabindex="-1"><a class="header-anchor" href="#_2-加权轮询-weighted-round-robin"><span>2. 加权轮询（Weighted Round Robin）</span></a></h3><ul><li>根据服务器性能分配权重，权重越高获得越多请求</li><li>解决新旧服务器性能不均问题</li></ul><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">upstream</span> web-pool</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.7 weight=4</span><span class="token punctuation">;</span>  <span class="token comment"># 性能较好</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.8 weight=1</span><span class="token punctuation">;</span>  <span class="token comment"># 性能较弱</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>测试结果示例：</strong></p><ul><li>4:1权重比例下，请求分配约为 80% : 20%</li><li>长期来看保持比例稳定，但非固定顺序</li></ul><h3 id="_3-ip哈希-ip-hash" tabindex="-1"><a class="header-anchor" href="#_3-ip哈希-ip-hash"><span>3. IP哈希（IP Hash）</span></a></h3><ul><li>基于客户端IP计算哈希值，固定分配至同一后端</li><li>适用于需要会话保持的场景</li><li><strong>注意</strong>：不可与权重同时使用</li></ul><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">upstream</span> web-pool</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">ip_hash</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.7</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.8</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>局限性：</strong></p><ul><li>可能造成单节点压力过大</li><li>节点故障时需结合健康检查机制</li></ul><h3 id="_4-其他策略-使用较少" tabindex="-1"><a class="header-anchor" href="#_4-其他策略-使用较少"><span>4. 其他策略（使用较少）</span></a></h3><table><thead><tr><th style="text-align:left;">策略</th><th style="text-align:left;">说明</th><th style="text-align:left;">适用场景</th></tr></thead><tbody><tr><td style="text-align:left;">URL哈希</td><td style="text-align:left;">基于URL哈希值固定分配</td><td style="text-align:left;">缓存优化</td></tr><tr><td style="text-align:left;">最少连接（Least Connections）</td><td style="text-align:left;">分配给当前连接数最少的服务器</td><td style="text-align:left;">长连接场景</td></tr><tr><td style="text-align:left;">最短响应时间（Least Time）</td><td style="text-align:left;">基于响应时间和连接数分配</td><td style="text-align:left;">响应速度优先</td></tr></tbody></table><h2 id="二、负载均衡参数配置" tabindex="-1"><a class="header-anchor" href="#二、负载均衡参数配置"><span>二、负载均衡参数配置</span></a></h2><h3 id="_1-基础参数" tabindex="-1"><a class="header-anchor" href="#_1-基础参数"><span>1. 基础参数</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">upstream</span> web-pool</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment"># 正常服务器</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.7</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># 备份服务器（其他服务器不可用时启用）</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.8 backup</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token comment"># 下线服务器（停止使用）</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.9 down</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-健康检查参数" tabindex="-1"><a class="header-anchor" href="#_2-健康检查参数"><span>2. 健康检查参数</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">upstream</span> web-pool</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.7 max_fails=3 fail_timeout=30s</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.8 max_fails=3 fail_timeout=30s</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>参数说明：</strong></p><ul><li><code>max_fails</code>：允许失败次数（默认1次）</li><li><code>fail_timeout</code>：失败后暂停服务时间</li><li>新版本Nginx有更智能的健康检查机制</li></ul><h3 id="_3-连接限制参数" tabindex="-1"><a class="header-anchor" href="#_3-连接限制参数"><span>3. 连接限制参数</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">upstream</span> web-pool</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.7 max_conns=1000</span><span class="token punctuation">;</span>  <span class="token comment"># 限制最大连接数</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.8 max_conns=1000</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="三、四层-vs-七层负载均衡对比" tabindex="-1"><a class="header-anchor" href="#三、四层-vs-七层负载均衡对比"><span>三、四层 vs 七层负载均衡对比</span></a></h2><table><thead><tr><th style="text-align:left;">特性</th><th style="text-align:left;">四层负载均衡</th><th style="text-align:left;">七层负载均衡</th></tr></thead><tbody><tr><td style="text-align:left;">OSI层级</td><td style="text-align:left;">传输层（TCP/UDP）</td><td style="text-align:left;">应用层（HTTP/HTTPS）</td></tr><tr><td style="text-align:left;">转发依据</td><td style="text-align:left;">IP + 端口</td><td style="text-align:left;">URL、Header、Cookie等</td></tr><tr><td style="text-align:left;">性能</td><td style="text-align:left;">更高（无应用层解析）</td><td style="text-align:left;">相对较低</td></tr><tr><td style="text-align:left;">功能</td><td style="text-align:left;">简单转发</td><td style="text-align:left;">内容识别、重写、缓存等</td></tr><tr><td style="text-align:left;">典型应用</td><td style="text-align:left;">MySQL、Redis、自定义TCP服务</td><td style="text-align:left;">Web网站、API服务</td></tr></tbody></table><h2 id="四、七层负载均衡高级应用" tabindex="-1"><a class="header-anchor" href="#四、七层负载均衡高级应用"><span>四、七层负载均衡高级应用</span></a></h2><h3 id="_1-基于user-agent的设备识别" tabindex="-1"><a class="header-anchor" href="#_1-基于user-agent的设备识别"><span>1. 基于User-Agent的设备识别</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># 定义不同设备的后端池</span></span>
<span class="line"><span class="token directive"><span class="token keyword">upstream</span> android</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.7:33333</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token directive"><span class="token keyword">upstream</span> iphone</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.8:33333</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token directive"><span class="token keyword">upstream</span> pc</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.7:22222</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.8:22222</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> huya.yuchaoit.cn</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment"># 默认PC端</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://pc</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">include</span> proxy_params.conf</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># iPhone用户</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$http_user_agent</span> ~* <span class="token string">&quot;iphone&quot;</span>)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_pass</span> http://iphone</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># Android用户</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$http_user_agent</span> ~* <span class="token string">&quot;android&quot;</span>)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">proxy_pass</span> http://android</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        </span>
<span class="line">        <span class="token comment"># IE浏览器拦截</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$http_user_agent</span> ~* <span class="token string">&quot;msie&quot;</span>)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token directive"><span class="token keyword">return</span> <span class="token number">403</span> <span class="token string">&quot;IE浏览器已淘汰，请升级！&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-后端服务器配置示例" tabindex="-1"><a class="header-anchor" href="#_2-后端服务器配置示例"><span>2. 后端服务器配置示例</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># PC端配置</span></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">22222</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> huya.yuchaoit.cn</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">root</span> /tmp/huya/pc</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Android端配置</span></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">33333</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> huya.yuchaoit.cn</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">root</span> /tmp/huya/android</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># iPhone端配置</span></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">33333</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> huya.yuchaoit.cn</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">root</span> /tmp/huya/iphone</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="五、系统连接数监控" tabindex="-1"><a class="header-anchor" href="#五、系统连接数监控"><span>五、系统连接数监控</span></a></h2><h3 id="_1-查看tcp连接状态" tabindex="-1"><a class="header-anchor" href="#_1-查看tcp连接状态"><span>1. 查看TCP连接状态</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 查看所有ESTABLISHED连接</span></span>
<span class="line">ss <span class="token parameter variable">-an</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-i</span> estab</span>
<span class="line"><span class="token function">netstat</span> <span class="token parameter variable">-an</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-i</span> estab</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 查看特定服务连接</span></span>
<span class="line">ss <span class="token parameter variable">-an</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-i</span> estab <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&#39;10.0.0.7:80&#39;</span></span>
<span class="line"><span class="token function">netstat</span> <span class="token parameter variable">-an</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&#39;10.0.0.7:80&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 统计HTTP连接数</span></span>
<span class="line">ss <span class="token parameter variable">-ant</span> state established sport <span class="token operator">=</span> :80 <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-nginx连接管理" tabindex="-1"><a class="header-anchor" href="#_2-nginx连接管理"><span>2. Nginx连接管理</span></a></h3><ul><li>默认keepalive超时时间为60s</li><li>超时后自动断开，释放连接资源</li><li>可通过<code>keepalive_timeout</code>参数调整</li></ul><h2 id="六、wordpress负载均衡注意事项" tabindex="-1"><a class="header-anchor" href="#六、wordpress负载均衡注意事项"><span>六、WordPress负载均衡注意事项</span></a></h2><h3 id="关键配置要点" tabindex="-1"><a class="header-anchor" href="#关键配置要点"><span>关键配置要点：</span></a></h3><ol><li><strong>统一域名访问</strong>：所有节点使用相同的域名访问</li><li><strong>数据一致性</strong>：后端服务部署必须完全一致</li><li><strong>会话保持</strong>：如需会话保持，考虑使用<code>ip_hash</code>或第三方会话服务</li><li><strong>文件共享</strong>：上传文件需通过共享存储（NFS、对象存储等）</li></ol><h3 id="部署建议" tabindex="-1"><a class="header-anchor" href="#部署建议"><span>部署建议：</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># 负载均衡器配置</span></span>
<span class="line"><span class="token directive"><span class="token keyword">upstream</span> wordpress</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.7:8080</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server</span> 172.16.1.8:8080</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> wordpress.linux0224.cn</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://wordpress</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">include</span> proxy_params.conf</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="七、虚拟主机类型总结" tabindex="-1"><a class="header-anchor" href="#七、虚拟主机类型总结"><span>七、虚拟主机类型总结</span></a></h2><table><thead><tr><th style="text-align:left;">类型</th><th style="text-align:left;">示例配置</th><th style="text-align:left;">访问方式</th></tr></thead><tbody><tr><td style="text-align:left;">基于端口</td><td style="text-align:left;"><code>listen 14455;</code></td><td style="text-align:left;"><code>http://ip:14455</code></td></tr><tr><td style="text-align:left;">基于IP</td><td style="text-align:left;"><code>listen 10.0.0.111:80;</code></td><td style="text-align:left;"><code>http://10.0.0.111</code></td></tr><tr><td style="text-align:left;">基于域名</td><td style="text-align:left;"><code>server_name www.linux0224.cn;</code></td><td style="text-align:left;"><code>http://www.linux0224.cn</code></td></tr><tr><td style="text-align:left;">多域名</td><td style="text-align:left;">多个<code>server_name</code>配置</td><td style="text-align:left;">对应域名访问</td></tr></tbody></table><h2 id="八、生产环境建议" tabindex="-1"><a class="header-anchor" href="#八、生产环境建议"><span>八、生产环境建议</span></a></h2><ol><li><strong>常用策略</strong>：轮询、加权轮询为主</li><li><strong>健康检查</strong>：确保配置有效的健康检查机制</li><li><strong>监控报警</strong>：监控后端节点状态，设置报警</li><li><strong>灰度发布</strong>：结合<code>weight</code>参数实现平滑发布</li><li><strong>连接优化</strong>：根据业务特点调整连接超时参数</li></ol><h2 id="九、命令工具汇总" tabindex="-1"><a class="header-anchor" href="#九、命令工具汇总"><span>九、命令工具汇总</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Nginx操作</span></span>
<span class="line">nginx <span class="token parameter variable">-t</span>              <span class="token comment"># 测试配置</span></span>
<span class="line">nginx <span class="token parameter variable">-s</span> reload       <span class="token comment"># 重载配置</span></span>
<span class="line">systemctl restart nginx <span class="token comment"># 重启服务</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 连接查看</span></span>
<span class="line">ss <span class="token parameter variable">-ant</span>               <span class="token comment"># 查看所有TCP连接</span></span>
<span class="line"><span class="token function">netstat</span> <span class="token parameter variable">-an</span>           <span class="token comment"># 传统方式查看连接</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 测试工具</span></span>
<span class="line"><span class="token function">curl</span> http://目标地址     <span class="token comment"># 基础测试</span></span>
<span class="line"><span class="token function">curl</span> <span class="token parameter variable">-H</span> <span class="token string">&quot;User-Agent: iPhone&quot;</span> http://目标地址  <span class="token comment"># 模拟设备访问</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,49)])])}const d=n(t,[["render",i]]),o=JSON.parse('{"path":"/04-Web%E6%9E%B6%E6%9E%84/04-%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/54%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E7%AD%96%E7%95%A5%E4%B8%8E%E5%8F%82%E6%95%B0.html","title":"Nginx 负载均衡策略与参数","lang":"zh-CN","frontmatter":{},"git":{"contributors":[{"name":"opsjjq","username":"opsjjq","email":"wangyp987@gmail.com","commits":1,"url":"https://github.com/opsjjq"}],"changelog":[{"hash":"ca8e661b7c6729c958583ed3d1a001b6de398273","time":1771558748000,"email":"wangyp987@gmail.com","author":"opsjjq","message":"222"}]},"filePathRelative":"04-Web架构/04-负载均衡/54负载均衡策略与参数.md"}');export{d as comp,o as data};
