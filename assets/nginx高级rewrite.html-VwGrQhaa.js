import{_ as s,c as a,e,o as l}from"./app-DtXLoKBz.js";const i={};function t(p,n){return l(),a("div",null,[...n[0]||(n[0]=[e(`<h1 id="nginx-高级-rewrite-技术" tabindex="-1"><a class="header-anchor" href="#nginx-高级-rewrite-技术"><span>Nginx 高级 Rewrite 技术</span></a></h1><h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述"><span>概述</span></a></h2><p>URL 重写是在服务器端修改请求的 URL 或返回重定向（如整站更换域名 <code>360buy.com</code> → <code>jd.com</code>、HTTP 跳转 HTTPS）。这一功能由 <strong>ngx_http_rewrite_module</strong> 模块实现。</p><table><thead><tr><th style="text-align:left;">指令</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><code>if</code></td><td style="text-align:left;">条件判断</td></tr><tr><td style="text-align:left;"><code>return</code></td><td style="text-align:left;">返回状态码或重定向</td></tr><tr><td style="text-align:left;"><code>set</code></td><td style="text-align:left;">设置变量</td></tr><tr><td style="text-align:left;"><code>break</code></td><td style="text-align:left;">终止当前 rewrite 后续指令</td></tr><tr><td style="text-align:left;"><code>rewrite</code></td><td style="text-align:left;">对请求 URI 进行重写</td></tr></tbody></table><hr><h2 id="if-指令" tabindex="-1"><a class="header-anchor" href="#if-指令"><span>if 指令</span></a></h2><p>写在 <code>server{}</code> 或 <code>location{}</code> 块中，语法为：<code>if (条件) { 动作 }</code>。</p><p><strong>条件符号</strong>：</p><ul><li><code>=</code> 完全匹配（区分大小写）</li><li><code>!=</code> 不等于</li><li><code>~</code> 正则匹配（区分大小写）</li><li><code>~*</code> 正则匹配（不区分大小写）</li></ul><p>常用变量：<code>$http_user_agent</code>（用户代理）、<code>$request_method</code>（请求方法）。</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">location</span> /test-if</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$http_user_agent</span> = huawei)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">echo</span> <span class="token string">&quot;agent is huawei&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$http_user_agent</span> ~ Iphone)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">echo</span> <span class="token string">&quot;agent is Iphone&quot;</span></span><span class="token punctuation">;</span>   <span class="token comment"># 区分大小写</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$http_user_agent</span> ~* Chrome)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">echo</span> <span class="token string">&quot;agent is Chrome&quot;</span></span><span class="token punctuation">;</span>   <span class="token comment"># 不区分大小写</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$request_method</span> != GET)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">echo</span> <span class="token string">&quot;必须是GET方法&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$http_user_agent</span> ~* IE)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">echo</span> <span class="token string">&quot;不支持IE，请用Chrome&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">echo</span> <span class="token string">&quot;未匹配 &gt;&gt;&gt; <span class="token variable">$http_user_agent</span>&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>测试命令</strong>：</p><ul><li><code>curl 10.0.0.8:22555/test-if</code></li><li><code>curl -A &#39;huawei&#39; ...</code> 完全匹配</li><li><code>curl -A &#39;Iphone&#39; ...</code> 匹配 Iphone</li><li><code>curl -X POST ...</code> 触发&quot;必须是GET方法&quot;</li></ul><hr><h2 id="return-指令" tabindex="-1"><a class="header-anchor" href="#return-指令"><span>return 指令</span></a></h2><p>可返回自定义状态码和文本，或进行 301/302 重定向到指定 URL。</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">location</span> = /</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">echo</span> <span class="token string">&quot;welcome&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token directive"><span class="token keyword">location</span> /test-return</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$http_user_agent</span> = huawei)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">return</span> <span class="token number">200</span> <span class="token string">&quot;agent is <span class="token variable">$http_user_agent</span><span class="token escape entity">\\n</span>&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$request_method</span> != GET)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">return</span> <span class="token number">405</span> <span class="token string">&quot;必须GET<span class="token escape entity">\\n</span>&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">if</span> (<span class="token variable">$http_user_agent</span> ~* IE)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> http://yuchaoit.cn/cai.jpg</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">return</span> <span class="token number">404</span> <span class="token string">&quot;sorry<span class="token escape entity">\\n</span>&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> http://yuchaoit.cn/cai.jpg</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token directive"><span class="token keyword">location</span> /ji</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">return</span> <span class="token number">500</span> <span class="token string">&quot;500了<span class="token escape entity">\\n</span>&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>测试结果</strong>：</p><ul><li><code>curl 10.0.0.8:22666/</code> → welcome</li><li><code>curl -A huawei .../test-return</code> → 200</li><li><code>curl -X POST .../test-return</code> → 405</li><li>访问未匹配路径 → 301 到新 URL</li></ul><hr><h2 id="set-指令" tabindex="-1"><a class="header-anchor" href="#set-指令"><span>set 指令</span></a></h2><p>定义变量，后续通过 <code>$变量名</code> 引用。</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">set</span> <span class="token variable">$my_url</span> http://yuchaoit.cn/data/cai.jpg</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token directive"><span class="token keyword">location</span> /test-set</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">return</span> <span class="token number">301</span> <span class="token variable">$my_url</span></span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>访问 <code>/test-set</code> 会 301 重定向到 <code>$my_url</code>。</p><hr><h2 id="break-指令" tabindex="-1"><a class="header-anchor" href="#break-指令"><span>break 指令</span></a></h2><p>终止当前 location 内后续的 rewrite 相关指令（不再执行后面的 if/return/rewrite/set）。</p><p><strong>与 last 的区别</strong>：</p><ul><li><code>break</code>：不重新做 location 匹配，继续执行当前 location 的其他非 rewrite 指令</li><li><code>last</code>：用新的 URI 重新匹配 location（内部跳转）</li></ul><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$my_website</span> yuchaoit.cn</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">echo</span> <span class="token string">&quot;welcome:&quot;</span> <span class="token variable">$my_website</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">break</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">set</span> <span class="token variable">$my_name</span> yuchao</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">echo</span> <span class="token string">&quot;my name is&quot;</span> <span class="token variable">$my_name</span></span><span class="token punctuation">;</span>   <span class="token comment"># 不会执行</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="rewrite-指令" tabindex="-1"><a class="header-anchor" href="#rewrite-指令"><span>rewrite 指令</span></a></h2><p>语法：<code>rewrite regex replacement [flag];</code></p><p><strong>用途</strong>：域名更换、活动页跳转等。跳转时一般会保留 URI 和查询参数。</p><table><thead><tr><th style="text-align:left;">flag</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:left;"><code>permanent</code></td><td style="text-align:left;">301 永久重定向（浏览器会缓存）</td></tr><tr><td style="text-align:left;"><code>redirect</code></td><td style="text-align:left;">302 临时重定向</td></tr><tr><td style="text-align:left;"><code>last</code></td><td style="text-align:left;">用新 URI 重新匹配 location（内部跳转）</td></tr><tr><td style="text-align:left;"><code>break</code></td><td style="text-align:left;">本 location 内不再 rewrite，不重新匹配</td></tr></tbody></table><hr><h3 id="_1-301-永久重定向-换域名" tabindex="-1"><a class="header-anchor" href="#_1-301-永久重定向-换域名"><span>1. 301 永久重定向（换域名）</span></a></h3><p>旧域名 <code>laoliulinux.cc</code> 全站跳转到新域名 <code>linux0224.com</code>。</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># 旧域名服务器配置</span></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> laoliulinux.cc</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">root</span> /laoliu/</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">rewrite</span> / http://linux0224.com permanent</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>新域名需单独配置 <code>server_name linux0224.com</code> 并指定 root。在客户端 hosts 文件中添加：<code>10.0.0.8 laoliulinux.cc linux0224.com</code>。</p><hr><h3 id="_2-302-临时重定向-活动页" tabindex="-1"><a class="header-anchor" href="#_2-302-临时重定向-活动页"><span>2. 302 临时重定向（活动页）</span></a></h3><p><code>www.laoliulinux.cc/phone</code> → <code>phone.laoliulinux.cc</code></p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># 主站配置</span></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> www.laoliulinux.cc</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /phone</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">rewrite</span> / http://phone.laoliulinux.cc redirect</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 活动页专用配置</span></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> phone.laoliulinux.cc</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">root</span> /phone.laoliulinux.cc/</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 hosts 文件中增加 <code>phone.laoliulinux.cc</code>，访问 <code>www.laoliulinux.cc/phone</code> 验证 302 重定向。</p><hr><h3 id="_3-last-多次内部跳转-uri-不变" tabindex="-1"><a class="header-anchor" href="#_3-last-多次内部跳转-uri-不变"><span>3. last：多次内部跳转（URI 不变）</span></a></h3><p>访问 <code>/AAA/xxx</code> → 内部重写为 <code>/BBB/xxx</code> → 再重写为 <code>/CCC/xxx</code>，浏览器地址栏仍显示为 <code>/AAA/xxx</code>。</p><p>使用 <code>$1</code> 等引用正则捕获组。</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># 准备工作：mkdir -p /linux0224/ &amp;&amp; echo &#39;i am ccc&#39; &gt; /linux0224/hello.html</span></span>
<span class="line"></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">30000</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> _</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /CCC</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">alias</span> /linux0224/</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /BBB</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">rewrite</span> ^/BBB/(.*)$ /CCC/<span class="token variable">$1</span> last</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /AAA</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">rewrite</span> ^/AAA/(.*)$ /BBB/<span class="token variable">$1</span> last</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>请求 <code>/AAA/file.txt</code> 会内部经过 <code>/BBB/file.txt</code> 最终由 <code>/CCC</code> 对应的目录响应。</p><hr><h3 id="_4-break-只重写一次" tabindex="-1"><a class="header-anchor" href="#_4-break-只重写一次"><span>4. break：只重写一次</span></a></h3><p>本条 rewrite 执行后不再继续匹配其他 location，需有对应的物理目录和文件。</p><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># 准备工作：mkdir -p /www/{AAA,BBB,CCC} 并在各目录创建 index.html</span></span>
<span class="line"></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">31000</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> _</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /CCC</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">root</span> /www/</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /BBB</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">root</span> /www/</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">rewrite</span> ^/BBB/(.*)$ /CCC/<span class="token variable">$1</span> break</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /AAA</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">root</span> /www/</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">index</span> index.html</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">rewrite</span> ^/AAA/(.*)$ /BBB/<span class="token variable">$1</span> break</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>注意事项</strong>：访问 <code>/AAA/</code> 或 <code>/AAA</code> 时，Nginx 可能先对目录做内部重定向再匹配，表现会与访问 <code>/AAA/文件</code> 不同，建议使用具体文件路径进行测试。</p><hr><h2 id="最佳实践建议" tabindex="-1"><a class="header-anchor" href="#最佳实践建议"><span>最佳实践建议</span></a></h2><ol><li><strong>避免过度使用 if</strong>：if 指令在 Nginx 中效率较低，尽量用 location 匹配替代</li><li><strong>rewrite 优先级</strong>：在同一个 location 中，rewrite 指令按顺序执行，直到遇到合适的 flag</li><li><strong>捕获组使用</strong>：使用 <code>( )</code> 捕获正则表达式部分，通过 <code>$1</code>、<code>$2</code> 引用</li><li><strong>参数保留</strong>：rewrite 默认会保留原始请求的参数，无需额外处理</li><li><strong>性能考虑</strong>： <ul><li>尽量使用 location 匹配而非 if 判断</li><li>避免复杂的正则表达式</li><li>将常用重写规则前置</li></ul></li><li><strong>调试技巧</strong>： <ul><li>使用 <code>echo</code> 指令输出调试信息</li><li>设置 <code>rewrite_log on;</code> 在 error_log 中查看重写过程</li><li>使用 <code>error_log logs/error.log debug;</code> 开启详细调试</li></ul></li></ol>`,59)])])}const o=s(i,[["render",t]]),d=JSON.parse('{"path":"/04-Web%E6%9E%B6%E6%9E%84/02-nginx/nginx%E9%AB%98%E7%BA%A7rewrite.html","title":"Nginx 高级 Rewrite 技术","lang":"zh-CN","frontmatter":{},"git":{"contributors":[{"name":"opsjjq","username":"opsjjq","email":"wangyp987@gmail.com","commits":1,"url":"https://github.com/opsjjq"}],"changelog":[{"hash":"ca8e661b7c6729c958583ed3d1a001b6de398273","time":1771558748000,"email":"wangyp987@gmail.com","author":"opsjjq","message":"222"}]},"filePathRelative":"04-Web架构/02-nginx/nginx高级rewrite.md"}');export{o as comp,d as data};
