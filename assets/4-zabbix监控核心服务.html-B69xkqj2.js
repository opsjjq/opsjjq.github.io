import{_ as n,c as a,e,o as t}from"./app-DtXLoKBz.js";const p={};function l(i,s){return t(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="zabbix监控核心服务实战指南" tabindex="-1"><a class="header-anchor" href="#zabbix监控核心服务实战指南"><span>Zabbix监控核心服务实战指南</span></a></h2><h3 id="一、nginx状态监控" tabindex="-1"><a class="header-anchor" href="#一、nginx状态监控"><span>一、Nginx状态监控</span></a></h3><h4 id="_1-启用nginx-status页面" tabindex="-1"><a class="header-anchor" href="#_1-启用nginx-status页面"><span>1. 启用Nginx Status页面</span></a></h4><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># /etc/nginx/conf.d/status.conf</span></span>
<span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">server_name</span> localhost</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /nginx_status</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">stub_status</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">access_log</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启Nginx：<code>nginx -s reload</code></p><h4 id="_2-编写数据采集脚本" tabindex="-1"><a class="header-anchor" href="#_2-编写数据采集脚本"><span>2. 编写数据采集脚本</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token shebang important">#!/bin/bash</span></span>
<span class="line"><span class="token comment"># /etc/zabbix/zabbix_agentd.d/nginx_status.sh</span></span>
<span class="line"><span class="token assign-left variable">NGINX_COMMAND</span><span class="token operator">=</span><span class="token variable">$1</span></span>
<span class="line"><span class="token assign-left variable">CACHEFILE</span><span class="token operator">=</span><span class="token string">&quot;/tmp/nginx_status.log&quot;</span></span>
<span class="line"><span class="token assign-left variable">CMD</span><span class="token operator">=</span><span class="token string">&quot;/usr/bin/curl http://127.0.0.1/nginx_status&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 缓存管理（60秒更新）</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span> <span class="token variable">$CACHEFILE</span> <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$((</span> $<span class="token punctuation">(</span>date <span class="token operator">+</span><span class="token operator">%</span>s<span class="token punctuation">)</span> <span class="token operator">-</span> $<span class="token punctuation">(</span>stat <span class="token operator">-</span>c <span class="token operator">%</span>Y $CACHEFILE<span class="token punctuation">)</span> <span class="token variable">))</span></span> <span class="token parameter variable">-gt</span> <span class="token number">60</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token variable">$CMD</span> <span class="token operator">&gt;</span> <span class="token variable">$CACHEFILE</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null</span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">case</span> <span class="token variable">$NGINX_COMMAND</span> <span class="token keyword">in</span></span>
<span class="line">    active<span class="token punctuation">)</span>    <span class="token function">grep</span> <span class="token string">&#39;Active&#39;</span> <span class="token variable">$CACHEFILE</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $NF}&#39;</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></span>
<span class="line">    reading<span class="token punctuation">)</span>   <span class="token function">grep</span> <span class="token string">&#39;Reading&#39;</span> <span class="token variable">$CACHEFILE</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $2}&#39;</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></span>
<span class="line">    writing<span class="token punctuation">)</span>   <span class="token function">grep</span> <span class="token string">&#39;Writing&#39;</span> <span class="token variable">$CACHEFILE</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $4}&#39;</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></span>
<span class="line">    waiting<span class="token punctuation">)</span>   <span class="token function">grep</span> <span class="token string">&#39;Waiting&#39;</span> <span class="token variable">$CACHEFILE</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $6}&#39;</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></span>
<span class="line">    accepts<span class="token punctuation">)</span>   <span class="token function">awk</span> <span class="token string">&#39;NR==3&#39;</span> <span class="token variable">$CACHEFILE</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $1}&#39;</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></span>
<span class="line">    handled<span class="token punctuation">)</span>   <span class="token function">awk</span> <span class="token string">&#39;NR==3&#39;</span> <span class="token variable">$CACHEFILE</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $2}&#39;</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></span>
<span class="line">    requests<span class="token punctuation">)</span>  <span class="token function">awk</span> <span class="token string">&#39;NR==3&#39;</span> <span class="token variable">$CACHEFILE</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $3}&#39;</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></span>
<span class="line">    *<span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;Invalid argument&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">exit</span> <span class="token number">2</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">esac</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-agent配置" tabindex="-1"><a class="header-anchor" href="#_3-agent配置"><span>3. Agent配置</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># /etc/zabbix/zabbix_agentd.d/nginx_status.conf</span></span>
<span class="line"><span class="token assign-left variable">UserParameter</span><span class="token operator">=</span>nginx_status<span class="token punctuation">[</span>*<span class="token punctuation">]</span>,/bin/bash /etc/zabbix/zabbix_agentd.d/nginx_status.sh <span class="token variable">$1</span></span>
<span class="line">systemctl restart zabbix-agent</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-zabbix-server测试" tabindex="-1"><a class="header-anchor" href="#_4-zabbix-server测试"><span>4. Zabbix Server测试</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">zabbix_get <span class="token parameter variable">-s</span> <span class="token number">10.0</span>.0.7 <span class="token parameter variable">-k</span> nginx_status<span class="token punctuation">[</span>active<span class="token punctuation">]</span></span>
<span class="line">zabbix_get <span class="token parameter variable">-s</span> <span class="token number">10.0</span>.0.7 <span class="token parameter variable">-k</span> nginx_status<span class="token punctuation">[</span>requests<span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="二、php-fpm状态监控" tabindex="-1"><a class="header-anchor" href="#二、php-fpm状态监控"><span>二、PHP-FPM状态监控</span></a></h3><h4 id="_1-启用php-fpm-status" tabindex="-1"><a class="header-anchor" href="#_1-启用php-fpm-status"><span>1. 启用PHP-FPM Status</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 安装PHP-FPM</span></span>
<span class="line">yum <span class="token function">install</span> php-fpm <span class="token parameter variable">-y</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 修改配置</span></span>
<span class="line"><span class="token function">vim</span> /etc/php-fpm.d/www.conf</span>
<span class="line"><span class="token comment"># 取消注释并修改：</span></span>
<span class="line">pm.status_path <span class="token operator">=</span> /status_php</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-nginx代理配置" tabindex="-1"><a class="header-anchor" href="#_2-nginx代理配置"><span>2. Nginx代理配置</span></a></h4><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token comment"># /etc/nginx/conf.d/status.conf 追加</span></span>
<span class="line"><span class="token directive"><span class="token keyword">location</span> /status_php</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">fastcgi_pass</span> 127.0.0.1:9000</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">fastcgi_param</span> SCRIPT_FILENAME <span class="token variable">$document_root</span><span class="token variable">$fastcgi_script_name</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">include</span> fastcgi_params</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重启服务：<code>systemctl restart php-fpm nginx</code></p><h4 id="_3-数据采集脚本" tabindex="-1"><a class="header-anchor" href="#_3-数据采集脚本"><span>3. 数据采集脚本</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token shebang important">#!/bin/bash</span></span>
<span class="line"><span class="token comment"># /etc/zabbix/zabbix_agentd.d/php_status.sh</span></span>
<span class="line"><span class="token assign-left variable">COMMAND</span><span class="token operator">=</span><span class="token variable">$1</span></span>
<span class="line"><span class="token assign-left variable">CACHEFILE</span><span class="token operator">=</span><span class="token string">&quot;/tmp/php_status.txt&quot;</span></span>
<span class="line"><span class="token assign-left variable">URL</span><span class="token operator">=</span><span class="token string">&quot;http://127.0.0.1/status_php&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 缓存管理</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token parameter variable">-f</span> <span class="token variable">$CACHEFILE</span> <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span> <span class="token variable"><span class="token variable">$((</span> $<span class="token punctuation">(</span>date <span class="token operator">+</span><span class="token operator">%</span>s<span class="token punctuation">)</span> <span class="token operator">-</span> $<span class="token punctuation">(</span>stat <span class="token operator">-</span>c <span class="token operator">%</span>Y $CACHEFILE<span class="token punctuation">)</span> <span class="token variable">))</span></span> <span class="token parameter variable">-gt</span> <span class="token number">60</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token variable">$URL</span> <span class="token operator">&gt;</span> <span class="token variable">$CACHEFILE</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null</span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">case</span> <span class="token string">&quot;<span class="token variable">$COMMAND</span>&quot;</span> <span class="token keyword">in</span></span>
<span class="line">    start_since<span class="token punctuation">)</span>          <span class="token function">awk</span> <span class="token string">&#39;/since/{print $3}&#39;</span> <span class="token variable">$CACHEFILE</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></span>
<span class="line">    accepted_conn<span class="token punctuation">)</span>        <span class="token function">awk</span> <span class="token string">&#39;/accepted/{print $3}&#39;</span> <span class="token variable">$CACHEFILE</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></span>
<span class="line">    listen_queue<span class="token punctuation">)</span>         <span class="token function">awk</span> <span class="token string">&#39;NR==6{print $3}&#39;</span> <span class="token variable">$CACHEFILE</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></span>
<span class="line">    idle_processes<span class="token punctuation">)</span>       <span class="token function">awk</span> <span class="token string">&#39;/idle/{print $3}&#39;</span> <span class="token variable">$CACHEFILE</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></span>
<span class="line">    active_processes<span class="token punctuation">)</span>     <span class="token function">awk</span> <span class="token string">&#39;NR==10{print $3}&#39;</span> <span class="token variable">$CACHEFILE</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></span>
<span class="line">    total_processes<span class="token punctuation">)</span>      <span class="token function">awk</span> <span class="token string">&#39;NR==11{print $3}&#39;</span> <span class="token variable">$CACHEFILE</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></span>
<span class="line">    slow_requests<span class="token punctuation">)</span>        <span class="token function">awk</span> <span class="token string">&#39;NR==14{print $3}&#39;</span> <span class="token variable">$CACHEFILE</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></span>
<span class="line">    check<span class="token punctuation">)</span>                ss <span class="token parameter variable">-tunlp</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-c</span> php-fpm <span class="token punctuation">;</span><span class="token punctuation">;</span></span>
<span class="line">    *<span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;invalid status&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">exit</span> <span class="token number">2</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">esac</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>权限注意</strong>：确保脚本能执行<code>ss</code>命令：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">chmod</span> +s /usr/sbin/ss  <span class="token comment"># 或配置sudo权限</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></blockquote><h4 id="_4-agent配置" tabindex="-1"><a class="header-anchor" href="#_4-agent配置"><span>4. Agent配置</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># /etc/zabbix/zabbix_agentd.d/php_status.conf</span></span>
<span class="line"><span class="token assign-left variable">UserParameter</span><span class="token operator">=</span>php_status<span class="token punctuation">[</span>*<span class="token punctuation">]</span>,/etc/zabbix/zabbix_agentd.d/php_status.sh <span class="token variable">$1</span></span>
<span class="line">systemctl restart zabbix-agent</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_5-测试采集" tabindex="-1"><a class="header-anchor" href="#_5-测试采集"><span>5. 测试采集</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">zabbix_get <span class="token parameter variable">-s</span> <span class="token number">10.0</span>.0.7 <span class="token parameter variable">-k</span> php_status<span class="token punctuation">[</span>total_processes<span class="token punctuation">]</span></span>
<span class="line">zabbix_get <span class="token parameter variable">-s</span> <span class="token number">10.0</span>.0.7 <span class="token parameter variable">-k</span> php_status<span class="token punctuation">[</span>check<span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="三、zabbix-web界面配置" tabindex="-1"><a class="header-anchor" href="#三、zabbix-web界面配置"><span>三、Zabbix Web界面配置</span></a></h3><h4 id="_1-创建监控模板" tabindex="-1"><a class="header-anchor" href="#_1-创建监控模板"><span>1. 创建监控模板</span></a></h4><ol><li><p><strong>配置</strong> → <strong>模板</strong> → <strong>创建模板</strong></p><ul><li>名称：<code>Template App Nginx Status</code></li><li>群组：<code>Templates/Applications</code></li></ul></li><li><p><strong>添加监控项</strong>（以Nginx为例）：</p><table><thead><tr><th style="text-align:left;">名称</th><th style="text-align:left;">键值</th><th style="text-align:left;">应用集</th></tr></thead><tbody><tr><td style="text-align:left;">Nginx Active Connections</td><td style="text-align:left;"><code>nginx_status[active]</code></td><td style="text-align:left;">Nginx Status</td></tr><tr><td style="text-align:left;">Nginx Requests</td><td style="text-align:left;"><code>nginx_status[requests]</code></td><td style="text-align:left;">Nginx Status</td></tr><tr><td style="text-align:left;">Nginx Reading</td><td style="text-align:left;"><code>nginx_status[reading]</code></td><td style="text-align:left;">Nginx Status</td></tr></tbody></table></li><li><p><strong>创建图形</strong>：</p><ul><li>添加多个相关监控项</li><li>实时展示连接状态趋势</li></ul></li></ol><h4 id="_2-设置触发器" tabindex="-1"><a class="header-anchor" href="#_2-设置触发器"><span>2. 设置触发器</span></a></h4><ol><li><p><strong>Nginx请求数过高</strong>：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">名称：Nginx请求数超过阈值</span>
<span class="line">表达式：{Template App Nginx Status:nginx_status[requests].last()} &gt; 30000</span>
<span class="line">严重性：警告</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>PHP-FPM进程异常</strong>：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">名称：PHP-FPM进程异常</span>
<span class="line">表达式：{Template App PHP Status:php_status[check].last()} = 0</span>
<span class="line">严重性：严重</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h4 id="_3-关联主机" tabindex="-1"><a class="header-anchor" href="#_3-关联主机"><span>3. 关联主机</span></a></h4><ul><li>选择目标主机（如web服务器）</li><li><strong>模板</strong>标签页 → <strong>添加</strong> → 选择创建的模板</li></ul><hr><h3 id="四、web可用性监控" tabindex="-1"><a class="header-anchor" href="#四、web可用性监控"><span>四、Web可用性监控</span></a></h3><h4 id="_1-配置web场景" tabindex="-1"><a class="header-anchor" href="#_1-配置web场景"><span>1. 配置Web场景</span></a></h4><ol><li><strong>配置</strong> → <strong>主机</strong> → <strong>Web监测</strong> → <strong>创建Web场景</strong></li><li>填写： <ul><li>名称：<code>Zabbix登录页面检测</code></li><li>应用集：<code>Web Availability</code></li><li>步骤1： <ul><li>名称：<code>访问登录页</code></li><li>URL：<code>http://10.0.0.71/zabbix/</code></li><li>必需状态码：200</li></ul></li></ul></li></ol><h4 id="_2-设置触发器-1" tabindex="-1"><a class="header-anchor" href="#_2-设置触发器-1"><span>2. 设置触发器</span></a></h4><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">名称：Web服务不可访问</span>
<span class="line">表达式：{Template App Web Status:web.test.fail[Zabbix登录页面检测].last()} &gt; 0</span>
<span class="line">严重性：灾难</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="五、最佳实践建议" tabindex="-1"><a class="header-anchor" href="#五、最佳实践建议"><span>五、最佳实践建议</span></a></h3><h4 id="_1-监控项优化" tabindex="-1"><a class="header-anchor" href="#_1-监控项优化"><span>1. 监控项优化</span></a></h4><ul><li><strong>采样间隔</strong>：关键指标30秒，常规指标1-5分钟</li><li><strong>历史数据保留</strong>：30天详细数据，1年趋势数据</li><li><strong>应用集分类</strong>： <ul><li><code>Nginx Connections</code>（连接相关）</li><li><code>Nginx Performance</code>（性能相关）</li><li><code>PHP-FPM Processes</code>（进程相关）</li></ul></li></ul><h4 id="_2-告警策略" tabindex="-1"><a class="header-anchor" href="#_2-告警策略"><span>2. 告警策略</span></a></h4><table><thead><tr><th style="text-align:left;">指标</th><th style="text-align:left;">警告阈值</th><th style="text-align:left;">严重阈值</th></tr></thead><tbody><tr><td style="text-align:left;">Nginx活跃连接</td><td style="text-align:left;">&gt; 1000</td><td style="text-align:left;">&gt; 5000</td></tr><tr><td style="text-align:left;">Nginx请求率</td><td style="text-align:left;">&gt; 1000/秒</td><td style="text-align:left;">&gt; 5000/秒</td></tr><tr><td style="text-align:left;">PHP空闲进程</td><td style="text-align:left;">&lt; 10%</td><td style="text-align:left;">&lt; 5%</td></tr><tr><td style="text-align:left;">PHP慢请求</td><td style="text-align:left;">&gt; 10/分钟</td><td style="text-align:left;">&gt; 50/分钟</td></tr></tbody></table><h4 id="_3-故障排查流程" tabindex="-1"><a class="header-anchor" href="#_3-故障排查流程"><span>3. 故障排查流程</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 1. 检查服务状态</span></span>
<span class="line">systemctl status nginx php-fpm zabbix-agent</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 2. 手动访问状态页</span></span>
<span class="line"><span class="token function">curl</span> http://127.0.0.1/nginx_status</span>
<span class="line"><span class="token function">curl</span> http://127.0.0.1/status_php</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 3. 测试Agent采集</span></span>
<span class="line">zabbix_get <span class="token parameter variable">-s</span> 客户端IP <span class="token parameter variable">-k</span> agent.ping</span>
<span class="line">zabbix_get <span class="token parameter variable">-s</span> 客户端IP <span class="token parameter variable">-k</span> nginx_status<span class="token punctuation">[</span>active<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 4. 查看Zabbix日志</span></span>
<span class="line"><span class="token function">tail</span> <span class="token parameter variable">-f</span> /var/log/zabbix/zabbix_server.log</span>
<span class="line"><span class="token function">tail</span> <span class="token parameter variable">-f</span> /var/log/zabbix/zabbix_agentd.log</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-模板管理" tabindex="-1"><a class="header-anchor" href="#_4-模板管理"><span>4. 模板管理</span></a></h4><ul><li><strong>导出模板</strong>：备份配置</li><li><strong>版本控制</strong>：Git管理模板配置</li><li><strong>批量操作</strong>：使用Zabbix API管理多主机</li></ul><hr><h3 id="六、扩展监控项示例" tabindex="-1"><a class="header-anchor" href="#六、扩展监控项示例"><span>六、扩展监控项示例</span></a></h3><h4 id="_1-nginx扩展监控" tabindex="-1"><a class="header-anchor" href="#_1-nginx扩展监控"><span>1. Nginx扩展监控</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 监控Nginx错误日志</span></span>
<span class="line"><span class="token assign-left variable">UserParameter</span><span class="token operator">=</span>nginx_errors<span class="token punctuation">[</span>*<span class="token punctuation">]</span>,tail <span class="token parameter variable">-100</span> /var/log/nginx/error.log <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-c</span> <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 监控SSL证书过期</span></span>
<span class="line"><span class="token assign-left variable">UserParameter</span><span class="token operator">=</span>ssl_expiry<span class="token punctuation">[</span>*<span class="token punctuation">]</span>,echo <span class="token operator">|</span> openssl s_client <span class="token parameter variable">-connect</span> <span class="token variable">$1</span>:443 <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>/dev/null <span class="token operator">|</span> openssl x509 <span class="token parameter variable">-noout</span> <span class="token parameter variable">-dates</span> <span class="token operator">|</span> <span class="token function">grep</span> notAfter</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-php扩展监控" tabindex="-1"><a class="header-anchor" href="#_2-php扩展监控"><span>2. PHP扩展监控</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 监控PHP内存使用</span></span>
<span class="line"><span class="token assign-left variable">UserParameter</span><span class="token operator">=</span>php_memory,ps aux <span class="token operator">|</span> <span class="token function">grep</span> php-fpm <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{sum+=$6} END {print sum}&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 监控OPCache状态</span></span>
<span class="line"><span class="token assign-left variable">UserParameter</span><span class="token operator">=</span>php_opcache_hit,curl <span class="token parameter variable">-s</span> http://127.0.0.1/opcache-status <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&#39;opcache_hit_rate&#39;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $3}&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="七、总结" tabindex="-1"><a class="header-anchor" href="#七、总结"><span>七、总结</span></a></h3><p>通过本实战指南，我们学习了如何监控Nginx和PHP-FPM等核心服务，包括启用状态页面、编写数据采集脚本、配置Agent、创建监控模板和触发器等。掌握这些技能后，可以构建一个完整的服务监控体系，实现对Web应用和后端服务的全面监控。</p><blockquote><p>下一步：学习Zabbix主动/被动模式与分布式监控，构建大规模监控架构。</p></blockquote>`,59)])])}const o=n(p,[["render",l]]),r=JSON.parse('{"path":"/07-%E7%9B%91%E6%8E%A7%E4%BD%93%E7%B3%BB/01-zabbix%E7%9B%91%E6%8E%A7/4-zabbix%E7%9B%91%E6%8E%A7%E6%A0%B8%E5%BF%83%E6%9C%8D%E5%8A%A1.html","title":"","lang":"zh-CN","frontmatter":{},"git":{"contributors":[{"name":"opsjjq","username":"opsjjq","email":"wangyp987@gmail.com","commits":1,"url":"https://github.com/opsjjq"}],"changelog":[{"hash":"ca8e661b7c6729c958583ed3d1a001b6de398273","time":1771558748000,"email":"wangyp987@gmail.com","author":"opsjjq","message":"222"}]},"filePathRelative":"07-监控体系/01-zabbix监控/4-zabbix监控核心服务.md"}');export{o as comp,r as data};
