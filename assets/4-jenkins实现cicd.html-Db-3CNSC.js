import{_ as a,c as n,e,o as i}from"./app-DtXLoKBz.js";const l={};function r(t,s){return i(),n("div",null,[...s[0]||(s[0]=[e(`<h1 id="jenkins-实现-ci-cd-流水线" tabindex="-1"><a class="header-anchor" href="#jenkins-实现-ci-cd-流水线"><span>Jenkins 实现 CI/CD 流水线</span></a></h1><h2 id="_1-jenkins-简介" tabindex="-1"><a class="header-anchor" href="#_1-jenkins-简介"><span>1. Jenkins 简介</span></a></h2><p>Jenkins 是一个开源的、可扩展的持续集成（CI）和持续交付（CD）引擎，通过自动化构建、测试和部署流程，提高软件开发效率。它提供了丰富的插件生态系统（超过1000个插件），支持与各种开发、测试和部署工具集成。</p><h3 id="主要特性" tabindex="-1"><a class="header-anchor" href="#主要特性"><span>主要特性：</span></a></h3><ul><li><strong>简易安装</strong>：基于 Java 的独立程序，支持 Windows、Mac OS X 和各类 Unix 系统。</li><li><strong>配置简单</strong>：通过 Web 界面轻松配置，支持即时错误检查和内置帮助。</li><li><strong>插件丰富</strong>：通过插件集成 CI/CD 工具链中的几乎所有工具。</li><li><strong>分布式构建</strong>：支持在多台机器上分布式执行任务，加速构建、测试和部署流程。</li></ul><hr><h2 id="_2-传统部署方式-vs-jenkins-自动化部署" tabindex="-1"><a class="header-anchor" href="#_2-传统部署方式-vs-jenkins-自动化部署"><span>2. 传统部署方式 vs Jenkins 自动化部署</span></a></h2><h3 id="传统部署方式" tabindex="-1"><a class="header-anchor" href="#传统部署方式"><span>传统部署方式：</span></a></h3><ul><li>开发人员将代码上传至 Git 仓库（如 GitHub）。</li><li>运维人员手动或通过脚本从服务器下载代码并部署。</li><li>需要编写 Shell 脚本实现拉取代码、环境部署和程序运行。</li></ul><h3 id="jenkins-自动化部署" tabindex="-1"><a class="header-anchor" href="#jenkins-自动化部署"><span>Jenkins 自动化部署：</span></a></h3><ul><li>实现自动化 CI/CD 流水线，从代码提交到部署全流程自动化。</li><li>支持与 GitLab 等代码仓库集成，自动触发构建和部署任务。</li></ul><hr><h2 id="_3-jenkins-安装与配置" tabindex="-1"><a class="header-anchor" href="#_3-jenkins-安装与配置"><span>3. Jenkins 安装与配置</span></a></h2><h3 id="环境准备" tabindex="-1"><a class="header-anchor" href="#环境准备"><span>环境准备：</span></a></h3><ul><li>操作系统：CentOS 7</li><li>IP 地址：10.0.0.100</li><li>默认端口：8080（确保端口未被占用）</li></ul><hr><h3 id="安装步骤" tabindex="-1"><a class="header-anchor" href="#安装步骤"><span>安装步骤：</span></a></h3><ol><li><p><strong>安装 JDK</strong>（Jenkins 基于 Java 开发）：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> jdk-8u181-linux-x64.rpm</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>安装 Jenkins</strong>：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">rpm</span> <span class="token parameter variable">-ivh</span> jenkins-2.499-1.1.noarch.rpm</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>启动 Jenkins</strong>：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">systemctl start jenkins</span>
<span class="line">systemctl <span class="token builtin class-name">enable</span> jenkins</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>检查运行状态</strong>：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">netstat</span> <span class="token parameter variable">-tunlp</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">8080</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><hr><h3 id="配置文件说明" tabindex="-1"><a class="header-anchor" href="#配置文件说明"><span>配置文件说明：</span></a></h3><ul><li><strong>主配置文件</strong>：<code>/etc/sysconfig/jenkins</code></li><li><strong>Jenkins 主目录</strong>：<code>/var/lib/jenkins</code></li><li><strong>日志文件</strong>：<code>/var/log/jenkins/jenkins.log</code></li><li><strong>初始密码文件</strong>：<code>/var/lib/jenkins/secrets/initialAdminPassword</code></li></ul><hr><h3 id="初始访问" tabindex="-1"><a class="header-anchor" href="#初始访问"><span>初始访问：</span></a></h3><ol><li>浏览器访问 <code>http://10.0.0.100:8080</code></li><li>输入初始密码（从上述密码文件中获取）</li><li>安装推荐插件或跳过（建议离线导入插件）</li></ol><hr><h2 id="_4-jenkins-插件管理" tabindex="-1"><a class="header-anchor" href="#_4-jenkins-插件管理"><span>4. Jenkins 插件管理</span></a></h2><h3 id="离线安装插件" tabindex="-1"><a class="header-anchor" href="#离线安装插件"><span>离线安装插件：</span></a></h3><ol><li><p>下载插件包（可从官网或镜像站获取）。</p></li><li><p>解压插件到 <code>/var/lib/jenkins/plugins/</code> 目录。</p></li><li><p>重启 Jenkins 服务：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">systemctl restart jenkins</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><hr><h3 id="修改执行用户-可选" tabindex="-1"><a class="header-anchor" href="#修改执行用户-可选"><span>修改执行用户（可选）：</span></a></h3><p>在 <code>/etc/sysconfig/jenkins</code> 中修改 <code>JENKINS_USER=&quot;root&quot;</code>，重启服务生效。</p><hr><h2 id="_5-基础任务创建与执行" tabindex="-1"><a class="header-anchor" href="#_5-基础任务创建与执行"><span>5. 基础任务创建与执行</span></a></h2><h3 id="创建自由风格任务" tabindex="-1"><a class="header-anchor" href="#创建自由风格任务"><span>创建自由风格任务：</span></a></h3><ol><li>点击&quot;新建任务&quot;，输入任务名称（如 <code>test-job</code>）。</li><li>选择&quot;自由风格项目&quot;，点击确定。</li><li>在&quot;构建&quot;部分添加&quot;执行 Shell&quot;步骤。</li></ol><hr><h3 id="示例-shell-脚本" tabindex="-1"><a class="header-anchor" href="#示例-shell-脚本"><span>示例 Shell 脚本：</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;当前主机名：<span class="token variable"><span class="token variable">$(</span><span class="token function">hostname</span><span class="token variable">)</span></span>&quot;</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;工作目录：<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">pwd</span><span class="token variable">)</span></span>&quot;</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;Jenkins 内置变量：&quot;</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;JOB_NAME: <span class="token variable">\${JOB_NAME}</span>&quot;</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;BUILD_ID: <span class="token variable">\${BUILD_ID}</span>&quot;</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;WORKSPACE: <span class="token variable">\${WORKSPACE}</span>&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h3 id="执行与查看结果" tabindex="-1"><a class="header-anchor" href="#执行与查看结果"><span>执行与查看结果：</span></a></h3><ul><li>点击&quot;立即构建&quot;执行任务。</li><li>查看控制台输出，验证命令执行情况。</li><li>工作区路径：<code>/var/lib/jenkins/workspace/&lt;任务名&gt;/</code></li></ul><hr><h2 id="_6-jenkins-远程执行与免密配置" tabindex="-1"><a class="header-anchor" href="#_6-jenkins-远程执行与免密配置"><span>6. Jenkins 远程执行与免密配置</span></a></h2><h3 id="配置-ssh-免密登录" tabindex="-1"><a class="header-anchor" href="#配置-ssh-免密登录"><span>配置 SSH 免密登录：</span></a></h3><ol><li><p>在 Jenkins 服务器生成 SSH 密钥：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">ssh-keygen <span class="token parameter variable">-t</span> rsa <span class="token parameter variable">-b</span> <span class="token number">2048</span> <span class="token parameter variable">-N</span> <span class="token string">&quot;&quot;</span> <span class="token parameter variable">-f</span> /root/.ssh/id_rsa</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>将公钥复制到目标服务器：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">ssh-copy-id root@10.0.0.7</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol><hr><h3 id="在任务中远程执行命令" tabindex="-1"><a class="header-anchor" href="#在任务中远程执行命令"><span>在任务中远程执行命令：</span></a></h3><p>在 Shell 步骤中添加：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">ssh</span> root@10.0.0.7 <span class="token string">&quot;hostname &amp;&amp; date&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="_7-jenkins-与-gitlab-集成实现-ci-cd" tabindex="-1"><a class="header-anchor" href="#_7-jenkins-与-gitlab-集成实现-ci-cd"><span>7. Jenkins 与 GitLab 集成实现 CI/CD</span></a></h2><h3 id="集成流程" tabindex="-1"><a class="header-anchor" href="#集成流程"><span>集成流程：</span></a></h3><ol><li><strong>开发人员在 GitLab 提交代码</strong>。</li><li><strong>Jenkins 自动拉取代码</strong>。</li><li><strong>执行构建、测试和部署任务</strong>。</li></ol><hr><h3 id="配置步骤" tabindex="-1"><a class="header-anchor" href="#配置步骤"><span>配置步骤：</span></a></h3><h4 id="_1-gitlab-项目准备" tabindex="-1"><a class="header-anchor" href="#_1-gitlab-项目准备"><span>1. GitLab 项目准备：</span></a></h4><ul><li>在 GitLab 创建项目（如 <code>my_flask</code>）。</li><li>开发人员推送 Flask 应用代码至仓库。</li></ul><hr><h4 id="_2-jenkins-任务配置" tabindex="-1"><a class="header-anchor" href="#_2-jenkins-任务配置"><span>2. Jenkins 任务配置：</span></a></h4><ul><li>创建自由风格任务，配置 Git 仓库地址。</li><li>添加认证方式（SSH 密钥或用户名/密码）。</li></ul><hr><h4 id="_3-部署脚本示例-python-flask" tabindex="-1"><a class="header-anchor" href="#_3-部署脚本示例-python-flask"><span>3. 部署脚本示例（Python Flask）：</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token shebang important">#!/bin/bash</span></span>
<span class="line"><span class="token comment"># 部署 Flask 应用到目标服务器</span></span>
<span class="line"><span class="token builtin class-name">cd</span> /opt/linux0224_python/</span>
<span class="line">pip3 <span class="token function">install</span> flask</span>
<span class="line"><span class="token comment"># 停止旧进程</span></span>
<span class="line"><span class="token function">pkill</span> <span class="token parameter variable">-f</span> py1.py</span>
<span class="line"><span class="token comment"># 启动新进程</span></span>
<span class="line"><span class="token function">nohup</span> python3 py1.py <span class="token operator">&gt;</span> nohup.log <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">&amp;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h4 id="_4-jenkins-任务中的部署步骤" tabindex="-1"><a class="header-anchor" href="#_4-jenkins-任务中的部署步骤"><span>4. Jenkins 任务中的部署步骤：</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 发送代码到目标服务器</span></span>
<span class="line"><span class="token function">scp</span> <span class="token parameter variable">-r</span> <span class="token variable">\${WORKSPACE}</span>/* root@10.0.0.7:/opt/linux0224_python/</span>
<span class="line"><span class="token comment"># 执行部署脚本</span></span>
<span class="line"><span class="token function">ssh</span> root@10.0.0.7 <span class="token string">&quot;cd /opt/linux0224_python &amp;&amp; bash deploy.sh&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_8-高级功能与最佳实践" tabindex="-1"><a class="header-anchor" href="#_8-高级功能与最佳实践"><span>8. 高级功能与最佳实践</span></a></h2><h3 id="_1-流水线-pipeline-任务" tabindex="-1"><a class="header-anchor" href="#_1-流水线-pipeline-任务"><span>1. 流水线（Pipeline）任务：</span></a></h3><ul><li>使用 Jenkinsfile 定义完整的 CI/CD 流程。</li><li>支持多阶段、并行执行和错误处理。</li></ul><hr><h3 id="_2-参数化构建" tabindex="-1"><a class="header-anchor" href="#_2-参数化构建"><span>2. 参数化构建：</span></a></h3><ul><li>支持动态输入参数（如版本号、环境变量）。</li><li>提高任务灵活性和复用性。</li></ul><hr><h3 id="_3-分布式构建" tabindex="-1"><a class="header-anchor" href="#_3-分布式构建"><span>3. 分布式构建：</span></a></h3><ul><li>配置多个 Agent 节点，分担构建负载。</li><li>支持不同环境（如 Linux、Windows）的构建任务。</li></ul><hr><h3 id="_4-集成通知" tabindex="-1"><a class="header-anchor" href="#_4-集成通知"><span>4. 集成通知：</span></a></h3><ul><li>配置邮件、Slack 等通知插件。</li><li>实时反馈构建状态。</li></ul><hr><h2 id="_9-故障排除与维护" tabindex="-1"><a class="header-anchor" href="#_9-故障排除与维护"><span>9. 故障排除与维护</span></a></h2><h3 id="常见问题" tabindex="-1"><a class="header-anchor" href="#常见问题"><span>常见问题：</span></a></h3><ol><li><strong>Jenkins 启动失败</strong>：检查端口冲突、Java 环境。</li><li><strong>插件安装失败</strong>：更换镜像源或离线安装。</li><li><strong>Git 拉取失败</strong>：检查网络、认证配置。</li><li><strong>远程执行失败</strong>：检查 SSH 免密配置、防火墙。</li></ol><hr><h3 id="日志查看" tabindex="-1"><a class="header-anchor" href="#日志查看"><span>日志查看：</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">tail</span> <span class="token parameter variable">-f</span> /var/log/jenkins/jenkins.log</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="_10-总结" tabindex="-1"><a class="header-anchor" href="#_10-总结"><span>10. 总结</span></a></h2><p>Jenkins 作为 CI/CD 的核心工具，通过自动化构建、测试和部署流程，显著提升软件交付效率。结合 GitLab 等代码管理工具，可以实现从代码提交到生产部署的全流程自动化。掌握 Jenkins 的基础配置、任务管理和插件使用，是现代化 DevOps 实践的重要技能。</p>`,89)])])}const c=a(l,[["render",r]]),o=JSON.parse('{"path":"/08-CI-CD/01-git%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/4-jenkins%E5%AE%9E%E7%8E%B0cicd.html","title":"Jenkins 实现 CI/CD 流水线","lang":"zh-CN","frontmatter":{},"git":{"contributors":[{"name":"opsjjq","username":"opsjjq","email":"wangyp987@gmail.com","commits":1,"url":"https://github.com/opsjjq"}],"changelog":[{"hash":"ca8e661b7c6729c958583ed3d1a001b6de398273","time":1771558748000,"email":"wangyp987@gmail.com","author":"opsjjq","message":"222"}]},"filePathRelative":"08-CI-CD/01-git版本控制/4-jenkins实现cicd.md"}');export{c as comp,o as data};
