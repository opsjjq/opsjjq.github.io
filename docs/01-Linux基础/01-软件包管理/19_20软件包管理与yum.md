# Linux 软件包管理与 Yum 配置

---

## 一、编程语言与软件包基础

### 1. 代码文件与软件程序

| 概念 | 说明 | 示例 |
|:-----|:-----|:-----|
| **代码文件** | 编程语言编写的源文件 | `.py`, `.go`, `.c`, `.java` |
| **软件程序** | 编译/解释后生成的可执行程序 | `nginx`, `vim`, `python3` |
| **软件包** | 包含程序、配置、文档的集合 | `.rpm`, `.tar.gz`, `.deb` |

### 2. 编程语言类型对比

| 类型 | 特点 | 编译方式 | 示例 | 运维场景 |
|:-----|:-----|:---------|:-----|:---------|
| **编译型语言** | 需编译为二进制文件 | 先编译后运行 | C, C++, Go, Rust | 系统工具开发 |
| **解释型语言** | 需要解释器实时解释 | 边解释边运行 | Python, PHP, Ruby | 快速开发、脚本 |

### 3. 编译与解释过程体验

```bash
# Go语言编译示例
go fmt hello.go        # 格式化代码
go run hello.go        # 直接运行（临时编译）
go build hello.go      # 编译为二进制文件
./hello                # 运行编译后的程序

# Python解释示例
python3 hello.py       # 直接解释执行
```

---

## 二、RPM 包管理

### 1. RPM 基础命令

```bash
# 安装
rpm -ivh package.rpm              # 安装并显示详情
rpm -Uvh package.rpm              # 升级安装
rpm -ivh --force package.rpm      # 强制安装
rpm -ivh --nodeps package.rpm     # 忽略依赖安装（不推荐）

# 查询
rpm -qa                           # 查询所有已安装包
rpm -qa | grep nginx              # 查询指定软件
rpm -qi package_name              # 查询软件包信息
rpm -ql package_name              # 查询软件包安装文件
rpm -qf /path/to/file             # 查询文件所属包

# 卸载
rpm -e package_name              # 卸载软件包
rpm -e --nodeps package_name     # 强制卸载（忽略依赖）
```

### 2. RPM 依赖问题解决

```bash
# 1. 查看依赖关系
rpm -qR package_name            # 查看已安装包的依赖
rpm -qpR package.rpm            # 查看未安装包的依赖

# 2. 安装工具辅助分析
yum install yum-utils
repoquery --requires --resolve package_name  # 解析依赖

# 3. 手工安装依赖（按提示顺序安装）
```

### 3. 本地光盘 RPM 源

```bash
# 挂载光盘
mount /dev/sr0 /mnt

# 查看光盘内容
ls /mnt/Packages/              # RPM包目录
ls /mnt/repodata/              # 仓库元数据

# 从光盘安装软件
rpm -ivh /mnt/Packages/package.rpm
```

---

## 三、源码编译安装

### 1. 编译环境准备

```bash
# C语言编译环境
yum install -y gcc make gcc-c++ ncurses-devel

# Go语言环境
yum install -y golang

# Python开发环境
yum install -y python3 python3-devel

# 常用开发库
yum install -y openssl openssl-devel pcre pcre-devel zlib zlib-devel
```

### 2. 源码编译安装流程

```bash
# 以淘宝 Tengine（Nginx）为例
cd /opt

# 1. 下载源码
wget https://tengine.taobao.org/download/tengine-2.4.0.tar.gz

# 2. 解压
tar -xzvf tengine-2.4.0.tar.gz
cd tengine-2.4.0

# 3. 配置编译选项
./configure --prefix=/opt/nginx --with-http_ssl_module

# 4. 编译安装
make && make install

# 5. 启动服务
/opt/nginx/sbin/nginx
```

### 3. 二进制包安装（Java示例）

```bash
# 1. 下载解压
cd /opt
wget https://download.oracle.com/java/8/jdk-8u221-linux-x64.tar.gz
tar -xzvf jdk-8u221-linux-x64.tar.gz

# 2. 创建软链接
ln -s jdk1.8.0_221 jdk

# 3. 配置环境变量
echo 'export JAVA_HOME=/opt/jdk' >> /etc/profile
echo 'export PATH=$JAVA_HOME/bin:$PATH' >> /etc/profile
source /etc/profile

# 4. 验证安装
java -version
```

---

## 四、YUM 包管理器

### 1. YUM 基础命令

```bash
# 软件管理
yum install package            # 安装软件
yum remove package             # 卸载软件
yum update package             # 更新软件
yum upgrade                    # 升级所有软件
yum check-update               # 检查可用更新

# 查询搜索
yum list installed             # 列出已安装
yum list available             # 列出可用
yum search keyword              # 搜索软件
yum info package               # 查看信息
yum provides /path/to/file     # 查看文件所属包

# 缓存管理
yum clean all                  # 清理缓存
yum makecache                  # 重建缓存
yum history                    # 查看操作历史
```

### 2. YUM 仓库配置

#### 2.1 仓库文件结构

```ini
#/etc/yum.repos.d/name.repo
[repository-id]
name=Repository Name
baseurl=url://path/to/repo
enabled=1                      # 1 启用，0 禁用
gpgcheck=1                     # 1 检查 GPG 签名
gpgkey=url://path/to/key
priority=1                     # 优先级（数字越小优先级越高）
```

#### 2.2 配置网络仓库

```bash
# 配置阿里云源
wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo
wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo

# 清理并重建缓存
yum clean all
yum makecache
```

#### 2.3 配置本地仓库

```bash
# 1. 挂载光盘
mount /dev/sr0 /mnt

# 2. 创建仓库文件
cat > /etc/yum.repos.d/local.repo <<EOF
[local]
name=Local CD-ROM
baseurl=file:///mnt
enabled=1
gpgcheck=0
EOF

# 3. 验证仓库
yum repolist
```

### 3. YUM 高级功能

#### 3.1 下载 RPM 包

```bash
# 方法1：使用 --downloadonly
yum install --downloadonly --downloaddir=/path package

# 方法2：使用 yumdownloader
yum install yum-utils
yumdownloader --destdir=/path package
```

#### 3.2 离线安装包

```bash
# 1. 在有网络环境中下载依赖
mkdir /myrepo
yum install --downloadonly --downloaddir=/myrepo package

# 2. 创建本地仓库
createrepo /myrepo

# 3. 配置本地仓库文件
cat > /etc/yum.repos.d/myrepo.repo <<EOF
[myrepo]
name=My Local Repo
baseurl=file:///myrepo
enabled=1
gpgcheck=0
priority=1
EOF

# 4. 离线安装
yum clean all
yum install package
```

#### 3.3 安装指定版本

```bash
# 以 MySQL 5.6.43 为例
# 1. 配置指定版本仓库
cat > /etc/yum.repos.d/mysql56.repo <<EOF
[mysql56]
name=MySQL 5.6 Community
baseurl=https://repo.mysql.com/yum/mysql-5.6-community/el/7/x86_64/
enabled=1
gpgcheck=0
EOF

# 2. 安装指定版本
yum install mysql-community-server-5.6.43
```

---

## 五、安装方式对比与选择

### 1. 三种安装方式对比

| 方式 | 优点 | 缺点 | 适用场景 |
|:-----|:-----|:-----|:---------|
| **YUM/RPM** | 自动处理依赖、版本管理 | 版本可能较旧 | 生产环境、基础软件 |
| **源码编译** | 最新版本、自定义功能 | 依赖复杂、编译耗时 | 开发环境、特殊需求 |
| **二进制包** | 免编译、快速部署 | 平台依赖、更新慢 | 中间件、大型软件 |

### 2. 选择建议

| 场景 | 推荐方式 | 原因 |
|:-----|:---------|:-----|
| 系统基础软件 | YUM | 自动依赖管理、安全更新 |
| 标准服务程序 | YUM | 版本稳定、易于维护 |
| 生产环境部署 | YUM | 便于批量管理 |
| 需要最新特性 | 源码编译 | 获取最新版本 |
| 需要自定义模块 | 源码编译 | 灵活配置选项 |
| Java、Go等环境 | 二进制包 | 官方预编译 |
| 跨平台部署 | 二进制包 | 无需编译环境 |

### 3. 常见依赖环境

```bash
# 基础编译环境
yum groupinstall "Development Tools"

# Web服务器依赖
yum install openssl-devel pcre-devel zlib-devel

# 数据库依赖
yum install ncurses-devel libaio-devel

# Python开发
yum install python3-devel
```

---

## 六、实用技巧与故障处理

### 1. RPM 包查询技巧

```bash
# 查看软件配置文件
rpm -qc package_name

# 查看软件文档
rpm -qd package_name

# 查看软件安装脚本
rpm -q --scripts package_name

# 验证软件包完整性
rpm -V package_name
```

### 2. YUM 故障排查

```bash
# 1. 缓存问题
rm -rf /var/cache/yum/*
yum clean all
yum makecache

# 2. 仓库问题
yum repolist all                # 查看所有仓库状态
yum --disablerepo="*" --enablerepo="repo" list available  # 测试特定仓库

# 3. 依赖问题
yum deplist package             # 查看依赖关系
yum install --skip-broken      # 跳过损坏包
```

### 3. 常用软件源地址

| 镜像源 | 地址 |
|:-------|:-----|
| 阿里云镜像 | https://mirrors.aliyun.com/ |
| 清华大学镜像 | https://mirrors.tuna.tsinghua.edu.cn/ |
| 网易镜像 | http://mirrors.163.com/ |
| Docker官方 | https://download.docker.com/linux/centos/ |
| MySQL官方 | https://repo.mysql.com/ |
| Nginx官方 | https://nginx.org/packages/ |

### 4. 创建本地软件仓库

```bash
#!/bin/bash
# 创建本地仓库脚本

REPO_DIR="/data/yum_repo"
PACKAGES="nginx redis mysql"

# 1. 创建目录
mkdir -p $REPO_DIR

# 2. 下载软件包
for pkg in $PACKAGES; do
    yum install --downloadonly --downloaddir=$REPO_DIR $pkg
done

# 3. 创建仓库
createrepo $REPO_DIR

# 4. 配置仓库文件
cat > /etc/yum.repos.d/local.repo <<EOF
[local-repo]
name=Local Repository
baseurl=file://$REPO_DIR
enabled=1
gpgcheck=0
priority=1
EOF

echo "本地仓库创建完成: $REPO_DIR"
```

---

## 七、最佳实践总结

### 1. 安装软件前检查

```bash
# 1. 检查系统版本
cat /etc/redhat-release

# 2. 检查架构
uname -m

# 3. 检查磁盘空间
df -h /usr

# 4. 检查依赖
yum deplist package_name
```

### 2. 安装后验证

```bash
# 1. 验证安装
rpm -qa | grep package
which command_name

# 2. 验证配置
service_name --version
service_name -t            # 测试配置（如nginx）

# 3. 验证运行
systemctl status service_name
netstat -tunlp | grep port
```

### 3. 维护建议

| 维护项 | 操作命令 | 说明 |
|:-------|:---------|:-----|
| 定期更新 | `yum update` | 更新所有软件包 |
| 清理无用的包 | `yum autoremove` | 清理不再使用的依赖 |
| 备份配置 | 手动备份 | 记录重要配置路径 |
| 记录操作 | `yum history` | 追踪安装历史 |
| 版本控制 | Git等工具 | 管理配置文件变更 |
