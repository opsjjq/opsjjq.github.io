# Linux 服务管理与常用工具

---

## 一、服务管理基础

### 1. 服务概念

| 服务名 | 对应命令 | 功能说明 |
|:-------|:---------|:---------|
| `crond.service` | `crontab` | 定时任务服务 |
| `ntpd.service` | `ntpdate` | NTP时间同步 |
| `firewalld.service` | `firewall-cmd`、`iptables` | 防火墙服务 |
| `httpd` | - | Apache网站服务 |
| `nginx` | - | Nginx网站服务 |
| `sshd` | - | SSH远程连接服务 |

### 2. 查看服务状态

```bash
# 查看SSH服务状态
systemctl status sshd
netstat -tnlp | grep sshd

# 查看网络服务状态
systemctl status network
```

---

## 二、systemctl 服务管理

### 1. 基本命令

```bash
# 启动/停止/重启/重载/查看状态
systemctl start/stop/restart/reload/status 服务名

# 开机自启管理
systemctl enable 服务名      # 开机自启
systemctl disable 服务名     # 禁止开机自启
systemctl is-enabled 服务名  # 查看是否开机自启

# 列出所有服务
systemctl list-units --type service --all      # 列出所有服务
systemctl list-units --type service            # 只列出运行中的服务
```

### 2. 服务查找与验证

```bash
# 查找服务完整名称
systemctl list-units --type service --all | grep ssh

# 验证服务配置
systemctl cat 服务名      # 查看服务配置
```

---

## 三、网络配置管理

### 1. 网络服务配置流程

```bash
# 1. 进入网卡配置目录
cd /etc/sysconfig/network-scripts/

# 2. 关闭NetworkManager（图形网络管理）
systemctl stop NetworkManager
systemctl disable NetworkManager

# 3. 启动network服务
systemctl start network
systemctl enable network

# 4. 查看IP信息
ip addr
ifconfig
```

### 2. 静态IP配置示例

**NAT网卡配置（eth0）：**

```bash
#/etc/sysconfig/network-scripts/ifcfg-eth0
TYPE=Ethernet
BOOTPROTO=static
NAME=eth0
DEVICE=eth0
ONBOOT=yes
IPADDR=10.0.0.90
NETMASK=255.255.255.0
GATEWAY=10.0.0.254
```

**LAN网卡配置（eth1）：**

```bash
#/etc/sysconfig/network-scripts/ifcfg-eth1
TYPE=Ethernet
BOOTPROTO=static
NAME=eth1
DEVICE=eth1
ONBOOT=yes
IPADDR=172.16.1.90
NETMASK=255.255.255.0
```

**DNS配置：**

```bash
# /etc/resolv.conf
nameserver 223.5.5.5
```

### 3. 重启网络服务

```bash
systemctl restart network
```

---

## 四、SCP文件传输

### 1. 基本语法

```bash
# 发送文件到远程
scp 本地文件路径 用户名@远程IP:远程路径

# 从远程获取文件
scp 用户名@远程IP:远程文件路径 本地路径

# 传输目录（递归）
scp -r 本地目录 用户名@远程IP:远程路径
```

### 2. 使用示例

```bash
# 发送本地文件到远程服务器
scp /home/user/file.txt root@192.168.1.100:/tmp/

# 从远程服务器获取文件
scp root@192.168.1.100:/var/log/messages /home/user/

# 传输整个目录
scp -r /home/user/data root@192.168.1.100:/backup/
```

---

## 五、NTP时间同步服务

### 1. NTP服务配置

```bash
# 安装NTP服务
yum install ntp -y

# 配置NTP服务器
vim /etc/ntp.conf
# 添加阿里云NTP服务器
server ntp.aliyun.com iburst prefer
server ntp1.aliyun.com iburst

# 启动NTP服务
systemctl start ntpd
systemctl enable ntpd

# 查看NTP状态
ntpq -p
```

### 2. 手动时间同步

```bash
# 手动同步时间
ntpdate -u ntp.aliyun.com

# 使用timedatectl
timedatectl set-ntp on      # 开启NTP同步
timedatectl set-ntp off     # 关闭NTP同步
timedatectl status          # 查看时间状态
```

---

## 六、防火墙管理（firewalld）

### 1. 防火墙基础命令

```bash
# 查看防火墙状态
firewall-cmd --get-default-zone        # 查看默认区域
firewall-cmd --list-all                # 查看当前区域配置
firewall-cmd --get-services            # 查看所有支持的服务
firewall-cmd --get-zones               # 查看所有可用区域
```

### 2. 添加/删除规则

```bash
# 添加端口规则
firewall-cmd --add-port=80/tcp         # 临时生效
firewall-cmd --add-port=80/tcp --permanent  # 永久生效

# 添加服务规则
firewall-cmd --add-service=http
firewall-cmd --add-service=ntp

# 删除规则
firewall-cmd --remove-port=80/tcp
firewall-cmd --remove-service=http

# 重新加载配置
firewall-cmd --reload
systemctl restart firewalld
```

### 3. 防火墙配置文件

```bash
# 防火墙配置文件位置
/etc/firewalld/zones/public.xml        # public区域配置

# 查看实际iptables规则
iptables -L                            # 列出所有规则
iptables -L | grep ntp                 # 查找特定规则
```

---

## 七、定时任务（crontab）

### 1. crontab基本命令

```bash
crontab -e        # 编辑当前用户的定时任务
crontab -l        # 列出当前用户的定时任务
crontab -r        # 删除当前用户的所有定时任务
crontab -u 用户名  # 操作指定用户的定时任务
```

### 2. 定时任务格式

```text
分  时  日  月  周  命令
*   *   *   *   *   command
┬   ┬   ┬   ┬   ┬
│   │   │   │   │
│   │   │   │   └─── 星期 (0-7, 0和7都表示周日)
│   │   │   └─────── 月份 (1-12)
│   │   └──────────── 日期 (1-31)
│   └──────────────── 小时 (0-23)
└───────────────────── 分钟 (0-59)
```

### 3. 特殊符号说明

| 符号 | 含义 | 示例 |
|:-----|:-----|:-----|
| `*` | 所有可能的值 | `* * * * *` 表示每分钟 |
| `,` | 指定多个值 | `1,3,5` 表示1、3、5分钟 |
| `-` | 指定范围 | `1-5` 表示1到5分钟 |
| `/` | 指定间隔频率 | `*/10` 表示每10分钟 |

### 4. 定时任务示例

| 表达式 | 说明 |
|:-------|:-----|
| `0 0 * * *` | 每天凌晨执行 |
| `30 * * * *` | 每小时的第30分钟执行 |
| `0 9 * * 1` | 每周一上午9点执行 |
| `0 0 1,15 * *` | 每月1号和15号执行 |
| `0 9-18 * * *` | 每天9点到18点每小时执行 |
| `*/10 * * * *` | 每10分钟执行一次 |

### 5. 定时任务管理

```bash
# 定时任务文件位置
/var/spool/cron/用户名      # 用户定时任务文件
/etc/cron.deny             # 黑名单（禁止使用crontab的用户）
/etc/cron.allow            # 白名单（优先级高于黑名单）

# 查看定时任务日志
tail -f /var/log/cron
```

### 6. 定时任务权限控制

```bash
# 创建黑名单
echo "用户名" >> /etc/cron.deny

# 创建白名单
echo "用户名" >> /etc/cron.allow
```

---

## 八、运维常用命令总结

### 1. 服务启停管理

| 操作 | 命令 | 说明 |
|:-----|:-----|:-----|
| 启动服务 | `systemctl start 服务名` | 启动指定服务 |
| 停止服务 | `systemctl stop 服务名` | 停止指定服务 |
| 重启服务 | `systemctl restart 服务名` | 重启服务 |
| 重载配置 | `systemctl reload 服务名` | 重新加载配置 |
| 查看状态 | `systemctl status 服务名` | 查看服务状态 |
| 开机自启 | `systemctl enable 服务名` | 设置开机自启 |
| 禁止自启 | `systemctl disable 服务名` | 禁止开机自启 |

### 2. 网络相关

| 操作 | 命令 | 说明 |
|:-----|:-----|:-----|
| 查看IP | `ip addr` | 查看网络接口信息 |
| 网络测试 | `ping 主机` | 测试网络连通性 |
| 端口查看 | `netstat -tnlp` | 查看监听端口 |
| 路由查看 | `route -n` | 查看路由表 |
| DNS测试 | `nslookup 域名` | DNS解析测试 |

### 3. 时间管理

| 操作 | 命令 | 说明 |
|:-----|:-----|:-----|
| 设置时间 | `timedatectl set-time "时间"` | 设置系统时间 |
| 时区设置 | `timedatectl set-timezone 时区` | 设置系统时区 |
| NTP同步 | `timedatectl set-ntp on/off` | 开启/关闭NTP |

### 4. 防火墙管理

| 操作 | 命令 | 说明 |
|:-----|:-----|:-----|
| 添加端口 | `firewall-cmd --add-port=端口/协议` | 开放端口 |
| 添加服务 | `firewall-cmd --add-service=服务名` | 开放服务 |
| 永久生效 | 添加 `--permanent` 参数 | 规则永久保存 |
| 重新加载 | `firewall-cmd --reload` | 重新加载配置 |
