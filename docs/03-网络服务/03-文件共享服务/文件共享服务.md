## 一、文件共享方案概览

| 服务方案               | 特点                               | 适用场景                      |
| :--------------------- | :--------------------------------- | :---------------------------- |
| **FTP**                | 提供用户认证机制，标准文件传输协议 | 跨平台文件传输，匿名/认证下载 |
| **Python HTTP Server** | 快速启动，无需配置                 | 临时文件共享，简单测试        |
| **Nginx**              | 提供用户认证，反向代理，负载均衡   | 静态文件服务器，Web服务集成   |
| **Samba**              | Linux-Windows共享，提供用户认证    | 混合环境文件共享，网络驱动器  |
| **NFS**                | Linux之间共享，高性能              | Linux集群，分布式存储         |

**重点学习**：

- NFS（主要生产环境使用）
- Nginx（多功能集成）
- Python HTTP Server（快速临时共享）

## 二、FTP服务搭建

### 服务端部署（vsftpd）

#### 1. 安装软件

```sh
yum install vsftpd -y
```

#### 2. 创建FTP用户

```sh
# 创建系统用户（FTP使用Linux用户认证）
useradd nfs01
echo '123123' | passwd --stdin nfs01
```

#### 3. 修改配置文件

```sh
# 查找配置文件
rpm -ql vsftpd | grep '.conf$'
# 输出：/etc/vsftpd/vsftpd.conf

# 禁用匿名登录（安全考虑）
sed -i 's/^anonymous_enable=YES/anonymous_enable=NO/' /etc/vsftpd/vsftpd.conf

# 添加配置到文件末尾
cat >> /etc/vsftpd/vsftpd.conf << 'EOF'

# 自定义配置（共享文件夹设置）
# local_root: 指定本地用户的默认数据根目录
# chroot_local_user: 禁锢用户到指定目录（禁止切换到其他目录）
# allow_writeable_chroot: 允许用户在禁锢目录中写入数据
local_root=/testftpd/
chroot_local_user=YES
allow_writeable_chroot=YES
EOF
```



#### 4. 创建共享目录并设置权限

```sh
# 创建共享目录
mkdir -p /testftpd/

# 创建测试文件
touch /testftpd/1.png

# 修改目录权限（重要！）
chown -R nfs01:nfs01 /testftpd/
chmod 755 /testftpd/

# 验证权限
ls -ld /testftpd/
# 输出：drwxr-xr-x 2 nfs01 nfs01 56 Dec 10 16:26 /testftpd/
```

#### 5. 启动服务

```sh
systemctl restart vsftpd
systemctl enable vsftpd

# 验证服务状态
ps -ef | grep vsftpd
netstat -tunlp | grep :21
```

### 客户端连接测试

#### Linux客户端

```sh
# 安装FTP客户端
yum install ftp -y

# 连接FTP服务器
ftp 10.0.0.31  # 或 ftp nfs31

# 连接过程示例
ftp> open 10.0.0.31
Name: nfs01
Password: 123123
ftp> ls
ftp> get 1.png  # 下载文件
ftp> put local_file  # 上传文件
ftp> bye        # 退出
```

#### Windows客户端

**命令行方式**：

```
C:\Users\用户名>ftp 10.0.0.31
用户名: nfs01
密码: 123123
ftp> ls
```

**图形化方式**：

1. 打开文件资源管理器
2. 在地址栏输入：`ftp://10.0.0.31/`
3. 输入用户名密码：nfs01 / 123123
4. 即可图形化操作文件

**使用专业工具**：

- FileZilla
- WinSCP
- Xftp

## 三、Samba服务搭建

### 服务端部署

#### 1. 安装软件

```sh
yum install samba -y
```

#### 2. 配置Samba

```sh
# 查看配置文件
ls /etc/samba/
# 输出：lmhosts  smb.conf  smb.conf.example

# 备份原配置文件
cp /etc/samba/smb.conf /etc/samba/smb.conf.bak

# 添加共享配置到文件末尾
cat >> /etc/samba/smb.conf << 'EOF'

[smb_share]                 # 共享名（Windows中显示的名称）
    comment = myself share dir  # 共享描述
    path = /mysmb            # 共享目录路径
    guest ok = no            # 禁止匿名访问
    public = no              # 非公共共享
    writable = yes           # 可写权限
    create mask = 0644       # 创建文件默认权限
    directory mask = 0755    # 创建目录默认权限
EOF
```

#### 3. 创建Samba用户和共享目录

```sh
# 创建系统用户
useradd samba01
echo '123123' | passwd --stdin samba01

# 将系统用户添加为Samba用户
# -a：添加用户，-u：指定用户名
pdbedit -a -u samba01
# 输入密码：123123

# 创建共享目录
mkdir -p /mysmb

# 设置目录权限
chown -R samba01:samba01 /mysmb/
chmod 755 /mysmb/

# 创建测试文件
touch /mysmb/3.png
```

#### 4. 启动服务

```sh
# 启动Samba服务
systemctl start smb
systemctl start nmb  # NetBIOS名称服务
systemctl enable smb nmb

# 验证服务状态
netstat -tunlp | grep smb
# 输出：
# tcp        0      0 0.0.0.0:445             0.0.0.0:*    LISTEN
# tcp        0      0 0.0.0.0:139             0.0.0.0:*    LISTEN

ps -ef | grep smb
```

### Samba防火墙配置（如果需要）

```sh
# 开放Samba端口
firewall-cmd --permanent --add-service=samba
firewall-cmd --reload

# 或手动开放端口
firewall-cmd --permanent --add-port=139/tcp
firewall-cmd --permanent --add-port=445/tcp
firewall-cmd --permanent --add-port=137/udp
firewall-cmd --permanent --add-port=138/udp
firewall-cmd --reload
```



### 客户端连接测试

#### Linux客户端

```sh
# 安装Samba客户端
yum install samba-client -y

# 查看可用的共享
smbclient -L //10.0.0.31/ -U samba01

# 连接共享目录
smbclient //10.0.0.31/smb_share -U samba01
# 输入密码：123123

# Samba客户端常用命令
smb> ?          # 查看所有命令
smb> ls         # 列出文件
smb> get file   # 下载文件
smb> put file   # 上传文件
smb> mkdir dir  # 创建目录
smb> rm file    # 删除文件
smb> exit       # 退出
```

#### Windows客户端

1. **运行窗口方式**：

   - Win + R 打开运行窗口
   - 输入：`\\10.0.0.31\smb_share`
   - 输入用户名：samba01，密码：123123

2. **文件资源管理器**：

   - 打开"此电脑"
   - 地址栏输入：`\\10.0.0.31\smb_share`
   - 或点击"映射网络驱动器"

3. **命令行方式**：

   ```
   net use Z: \\10.0.0.31\smb_share /user:samba01 123123
   ```

   

## 四、Python简易HTTP服务器

### 快速启动文件共享

```sh
# Python 2.x
python -m SimpleHTTPServer 8000

# Python 3.x
python3 -m http.server 8000

# 指定目录共享
cd /path/to/share && python3 -m http.server 8000

# 允许外部访问（默认只允许本地）
python3 -m http.server 8000 --bind 0.0.0.0
```



### 访问方式

- 浏览器访问：`http://服务器IP:8000`
- 支持目录浏览和文件下载
- 无认证机制（适合临时、内部使用）

## 五、Nginx文件服务器

### 基础配置示例

```
server {
    listen       80;
    server_name  fileserver.example.com;
    
    # 开启目录浏览
    autoindex on;
    autoindex_exact_size off;
    autoindex_localtime on;
    
    # 文件下载目录
    location /downloads/ {
        alias /data/files/;
        
        # 添加简单认证
        auth_basic "Restricted Access";
        auth_basic_user_file /etc/nginx/.htpasswd;
    }
    
    # 限制文件类型
    location ~* \.(txt|log|conf)$ {
        deny all;
    }
}
```



### 创建密码文件

```sh
# 安装htpasswd工具
yum install httpd-tools -y

# 创建认证文件
htpasswd -c /etc/nginx/.htpasswd user1
```



## 六、服务对比与选择建议

| 特性           | FTP      | Samba         | Nginx        | Python HTTP |
| :------------- | :------- | :------------ | :----------- | :---------- |
| **认证机制**   | ✓        | ✓             | ✓            | ✗           |
| **跨平台**     | ✓        | ✓（Win友好）  | ✓            | ✓           |
| **性能**       | 中等     | 中等          | 高           | 低          |
| **配置复杂度** | 简单     | 中等          | 中等         | 简单        |
| **适用场景**   | 文件传输 | Win-Linux共享 | 静态文件服务 | 临时共享    |
| **推荐指数**   | ★★★★☆    | ★★★★☆         | ★★★★★        | ★★☆☆☆       |