---
title: 正则表达式
---

## 正则记忆表

![正则表达式速查表1](正则表达式.assets/image-20220405213956490.png)

![正则表达式速查表2](正则表达式.assets/image-20220405214019278.png)

---

## 一、为什么学习正则表达式

### 1. 文本处理效率高

正则表达式提供了一种简洁而强大的方式来描述文本模式，能够快速地匹配、查找、替换符合特定模式的文本内容。

### 2. 广泛应用

| 工具/语言 | 支持情况 |
| :-------- | :------- |
| 编程语言 | Python、Java、JavaScript 等 |
| Linux 工具 | grep、sed、awk 等 |
| 操作系统 | 几乎所有主流系统支持 |

### 3. 数据验证和格式化

| 应用场景 | 示例 |
| :------- | :--- |
| 电话号码验证 | `1[3-9]\d{9}` |
| 邮箱验证 | `[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}` |
| 日期格式转换 | 将 "YYYY-MM-DD" 转换为 "MM/DD/YYYY" |

---

## 二、什么是正则表达式

### 定义

为处理大量字符串而定义的一套规则和方法，通过特殊符号快速过滤（grep）、替换（sed）、格式化输出（awk）所需字符串。

### 特点

- **以行为单位处理**（Linux 正则的一般特性）
- **模式匹配**：数据匹配模式则被接受，不匹配则被过滤

---

## 三、字符集设置

```sh
export LC_ALL=C                              # 设置字符集为英文
export LC_ALL=en_US.UTF-8                    # 设置字符集为英文
export LC_ALL=zh_CN.UTF-8                    # 设置字符集为中文
```

---

## 四、正则表达式分类

### POSIX 标准下的两类正则引擎

| 类型 | 名称 | 元字符 | 说明 |
| :--- | :--- | :--- | :--- |
| **BRE** | 基础正则表达式 | `^ $ . [ ] *` + `\`（转义其他） | 基本匹配功能 |
| **ERE** | 扩展正则表达式 | BRE + `( ) { } ? + |` | 增强功能，更易用 |

**说明**：

- **POSIX**：可移植操作系统接口标准，确保 Unix-like 系统兼容性
- **BRE**：其他符号默认为普通字符，需用 `\` 转义为元字符
- **ERE**：增加了更多元字符，功能更强大

---

## 五、基础正则表达式（BRE）

### 测试数据

```sh
cat -n t.txt
```

```text
1  I am teacher test.
2  I teach linux,python!
3  
4  I like english
5  
6  My website is http://testit.cn
7  Our school site is https://test.com
8  My qq num is 877348180
9  
10 Good good study , day day up!
11 
12 
13 
14 my name is aaa
```

### 1. `^` 行首匹配

```sh
grep '^m' t.txt             # 输出匹配行
grep '^m' t.txt -n          # 显示行号
grep '^m' t.txt -o          # 只输出匹配部分
grep '^m' t.txt -in         # 忽略大小写并显示行号
```

### 2. `$` 行尾匹配

```sh
grep '\.$' t.txt -n        # 匹配以点结尾的行
```

### 3. `^$` 匹配空行

```sh
grep '^$' t.txt            # 匹配空行
```

### 4. `.` 点符号

- 匹配除换行符外的任意单个字符
- **注意**：在 BRE 中，点就是字面点，不是元字符

### 5. `*` 星号（BRE 中的星号）

- 匹配前一个字符 0 次或多次
- `p*`：匹配 0 个或多个 p 字符的行

### 6. `.*` 匹配任意内容

```sh
grep '.*' bai.txt          # 匹配所有非空行
grep '.*' bai.txt -o       # 只输出匹配部分
grep '.*' bai.txt -on      # 显示行号和匹配部分
```

**实践建议**：

- 匹配整行：使用 `^.*$`
- 匹配所有内容：`.*` 通常足够
- 替换操作中：`^.*` 更安全，确保从行首开始

---

## 六、扩展正则表达式（ERE）

```sh
grep -E 等同于 egrep

# 三种写法等价
grep -E 'a{1,3}' file
egrep 'a{1,3}' file
grep 'a\{1,3\}' file  # BRE 基础正则需要转义
```

### 1. `{ }` 花括号 - 指定重复次数

| 模式 | 含义 | 示例 |
| :--- | :--- | :--- |
| `{n}` | 精确匹配 n 次 | `a{3}` → aaa |
| `{n,}` | 至少匹配 n 次 | `a{2,}` → aa, aaa, aaaa... |
| `{n,m}` | 匹配 n 到 m 次 | `a{2,4}` → aa, aaa, aaaa |
| `{,m}` | 最多匹配 m 次 | `a{,3}` → "", a, aa, aaa |

**示例**：

```sh
grep -Eo '1[3-9][0-9]{9}' file.txt               # 匹配手机号（中国）
grep -E '\bg[a-z]{,2}d\b|\bd[a-z]{,2}y\b' t.txt -o  # 匹配单词边界内的模式
```

**说明**：`grep -w` 可实现单词边界匹配

### 2. `+` 加号

- 前一个字符至少出现 1 次
- `[0-9]+`：匹配一串连续数字

### 3. `?` 问号

- 前一个字符出现 0 次或 1 次
- `colou?r`：匹配 color 或 colour

### 4. `|` 或符号

- 匹配左右任意一项

```sh
grep -E 'apple|orange' file.txt
```

### 5. `( )` 括号 - 分组与向后引用

**功能**：

1. 将多个字符作为整体处理
2. 创建子表达式用于量词
3. 向后引用（backreference）

**向后引用示例**：

```sh
grep -E '(\b\w+\b).*\1' file.txt                 # 匹配重复单词
grep -E '^([a-zA-Z0-9]+).*/\1$' /etc/passwd     # 提取用户名和登录解释器相同的行
```

**输出示例**：

```text
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
```

**说明**：`\1` 引用第一个分组匹配的内容

---

## 七、BRE 与 ERE 元字符对比

| 功能 | BRE | ERE |
| :--- | :--- | :--- |
| 行首 | `^` | `^` |
| 行尾 | `$` | `$` |
| 任意字符 | `.` | `.` |
| 前字符 0 次或多次 | `*` | `*` |
| 字符类 | `[ ]` | `[ ]` |
| 转义 | `\` | `\` |
| 前字符至少 1 次 | `\+` | `+` |
| 前字符 0 或 1 次 | `\?` | `?` |
| 指定次数 | `\{n,m\}` | `{n,m}` |
| 分组 | `\( \)` | `( )` |
| 或运算 | `|` | `|` |

---

## 八、实用技巧总结

### 1. 选择正则类型

| 场景 | 推荐类型 | 命令 |
| :--- | :--- | :--- |
| 简单匹配 | BRE（默认） | `grep 'pattern'` |
| 复杂模式 | ERE | `grep -E 'pattern'` |

### 2. 常用模式示例

```sh
grep -E '[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}'  # 邮箱匹配
grep -E '([0-9]{1,3}\.){3}[0-9]{1,3}'                     # IP 地址匹配
grep -E '\d{4}-\d{2}-\d{2}'                               # 日期匹配（YYYY-MM-DD）
```

### 3. 性能优化

- 尽量具体化模式，避免过度使用 `.*`
- 使用字符类 `[ ]` 代替多个 `|` 选项
- 合理使用锚点 `^` 和 `$` 限制匹配范围

### 4. 调试技巧

| 选项 | 说明 |
| :--- | :--- |
| `-o` | 显示匹配部分 |
| `-n` | 显示行号 |
| `-v` | 显示不匹配的行 |
| `-c` | 统计匹配次数 |
| `-i` | 忽略大小写 |

```sh
# 显示匹配部分
grep -o 'pattern' file

# 显示行号
grep -n 'pattern' file

# 显示不匹配的行
grep -v 'pattern' file

# 统计匹配次数
grep -c 'pattern' file
```
