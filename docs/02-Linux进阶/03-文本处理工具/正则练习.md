---
title: 正则练习
---

## 一、正则表达式练习

- 基本正则表达式（BRE）
- 扩展正则表达式（ERE）
- 结合grep、sed命令的用法

## 二、测试数据

```text
I am teacher yuchao.
I teach linux,python.
testtttsss000123566666

I like video,games,girls
#I like girls.
$my blog is http://yuchaoit.cn/
#my site is https://www.cnblogs.com/pyyu
My qq num is 877348180.
my phone num is 15210888008.
```

------

## 三、基础正则表达式练习题

### 1. `^` 查找以指定字符开头的行

**题目**：找出以 `I` 开头的行



```bash
# 方案1：基础写法
grep -n '^I' test.txt

# 方案2：添加边界（更精确）
grep -n '^I ' test.txt

# 方案3：使用字符类（匹配I或i）
grep -n '^[Ii]' test.txt

# 方案4：忽略大小写
grep -in '^i' test.txt
```



### 2. `$` 查找以指定字符结尾的行

**题目1**：找出以 `u` 结尾的行



```bash
# 方案1
grep -n 'u$' test.txt

# 方案2：确保u前是字母（排除标点）
grep -n '[a-zA-Z]u$' test.txt
```



**题目2**：找出以 `.` 结尾的行



```bash
# 方案1：转义点符号
grep -n '\.$' test.txt

# 方案2：使用单引号避免双引号转义问题
grep -n '\.$' test.txt

# 方案3：匹配任何标点结尾
grep -n '[.!?]$' test.txt
```



### 3. `^$` 查找和排除空行

**题目1**：找出空白行



```bash
# 方案1：标准空行匹配
grep -n '^$' test.txt

# 方案2：反向匹配（不含任何字符）
grep -nv '.' test.txt

# 方案3：排除所有可见字符
grep -n '^[[:space:]]*$' test.txt
```



**题目2**：排除空行，提取有内容的行



```bash
# 方案1：匹配任意字符
grep -n '.' test.txt

# 方案2：反向排除空行
grep -nv '^$' test.txt

# 方案3：匹配非空白字符
grep -n '[[:graph:]]' test.txt
```

**题目3**：找出以 `I` 开头，`s` 结尾的行

```bash
# 方案1：标准写法
grep -n '^I.*s$' test.txt

# 方案2：限制中间内容为单词字符
grep -n '^I[[:alnum:][:space:]]*s$' test.txt

# 方案3：扩展正则写法
grep -En '^I.*s$' test.txt
```

### 4. `.` 匹配任意一个字符

```bash
# 匹配所有非空行
grep -n '.' test.txt

# 匹配至少有一个字符的行
grep -n '^..*$' test.txt
```



### 5. `\` 转义特殊字符

**题目**：找出以 `$` 开头的行

```bash
# 方案1：转义美元符号
grep -n '^\$' test.txt

# 方案2：匹配所有特殊字符开头的行
grep -n '^[#$]' test.txt

# 方案3：使用字符类
grep -n '^[[:punct:]]' test.txt
```

### 6. `[ ]` 字符类匹配

**题目1**：匹配小写字母

```bash
# 方案1：标准范围
grep -n '[a-z]' test.txt

# 方案2：POSIX字符类
grep -n '[[:lower:]]' test.txt

# 方案3：排除大写字母
grep -n '[^A-Z]' test.txt
```

**题目2**：找出以 `.` 或 `s` 结尾的行

```bash
# 方案1：字符类
grep -n '[.s]$' test.txt

# 方案2：扩展正则的或运算
grep -En '\.$|s$' test.txt

# 方案3：分组写法
grep -En '(\.|s)$' test.txt

# 方案4：转义点号
grep -n '[\.s]$' test.txt
```

**题目3**：找出以 `I` 开头，且结尾不是 `.` 的行

```bash
# 方案1：排除点号
grep -n '^I.*[^.]$' test.txt

# 方案2：扩展正则写法
grep -En '^I.*[^\.]$' test.txt

# 方案3：明确指定结尾字符
grep -n '^I.*[[:alnum:]]$' test.txt
```

### 7. `-i` 忽略大小写匹配

```bash
# 忽略大小写匹配i开头的行
grep -i '^i' test.txt

# 结合其他参数
grep -in '^i' test.txt
```



------

## 四、扩展正则表达式练习题

### 1. `{}` 指定重复次数

**题目1**：匹配手机号（中国手机号规则）

```bash
# 方案1：基本匹配（1[3-9]开头，共11位）
grep -Eno '1[3-9][0-9]{9}' test.txt

# 方案2：更精确的运营商匹配
grep -Eno '1(3[0-9]|4[5-9]|5[0-35-9]|6[2567]|7[0-8]|8[0-9]|9[0-35-9])[0-9]{8}' test.txt

# 方案3：单词边界限制
grep -Enow '[0-9]{11}' test.txt
```

**题目2**：匹配QQ号（5-11位数字）

```bash
# 方案1：5-11位数字
grep -Enow '[0-9]{5,11}' test.txt

# 方案2：常见QQ号范围（5-10位）
grep -Enow '[1-9][0-9]{4,9}' test.txt

# 方案3：排除手机号干扰
grep -Enow '\b[1-9][0-9]{4,10}\b' test.txt
```



### 2. 分组与向后引用

**题目1**：查找所有单词中出现连续相同字母的行

```bash
# 方案1：至少2个连续相同字母
grep -E '([a-zA-Z])\1' test.txt

# 方案2：至少2个连续相同字母（带+号）
grep -E '([a-zA-Z])\1+' test.txt

# 方案3：明确2个连续字母
grep -E '([a-zA-Z])\1' test.txt
```

**题目2**：只查找同一个字母连续3次的行

```bash
# 方案1：精确3次
grep -En '([a-z])\1{2}' test.txt

# 方案2：另一种写法
grep -En '([a-zA-Z])\1\1' test.txt

# 方案3：扩展正则写法
grep -En '([[:alpha:]])\1\1' test.txt

# 方案4：匹配三个相同字母的单词
grep -En '\b([a-zA-Z])\1{2}\b' test.txt
```

### 3. 网址提取

**题目1**：提取网站的主机名和域名（[www.xxx.com格式](https://www.xxx.xn--com-vb3f281b/)）

```bash
# 方案1：基本匹配
grep -Eno '([a-z])\1{2,}\.[a-z0-9]{1,}\.[a-z0-9]{1,}' test.txt

# 方案2：常见域名后缀
grep -Eno 'www\..*\.(cn|com|net|org)' test.txt

# 方案3：更精确的匹配
grep -Eno 'www\.[a-zA-Z0-9-]+\.[a-zA-Z]{2,}' test.txt

# 方案4：分组提取
grep -Eno '(www)\.([a-z0-9]+)\.([a-z]{2,})' test.txt
```

**题目2**：提取完整的链接地址

```bash
# 方案1：匹配http/https链接
grep -E 'https?://([a-zA-Z0-9])\1{2}\.[a-zA-Z0-9]{1,}\.[a-zA-Z0-9]{1,}[/]?[a-zA-Z0-9]{0,}' test.txt

# 方案2：简单匹配所有链接
grep -E 'h.*://.*[/]?.*' test.txt

# 方案3：精确匹配常见URL格式
grep -Eno 'https?://www\..*\..*' test.txt

# 方案4：带路径的URL
grep -Eno 'https?://www\..*\.(cn|com).*' test.txt

# 方案5：通用URL匹配
grep -Eno 'https?://[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}(/[a-zA-Z0-9._-]*)*' test.txt
```

------

## 五、工作常见需求实战

### 1. 排除配置文件的注释和空行

```bash
# 方案1：排除#注释和空行
grep -Ev '^#|^$' test.txt

# 方案2：分步处理
grep -v '^#' test.txt | grep '.'

# 方案3：排除#和;注释以及空行
grep -Ev '^[#;]|^$' test.txt

# 方案4：保留有实际配置的行
grep -n '^[^#]' test.txt | grep -v '^$'
```

### 2. 查找进程并过滤grep自身

```bash
# 方案1：标准写法
ps -ef | grep ssh | grep -v 'grep'

# 方案2：使用正则排除
ps -ef | grep '[s]sh'

# 方案3：使用pgrep命令
pgrep -af ssh

# 方案4：结合awk
ps -ef | awk '/ssh/ && !/grep/'
```

### 3. 查看磁盘使用率

**查看sda磁盘使用率**：

```bash
# 方案1：提取百分比
df -h | grep sda | grep -oE '[0-9]+%'

# 方案2：使用awk提取
df -h | grep sda | awk '{print $5}'

# 方案3：精确匹配sda设备
df -h | grep '^/dev/sda' | grep -oE '[0-9]+%'
```

**查看根分区使用率**：

```bash
# 方案1：匹配根分区
df -h | grep '/$' | grep -oE '[0-9]+%'

# 方案2：使用awk
df -h | awk '$6=="/" {print $5}'

# 方案3：精确提取
df -h / | tail -1 | grep -oE '[0-9]+%'
```

### 4. 取出网卡IP地址

**使用ifconfig**：

```bash
# 方案1：标准提取
ifconfig ens33 | grep 'netmask' | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | head -1

# 方案2：使用awk简化
ifconfig ens33 | awk '/inet / {print $2}'

# 方案3：精确匹配
ifconfig ens33 | grep -oP 'inet \K[\d.]+'
```

**使用ip命令**：

```bash
# 方案1：标准提取
ip addr show ens33 | grep 'inet ' | grep -Eo '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}' | head -1

# 方案2：简化写法
ip -4 addr show ens33 | grep -oP '(?<=inet\s)\d+(\.\d+){3}'

# 方案3：使用awk
ip addr show ens33 | awk '/inet / {split($2, a, "/"); print a[1]}'
```

### 5. 统计禁止登录的用户

```bash
# 方案1：提取nologin用户
grep 'nologin' /etc/passwd | grep -Eo '^[a-z0-9A-Z]+'

# 方案2：使用awk
awk -F: '/nologin$/ {print $1}' /etc/passwd

# 方案3：提取所有系统用户
grep -E ':/sbin/nologin$' /etc/passwd | cut -d: -f1

# 方案4：结合sort去重
grep 'nologin' /etc/passwd | cut -d: -f1 | sort -u
```

### 6. 找出由root创建的用户（UID≥1000）

```bash
# 方案1：匹配4位及以上UID
grep -E '\b[0-9]{4,}\b' /etc/passwd

# 方案2：精确匹配普通用户
awk -F: '$3 >= 1000 && $3 < 60000 {print $1}' /etc/passwd

# 方案3：使用cut和awk组合
cut -d: -f1,3 /etc/passwd | awk -F: '$2 >= 1000 {print $1}'

# 方案4：排除系统用户
grep -E ':x:[1-9][0-9]{3,}:' /etc/passwd | cut -d: -f1
```

------

## 六、学习建议与技巧

### 1. 正则表达式调试技巧

```bash
# 使用颜色高亮
grep --color=auto 'pattern' file

# 显示行号
grep -n 'pattern' file

# 只显示匹配部分
grep -o 'pattern' file

# 显示上下文
grep -C 3 'pattern' file  # 显示前后3行
```

### 2. 常用正则模式速查

```
# 邮箱地址
[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}

# IP地址
([0-9]{1,3}\.){3}[0-9]{1,3}

# 日期（YYYY-MM-DD）
[0-9]{4}-[0-9]{2}-[0-9]{2}

# 中文字符
[\u4e00-\u9fa5]
```

### 3. 性能优化建议

1. **尽量具体**：避免过度使用 `.*`
2. **使用锚点**：`^` 和 `$` 可以显著提高性能
3. **字符类优先**：`[abc]` 比 `(a|b|c)` 更高效
4. **避免回溯**：谨慎使用嵌套量词
