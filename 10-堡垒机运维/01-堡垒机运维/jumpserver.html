<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.26" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>部署堡垒机 Jumpserver (Python + Vue + Golang) - 整理版 | wyp运维技术博客</title><meta name="description" content="Linux运维、DevOps、容器编排等技术笔记">
    <link rel="preload" href="/assets/style-ByAOFiQW.css" as="style"><link rel="stylesheet" href="/assets/style-ByAOFiQW.css">
    <link rel="modulepreload" href="/assets/app-DtXLoKBz.js"><link rel="modulepreload" href="/assets/jumpserver.html-CORD8Jkl.js">
    <link rel="prefetch" href="/assets/index.html-BXn6bGb5.js" as="script"><link rel="prefetch" href="/assets/index.html-_2DVXqDy.js" as="script"><link rel="prefetch" href="/assets/index.html-BjBYrPGq.js" as="script"><link rel="prefetch" href="/assets/index.html-pBMvT8o5.js" as="script"><link rel="prefetch" href="/assets/index.html-Dtq8x47w.js" as="script"><link rel="prefetch" href="/assets/index.html-DwqZYATz.js" as="script"><link rel="prefetch" href="/assets/index.html-CNP3PyiA.js" as="script"><link rel="prefetch" href="/assets/index.html-D-xa-r3i.js" as="script"><link rel="prefetch" href="/assets/index.html-BbmoatNg.js" as="script"><link rel="prefetch" href="/assets/index.html-BmzXoxbl.js" as="script"><link rel="prefetch" href="/assets/index.html-leMhmsaG.js" as="script"><link rel="prefetch" href="/assets/index.html-GwlZQybq.js" as="script"><link rel="prefetch" href="/assets/index.html-BTp9mHGy.js" as="script"><link rel="prefetch" href="/assets/期中架构Ansible剧本.html-BwkcOvYk.js" as="script"><link rel="prefetch" href="/assets/期中架构脚本命令.html-DQgVNUAR.js" as="script"><link rel="prefetch" href="/assets/19_20软件包管理与yum.html-DcKaLmix.js" as="script"><link rel="prefetch" href="/assets/用户与密码.html-Ch0Nracx.js" as="script"><link rel="prefetch" href="/assets/进程管理与资源监控.html-4vUnq3mM.js" as="script"><link rel="prefetch" href="/assets/服务管理.html-DTnjDrAd.js" as="script"><link rel="prefetch" href="/assets/作业讲解.html-CftlChwq.js" as="script"><link rel="prefetch" href="/assets/磁盘管理.html-tmhGb0sy.js" as="script"><link rel="prefetch" href="/assets/lvm逻辑卷.html-BO8-5Zn8.js" as="script"><link rel="prefetch" href="/assets/awk笔记.html-CBYiRnqs.js" as="script"><link rel="prefetch" href="/assets/sed笔记.html-BzMCkspv.js" as="script"><link rel="prefetch" href="/assets/正则练习.html-Ck9ZQsTW.js" as="script"><link rel="prefetch" href="/assets/正则表达式.html-ITLvCD9f.js" as="script"><link rel="prefetch" href="/assets/通配符.html-CIWPp-we.js" as="script"><link rel="prefetch" href="/assets/nfs题目.html-BEusPorZ.js" as="script"><link rel="prefetch" href="/assets/rsync大纲.html-CJpGUDdM.js" as="script"><link rel="prefetch" href="/assets/rsync练习.html-DK2gxXj_.js" as="script"><link rel="prefetch" href="/assets/共享存储nfs.html-zqbdBX3j.js" as="script"><link rel="prefetch" href="/assets/实时数据同步.html-BOinUba1.js" as="script"><link rel="prefetch" href="/assets/iptables.html-CHOfNoXx.js" as="script"><link rel="prefetch" href="/assets/SSH.html-DmPYzwUy.js" as="script"><link rel="prefetch" href="/assets/文件共享服务.html-DPo9KZka.js" as="script"><link rel="prefetch" href="/assets/网站架构.html-CCRfMCzP.js" as="script"><link rel="prefetch" href="/assets/lamp架构与阿里云.html-C7yvxISD.js" as="script"><link rel="prefetch" href="/assets/lamp编译安装.html-DLETcOBH.js" as="script"><link rel="prefetch" href="/assets/nginx入门与安装.html-DqSrKMcL.js" as="script"><link rel="prefetch" href="/assets/nginx功能.html-B5tYBgKw.js" as="script"><link rel="prefetch" href="/assets/nginx功能篇二.html-DUIjK5FL.js" as="script"><link rel="prefetch" href="/assets/nginx虚拟主机综合实战.html-BfWt79ZH.js" as="script"><link rel="prefetch" href="/assets/nginx高级rewrite.html-VwGrQhaa.js" as="script"><link rel="prefetch" href="/assets/53负载均衡.html-DmOxW0wt.js" as="script"><link rel="prefetch" href="/assets/54负载均衡策略与参数.html-pKW3qP6O.js" as="script"><link rel="prefetch" href="/assets/55_wordpress负载均衡部署.html-Ce7VbxSw.js" as="script"><link rel="prefetch" href="/assets/51_黄金架构LNMP.html-BBytQg6S.js" as="script"><link rel="prefetch" href="/assets/52_LNMP集群拆分.html-CokUetUh.js" as="script"><link rel="prefetch" href="/assets/57keepalived.html-COM-6Gcp.js" as="script"><link rel="prefetch" href="/assets/web基础协议.html-VfOlA54x.js" as="script"><link rel="prefetch" href="/assets/56https.html-CxPaAMl_.js" as="script"><link rel="prefetch" href="/assets/cdn.html-C0GmKEgH.js" as="script"><link rel="prefetch" href="/assets/kvm虚拟化.html-CmGleAY3.js" as="script"><link rel="prefetch" href="/assets/1-docker入门.html-DqB-AC4N.js" as="script"><link rel="prefetch" href="/assets/2-docker部署.html-BJ1lOk6G.js" as="script"><link rel="prefetch" href="/assets/3-docker构建镜像.html-DOFalSRL.js" as="script"><link rel="prefetch" href="/assets/4-容器仓库harbor.html-DNtjMO5k.js" as="script"><link rel="prefetch" href="/assets/5-docker网络.html-B_-rspat.js" as="script"><link rel="prefetch" href="/assets/6-docker-compose使用与实践.html-C_X_zdpb.js" as="script"><link rel="prefetch" href="/assets/1-k8s入门.html-B2xSyGyy.js" as="script"><link rel="prefetch" href="/assets/2-k8s安装.html-BH1hgYyV.js" as="script"><link rel="prefetch" href="/assets/3-k8s资源-pod.html-CYSEDdEQ.js" as="script"><link rel="prefetch" href="/assets/4-k8s控制器.html-ChKpF0Is.js" as="script"><link rel="prefetch" href="/assets/5-k8s网络service.html-CPJqsqS1.js" as="script"><link rel="prefetch" href="/assets/6-k8s存储.html-B5p6ApYS.js" as="script"><link rel="prefetch" href="/assets/7-k8s配置文件.html-KM6LTAVO.js" as="script"><link rel="prefetch" href="/assets/1-zabbix入门与部署.html-6wmmBuNL.js" as="script"><link rel="prefetch" href="/assets/2-zabbix实践.html-X_BqjlLk.js" as="script"><link rel="prefetch" href="/assets/3-zabbix报警多媒介.html-DFw5x_oX.js" as="script"><link rel="prefetch" href="/assets/4-zabbix监控核心服务.html-B69xkqj2.js" as="script"><link rel="prefetch" href="/assets/5-zabbix主被动、分布式.html-DRZMcPhq.js" as="script"><link rel="prefetch" href="/assets/AlertManager.html-DIXFOT-v.js" as="script"><link rel="prefetch" href="/assets/grafana数据可视化.html-DQ_9bA_L.js" as="script"><link rel="prefetch" href="/assets/普罗米修斯.html-CUI0Ep0j.js" as="script"><link rel="prefetch" href="/assets/监控项.html-CTztir8C.js" as="script"><link rel="prefetch" href="/assets/shell函数.html-DcQ0I7aF.js" as="script"><link rel="prefetch" href="/assets/shell基础-变量.html-UA86d_VR.js" as="script"><link rel="prefetch" href="/assets/shell循环语句.html-UyPbqZt2.js" as="script"><link rel="prefetch" href="/assets/shell数组.html-MLoivlzX.js" as="script"><link rel="prefetch" href="/assets/shell条件判断.html-cJYAJmMf.js" as="script"><link rel="prefetch" href="/assets/ansible基础.html-QyMc2H0I.js" as="script"><link rel="prefetch" href="/assets/role角色.html-ANF-9_AT.js" as="script"><link rel="prefetch" href="/assets/剧本.html-Ct7vHHnI.js" as="script"><link rel="prefetch" href="/assets/剧本进阶.html-BABbykeP.js" as="script"><link rel="prefetch" href="/assets/1-cicd与devops.html-B49rVuPV.js" as="script"><link rel="prefetch" href="/assets/2-git与代码仓库.html-CgrloXyo.js" as="script"><link rel="prefetch" href="/assets/3-gitlab私有仓库.html-D9hHe97c.js" as="script"><link rel="prefetch" href="/assets/4-jenkins实现cicd.html-Db-3CNSC.js" as="script"><link rel="prefetch" href="/assets/5-cicd实践发布静态网站.html-BRvAmABV.js" as="script"><link rel="prefetch" href="/assets/6-gitlab集成sonarqube代码扫描.html-uc30jC0c.js" as="script"><link rel="prefetch" href="/assets/7-jenkins集成java项目.html-DSf6_h--.js" as="script"><link rel="prefetch" href="/assets/tomcat负载均衡.html-D_E1lXoq.js" as="script"><link rel="prefetch" href="/assets/tomcat部署java项目.html-MyakU_AD.js" as="script"><link rel="prefetch" href="/assets/1-redis入门.html-CMre0Wgm.js" as="script"><link rel="prefetch" href="/assets/2-redis数据类型.html-sYy04vLD.js" as="script"><link rel="prefetch" href="/assets/3-redis持久化数据.html-DxMMXwSn.js" as="script"><link rel="prefetch" href="/assets/4-redis主从哨兵高可用架构.html-BjWgcx1P.js" as="script"><link rel="prefetch" href="/assets/5-redis-cluster.html-DgERaPD5.js" as="script"><link rel="prefetch" href="/assets/1-mysql入门.html-BRElf-9s.js" as="script"><link rel="prefetch" href="/assets/2-mysql权限.html-Bc2_iYwV.js" as="script"><link rel="prefetch" href="/assets/3-云服务器mysql部署实践.html-B6MKPYS4.js" as="script"><link rel="prefetch" href="/assets/4-认识sql.html-d6eY1G2m.js" as="script"><link rel="prefetch" href="/assets/5-DDL数据库定义.html-DSL9UtYt.js" as="script"><link rel="prefetch" href="/assets/6-DML与DQL数据管理与查询.html-Dj8US2PU.js" as="script"><link rel="prefetch" href="/assets/堡垒机应用实践.html-btlpP4IE.js" as="script"><link rel="prefetch" href="/assets/重启jumpserver.html-CXcoauV8.js" as="script"><link rel="prefetch" href="/assets/1-ES.html-DQlkEDNz.js" as="script"><link rel="prefetch" href="/assets/2-ES集群.html-CYHFyHSe.js" as="script"><link rel="prefetch" href="/assets/3-ES监控接口.html-DdhvgeyW.js" as="script"><link rel="prefetch" href="/assets/4-ES中文分词器.html-DZr9d7mK.js" as="script"><link rel="prefetch" href="/assets/5-ES备份.html-CHG0ZNX0.js" as="script"><link rel="prefetch" href="/assets/6-ELK.html-D1UvAt4t.js" as="script"><link rel="prefetch" href="/assets/7-ELK日志格式处理.html-B8vjvm3t.js" as="script"><link rel="prefetch" href="/assets/ELK可视化.html-B8R635Zi.js" as="script"><link rel="prefetch" href="/assets/对比.html-CaFg5gVL.js" as="script"><link rel="prefetch" href="/assets/404.html-CHwr2ddg.js" as="script"><link rel="prefetch" href="/assets/SearchResult-DcdFVy8v.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><!----><span class="vp-site-name" aria-hidden="true">wyp运维技术博客</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="首页"><!--[--><!--[--><!--]--><!--]-->首页<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Linux 系统 &amp; 中间件"><span class="title">Linux 系统 &amp; 中间件</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Linux 系统 &amp; 中间件"><span class="title">Linux 系统 &amp; 中间件</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/01-Linux%E5%9F%BA%E7%A1%80/" aria-label="Linux基础"><!--[--><!--[--><!--]--><!--]-->Linux基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/02-Linux%E8%BF%9B%E9%98%B6/" aria-label="Linux进阶"><!--[--><!--[--><!--]--><!--]-->Linux进阶<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/03-%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/" aria-label="网络服务"><!--[--><!--[--><!--]--><!--]-->网络服务<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/04-Web%E6%9E%B6%E6%9E%84/" aria-label="Web架构"><!--[--><!--[--><!--]--><!--]-->Web架构<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/09-%E4%B8%AD%E9%97%B4%E4%BB%B6/" aria-label="中间件"><!--[--><!--[--><!--]--><!--]-->中间件<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/12-lnmp%E9%AB%98%E5%8F%AF%E7%94%A8%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84/" aria-label="LNMP高可用"><!--[--><!--[--><!--]--><!--]-->LNMP高可用<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="自动化运维 &amp; 云原生"><span class="title">自动化运维 &amp; 云原生</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="自动化运维 &amp; 云原生"><span class="title">自动化运维 &amp; 云原生</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/05-%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92/" aria-label="容器编排"><!--[--><!--[--><!--]--><!--]-->容器编排<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/06-%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/" aria-label="自动化运维"><!--[--><!--[--><!--]--><!--]-->自动化运维<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/07-%E7%9B%91%E6%8E%A7%E4%BD%93%E7%B3%BB/" aria-label="监控体系"><!--[--><!--[--><!--]--><!--]-->监控体系<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/08-CI-CD/" aria-label="CI/CD"><!--[--><!--[--><!--]--><!--]-->CI/CD<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/11-ELK%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/" aria-label="ELK日志系统"><!--[--><!--[--><!--]--><!--]-->ELK日志系统<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/10-%E5%A0%A1%E5%9E%92%E6%9C%BA%E8%BF%90%E7%BB%B4/" aria-label="堡垒机运维"><!--[--><!--[--><!--]--><!--]-->堡垒机运维<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><button type="button" class="slimsearch-button" aria-label="搜索"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="slimsearch-placeholder">搜索</div><div class="slimsearch-key-hints"><kbd class="slimsearch-key">Ctrl</kbd><kbd class="slimsearch-key">K</kbd></div></button><!--]--></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="首页"><!--[--><!--[--><!--]--><!--]-->首页<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Linux 系统 &amp; 中间件"><span class="title">Linux 系统 &amp; 中间件</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Linux 系统 &amp; 中间件"><span class="title">Linux 系统 &amp; 中间件</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/01-Linux%E5%9F%BA%E7%A1%80/" aria-label="Linux基础"><!--[--><!--[--><!--]--><!--]-->Linux基础<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/02-Linux%E8%BF%9B%E9%98%B6/" aria-label="Linux进阶"><!--[--><!--[--><!--]--><!--]-->Linux进阶<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/03-%E7%BD%91%E7%BB%9C%E6%9C%8D%E5%8A%A1/" aria-label="网络服务"><!--[--><!--[--><!--]--><!--]-->网络服务<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/04-Web%E6%9E%B6%E6%9E%84/" aria-label="Web架构"><!--[--><!--[--><!--]--><!--]-->Web架构<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/09-%E4%B8%AD%E9%97%B4%E4%BB%B6/" aria-label="中间件"><!--[--><!--[--><!--]--><!--]-->中间件<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/12-lnmp%E9%AB%98%E5%8F%AF%E7%94%A8%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84/" aria-label="LNMP高可用"><!--[--><!--[--><!--]--><!--]-->LNMP高可用<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="自动化运维 &amp; 云原生"><span class="title">自动化运维 &amp; 云原生</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="自动化运维 &amp; 云原生"><span class="title">自动化运维 &amp; 云原生</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/05-%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92/" aria-label="容器编排"><!--[--><!--[--><!--]--><!--]-->容器编排<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/06-%E8%87%AA%E5%8A%A8%E5%8C%96%E8%BF%90%E7%BB%B4/" aria-label="自动化运维"><!--[--><!--[--><!--]--><!--]-->自动化运维<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/07-%E7%9B%91%E6%8E%A7%E4%BD%93%E7%B3%BB/" aria-label="监控体系"><!--[--><!--[--><!--]--><!--]-->监控体系<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/08-CI-CD/" aria-label="CI/CD"><!--[--><!--[--><!--]--><!--]-->CI/CD<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/11-ELK%E6%97%A5%E5%BF%97%E7%B3%BB%E7%BB%9F/" aria-label="ELK日志系统"><!--[--><!--[--><!--]--><!--]-->ELK日志系统<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/10-%E5%A0%A1%E5%9E%92%E6%9C%BA%E8%BF%90%E7%BB%B4/" aria-label="堡垒机运维"><!--[--><!--[--><!--]--><!--]-->堡垒机运维<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active collapsible">Jumpserver 堡垒机 <span class="down arrow"></span></p><ul class="vp-sidebar-children" style=""><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/10-%E5%A0%A1%E5%9E%92%E6%9C%BA%E8%BF%90%E7%BB%B4/01-%E5%A0%A1%E5%9E%92%E6%9C%BA%E8%BF%90%E7%BB%B4/jumpserver.html" aria-label="Jumpserver 安装"><!--[--><!--[--><!--]--><!--]-->Jumpserver 安装<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/10-%E5%A0%A1%E5%9E%92%E6%9C%BA%E8%BF%90%E7%BB%B4/01-%E5%A0%A1%E5%9E%92%E6%9C%BA%E8%BF%90%E7%BB%B4/%E5%A0%A1%E5%9E%92%E6%9C%BA%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5.html" aria-label="堡垒机应用实践"><!--[--><!--[--><!--]--><!--]-->堡垒机应用实践<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/10-%E5%A0%A1%E5%9E%92%E6%9C%BA%E8%BF%90%E7%BB%B4/01-%E5%A0%A1%E5%9E%92%E6%9C%BA%E8%BF%90%E7%BB%B4/%E9%87%8D%E5%90%AFjumpserver.html" aria-label="重启与维护"><!--[--><!--[--><!--]--><!--]-->重启与维护<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="部署堡垒机-jumpserver-python-vue-golang-整理版" tabindex="-1"><a class="header-anchor" href="#部署堡垒机-jumpserver-python-vue-golang-整理版"><span>部署堡垒机 Jumpserver (Python + Vue + Golang) - 整理版</span></a></h1><h2 id="_1-数据库服务器-db-51" tabindex="-1"><a class="header-anchor" href="#_1-数据库服务器-db-51"><span>1. 数据库服务器 (db-51)</span></a></h2><h3 id="安装与配置-mysql" tabindex="-1"><a class="header-anchor" href="#安装与配置-mysql"><span>安装与配置 MySQL</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">yum <span class="token parameter variable">-y</span> localinstall http://mirrors.ustc.edu.cn/mysql-repo/mysql57-community-release-el7.rpm</span>
<span class="line"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;/gpgcheck=1/c gpgcheck=0&#39;</span> /etc/yum.repos.d/mysql-community*</span>
<span class="line">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> mysql-community-server</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 禁用随机密码生成</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> <span class="token string">&quot;<span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /usr/bin/mysqld_pre_systemd <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-v</span> ^<span class="token punctuation">\</span># <span class="token operator">|</span> <span class="token function">grep</span> initialize-insecure <span class="token variable">)</span></span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span></span>
<span class="line">    <span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;s@--initialize @--initialize-insecure @g&quot;</span> /usr/bin/mysqld_pre_systemd</span>
<span class="line"><span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line">systemctl <span class="token builtin class-name">enable</span> mysqld</span>
<span class="line">systemctl start mysqld</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 创建数据库与用户</span></span>
<span class="line">mysql <span class="token parameter variable">-e</span> <span class="token string">&quot;create database jumpserver default charset &#39;utf8&#39;;&quot;</span></span>
<span class="line">mysql <span class="token parameter variable">-e</span> <span class="token string">&quot;create database wordpress default charset &#39;utf8&#39;;&quot;</span></span>
<span class="line">mysql <span class="token parameter variable">-e</span> <span class="token string">&quot;set global validate_password_policy=LOW;&quot;</span></span>
<span class="line">mysql <span class="token parameter variable">-e</span> <span class="token string">&quot;create user &#39;wang&#39;@&#39;%&#39; identified by &#39;qwe123123&#39;;&quot;</span></span>
<span class="line">mysql <span class="token parameter variable">-e</span> <span class="token string">&quot;grant all on jumpserver.* to &#39;wang&#39;@&#39;%&#39;;&quot;</span></span>
<span class="line">mysql <span class="token parameter variable">-e</span> <span class="token string">&quot;grant all on wordpress.* to &#39;wang&#39;@&#39;%&#39;;&quot;</span></span>
<span class="line">mysql <span class="token parameter variable">-e</span> <span class="token string">&quot;flush privileges;&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="安装与配置-redis" tabindex="-1"><a class="header-anchor" href="#安装与配置-redis"><span>安装与配置 Redis</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> epel-release <span class="token function">wget</span> <span class="token function">make</span> gcc-c++</span>
<span class="line"><span class="token builtin class-name">cd</span> /opt <span class="token punctuation">;</span> <span class="token function">wget</span> https://download.redis.io/releases/redis-6.2.4.tar.gz</span>
<span class="line"><span class="token function">tar</span> <span class="token parameter variable">-xf</span> redis-6.2.4.tar.gz</span>
<span class="line"><span class="token builtin class-name">cd</span> redis-6.2.4</span>
<span class="line"><span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span> <span class="token assign-left variable">PREFIX</span><span class="token operator">=</span>/usr/local/redis</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 配置环境变量</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&#39;export PATH=$PATH:/usr/local/redis/bin/&#39;</span> <span class="token operator">&gt;&gt;</span> /etc/profile</span>
<span class="line"><span class="token builtin class-name">source</span> /etc/profile</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 配置文件设置</span></span>
<span class="line"><span class="token function">cp</span> /opt/redis-6.2.4/redis.conf /etc/redis.conf</span>
<span class="line"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;s/bind 127.0.0.1/bind 0.0.0.0/g&quot;</span> /etc/redis.conf</span>
<span class="line"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;s/daemonize no/daemonize yes/g&quot;</span> /etc/redis.conf</span>
<span class="line"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;561i maxmemory-policy allkeys-lru&quot;</span> /etc/redis.conf</span>
<span class="line"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&quot;481i requirepass qwe123123&quot;</span> /etc/redis.conf</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 创建 systemd 服务</span></span>
<span class="line"><span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/systemd/system/redis.service <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="line">[Unit]</span>
<span class="line">Description=Redis persistent key-value database</span>
<span class="line">After=network.target</span>
<span class="line">After=network-online.target</span>
<span class="line">Wants=network-online.target</span>
<span class="line"></span>
<span class="line">[Service]</span>
<span class="line">Type=forking</span>
<span class="line">PIDFile=/var/run/redis_6379.pid</span>
<span class="line">ExecStart=/usr/local/redis/bin/redis-server /etc/redis.conf</span>
<span class="line">ExecReload=/bin/kill -s HUP \<span class="token variable">$MAINPID</span></span>
<span class="line">ExecStop=/bin/kill -s QUIT \<span class="token variable">$MAINPID</span></span>
<span class="line"></span>
<span class="line">[Install]</span>
<span class="line">WantedBy=multi-user.target</span>
<span class="line">EOF</span></span>
<span class="line"></span>
<span class="line">systemctl <span class="token builtin class-name">enable</span> redis</span>
<span class="line">systemctl start redis</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-管理服务器-master-61" tabindex="-1"><a class="header-anchor" href="#_2-管理服务器-master-61"><span>2. 管理服务器 (master-61)</span></a></h2><h3 id="基础环境准备" tabindex="-1"><a class="header-anchor" href="#基础环境准备"><span>基础环境准备</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span>
<span class="line"><span class="token function">wget</span> <span class="token parameter variable">-O</span> /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span>
<span class="line"></span>
<span class="line">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> bash-completion <span class="token function">vim</span> lrzsz <span class="token function">wget</span> <span class="token function">expect</span> net-tools <span class="token function">nc</span> nmap tree dos2unix <span class="token function">htop</span> iftop iotop <span class="token function">unzip</span> telnet sl psmisc nethogs glances <span class="token function">bc</span> ntpdate openldap-devel</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Python 依赖</span></span>
<span class="line">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token function">git</span> python-pip gcc automake autoconf python-devel <span class="token function">vim</span> sshpass lrzsz readline-devel zlib zlib-devel openssl openssl-devel mysql-devel</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 设置中文环境</span></span>
<span class="line">localedef <span class="token parameter variable">-c</span> <span class="token parameter variable">-f</span> UTF-8 <span class="token parameter variable">-i</span> zh_CN zh_CN.UTF-8</span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">LC_ALL</span></span><span class="token operator">=</span>zh_CN.UTF-8</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="下载-jumpserver-源码" tabindex="-1"><a class="header-anchor" href="#下载-jumpserver-源码"><span>下载 Jumpserver 源码</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">mkdir</span> /opt/jumpserver-v2.12.0</span>
<span class="line"><span class="token function">wget</span> <span class="token parameter variable">-O</span> /opt/jumpserver-v2.12.0.tar.gz https://github.com/jumpserver/jumpserver/archive/refs/tags/v2.12.0.tar.gz</span>
<span class="line"><span class="token function">tar</span> <span class="token parameter variable">-xf</span> jumpserver-v2.12.0.tar.gz <span class="token parameter variable">-C</span> /opt/jumpserver-v2.12.0 --strip-components <span class="token number">1</span></span>
<span class="line">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /opt/jumpserver-v2.12.0/requirements/rpm_requirements.txt<span class="token variable">)</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="python-3-6-9-环境搭建" tabindex="-1"><a class="header-anchor" href="#python-3-6-9-环境搭建"><span>Python 3.6.9 环境搭建</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">yum <span class="token function">install</span> gcc patch libffi-devel python-devel zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel <span class="token parameter variable">-y</span></span>
<span class="line"></span>
<span class="line"><span class="token builtin class-name">cd</span> /opt <span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> https://www.python.org/ftp/python/3.6.9/Python-3.6.9.tar.xz</span>
<span class="line">xz <span class="token parameter variable">-d</span> Python-3.6.9.tar.xz</span>
<span class="line"><span class="token function">tar</span> <span class="token parameter variable">-xvf</span> Python-3.6.9.tar</span>
<span class="line"><span class="token builtin class-name">cd</span> Python-3.6.9/</span>
<span class="line">./configure <span class="token parameter variable">--prefix</span><span class="token operator">=</span>/opt/python3/</span>
<span class="line"><span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 环境变量配置</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&#39;export PATH=$PATH:/opt/python3/bin&#39;</span> <span class="token operator">&gt;&gt;</span> /etc/profile</span>
<span class="line"><span class="token builtin class-name">source</span> /etc/profile</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 配置 pip 源</span></span>
<span class="line"><span class="token function">mkdir</span> ~/.pip</span>
<span class="line"><span class="token function">cat</span> <span class="token operator">&gt;</span> ~/.pip/pip.conf <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="line">[global]</span>
<span class="line">index-url = https://mirrors.aliyun.com/pypi/simple/</span>
<span class="line">trusted-host = mirrors.aliyun.com</span>
<span class="line">EOF</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="创建-python-虚拟环境" tabindex="-1"><a class="header-anchor" href="#创建-python-虚拟环境"><span>创建 Python 虚拟环境</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">python3 <span class="token parameter variable">-m</span> venv /opt/venv_py3</span>
<span class="line"><span class="token builtin class-name">source</span> /opt/venv_py3/bin/activate</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 修改依赖文件</span></span>
<span class="line"><span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;/huaweicloud-sdk-python-1.0.21/d&#39;</span> /opt/jumpserver-v2.12.0/requirements/requirements.txt</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 安装依赖</span></span>
<span class="line">pip3 <span class="token function">install</span> <span class="token parameter variable">-r</span> /opt/jumpserver-v2.12.0/requirements/requirements.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="jumpserver-core-配置" tabindex="-1"><a class="header-anchor" href="#jumpserver-core-配置"><span>Jumpserver Core 配置</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># 生成密钥</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$SECRET_KEY</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token assign-left variable">SECRET_KEY</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> /dev/urandom <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-dc</span> A-Za-z0-9 <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-c</span> <span class="token number">50</span><span class="token variable">`</span></span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;SECRET_KEY=<span class="token variable">$SECRET_KEY</span>&quot;</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc<span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token variable">$SECRET_KEY</span><span class="token punctuation">;</span> <span class="token keyword">else</span> <span class="token builtin class-name">echo</span> <span class="token variable">$SECRET_KEY</span><span class="token punctuation">;</span> <span class="token keyword">fi</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$BOOTSTRAP_TOKEN</span>&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token assign-left variable">BOOTSTRAP_TOKEN</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> /dev/urandom <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-dc</span> A-Za-z0-9 <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-c</span> <span class="token number">16</span><span class="token variable">`</span></span><span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token string">&quot;BOOTSTRAP_TOKEN=<span class="token variable">$BOOTSTRAP_TOKEN</span>&quot;</span> <span class="token operator">&gt;&gt;</span> ~/.bashrc<span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token variable">$BOOTSTRAP_TOKEN</span><span class="token punctuation">;</span> <span class="token keyword">else</span> <span class="token builtin class-name">echo</span> <span class="token variable">$BOOTSTRAP_TOKEN</span><span class="token punctuation">;</span> <span class="token keyword">fi</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 配置文件</span></span>
<span class="line"><span class="token builtin class-name">cd</span> /opt/jumpserver-v2.12.0</span>
<span class="line"><span class="token function">cp</span> config_example.yml config.yml</span>
<span class="line"></span>
<span class="line"><span class="token function">cat</span> <span class="token operator">&gt;</span> config.yml <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="line">SECRET_KEY: &quot;<span class="token variable">$SECRET_KEY</span>&quot;</span>
<span class="line">BOOTSTRAP_TOKEN: &quot;<span class="token variable">$BOOTSTRAP_TOKEN</span>&quot;</span>
<span class="line">DEBUG: true</span>
<span class="line">LOG_LEVEL: DEBUG</span>
<span class="line">SESSION_EXPIRE_AT_BROWSER_CLOSE: true</span>
<span class="line">DB_ENGINE: mysql</span>
<span class="line">DB_HOST: 10.0.0.51</span>
<span class="line">DB_PORT: 3306</span>
<span class="line">DB_USER: wang</span>
<span class="line">DB_PASSWORD: qwe123123</span>
<span class="line">DB_NAME: jumpserver</span>
<span class="line">HTTP_BIND_HOST: 0.0.0.0</span>
<span class="line">HTTP_LISTEN_PORT: 8080</span>
<span class="line">WS_LISTEN_PORT: 8070</span>
<span class="line">REDIS_HOST: 10.0.0.51</span>
<span class="line">REDIS_PORT: 6379</span>
<span class="line">REDIS_PASSWORD: qwe123123</span>
<span class="line">EOF</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 数据库迁移</span></span>
<span class="line"><span class="token builtin class-name">cd</span> /opt/jumpserver-v2.12.0/apps</span>
<span class="line"><span class="token function">find</span> /opt/jumpserver-v2.12.0/apps <span class="token parameter variable">-name</span> <span class="token string">&quot;0*.py&quot;</span> <span class="token parameter variable">-delete</span></span>
<span class="line">python3 manage.py makemigrations</span>
<span class="line">python3 ./manage.py migrate</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 创建超级用户</span></span>
<span class="line">python3 manage.py createsuperuser</span>
<span class="line"><span class="token comment"># 输入：admin / admin@qwe.com / qwe123123</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="启动-core-服务" tabindex="-1"><a class="header-anchor" href="#启动-core-服务"><span>启动 Core 服务</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token builtin class-name">cd</span> /opt/jumpserver-v2.12.0</span>
<span class="line">./jms start all <span class="token parameter variable">-d</span></span>
<span class="line">./jms status  <span class="token comment"># 验证服务状态</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-lina-前端部署" tabindex="-1"><a class="header-anchor" href="#_3-lina-前端部署"><span>3. Lina 前端部署</span></a></h2><h3 id="node-js-环境" tabindex="-1"><a class="header-anchor" href="#node-js-环境"><span>Node.js 环境</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /opt/node-v12.22.9 <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> /opt/node-v12.22.9 <span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> https://nodejs.org/dist/v12.22.9/node-v12.22.9-linux-x64.tar.gz</span>
<span class="line"><span class="token function">tar</span> <span class="token parameter variable">-xf</span> node-v12.22.9-linux-x64.tar.gz <span class="token parameter variable">-C</span> /opt/node-v12.22.9 --strip-components <span class="token number">1</span></span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&#39;export PATH=$PATH:/opt/node-v12.22.9/bin&#39;</span> <span class="token operator">&gt;&gt;</span> /etc/profile</span>
<span class="line"><span class="token builtin class-name">source</span> /etc/profile</span>
<span class="line"></span>
<span class="line"><span class="token function">npm</span> config <span class="token builtin class-name">set</span> registry http://registry.npmmirror.com</span>
<span class="line"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> <span class="token function">yarn</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="lina-源码与依赖" tabindex="-1"><a class="header-anchor" href="#lina-源码与依赖"><span>Lina 源码与依赖</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /opt/lina-v2.12.0</span>
<span class="line"><span class="token function">wget</span> <span class="token parameter variable">-O</span> /opt/lina-v2.12.0.tar.gz https://github.com/jumpserver/lina/archive/refs/tags/v2.12.0.tar.gz</span>
<span class="line"><span class="token builtin class-name">cd</span> /opt/lina-v2.12.0</span>
<span class="line"><span class="token function">tar</span> <span class="token parameter variable">-xf</span> lina-v2.12.0.tar.gz <span class="token parameter variable">-C</span> /opt/lina-v2.12.0 --strip-components <span class="token number">1</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 安装依赖</span></span>
<span class="line"><span class="token function">yarn</span> config <span class="token builtin class-name">set</span> registry https://registry.npmmirror.com/</span>
<span class="line"><span class="token function">yarn</span> cache clean</span>
<span class="line"><span class="token function">rm</span> <span class="token parameter variable">-rf</span> node_modules yarn.lock</span>
<span class="line"><span class="token function">yarn</span> config <span class="token builtin class-name">set</span> ignore-engines <span class="token boolean">true</span></span>
<span class="line"><span class="token function">yarn</span> <span class="token function">install</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="启动-lina" tabindex="-1"><a class="header-anchor" href="#启动-lina"><span>启动 Lina</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token builtin class-name">cd</span> /opt/lina-v2.12.0</span>
<span class="line"><span class="token function">nohup</span> <span class="token function">yarn</span> serve <span class="token operator">&amp;</span></span>
<span class="line"><span class="token function">netstat</span> <span class="token parameter variable">-tunlp</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token function">node</span>  <span class="token comment"># 验证 9528 端口</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-luna-前端部署" tabindex="-1"><a class="header-anchor" href="#_4-luna-前端部署"><span>4. Luna 前端部署</span></a></h2><h3 id="安装依赖" tabindex="-1"><a class="header-anchor" href="#安装依赖"><span>安装依赖</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /opt/luna-v2.12.0</span>
<span class="line"><span class="token function">wget</span> <span class="token parameter variable">-O</span> /opt/luna-2.12.0.tar.gz https://github.com/jumpserver/luna/archive/refs/tags/v2.12.0.tar.gz</span>
<span class="line"><span class="token function">tar</span> <span class="token parameter variable">-xf</span> luna-2.12.0.tar.gz <span class="token parameter variable">-C</span> /opt/luna-v2.12.0 --strip-components <span class="token number">1</span></span>
<span class="line"></span>
<span class="line">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> gcc gcc-c++</span>
<span class="line"><span class="token builtin class-name">cd</span> /opt/luna-v2.12.0</span>
<span class="line"><span class="token function">npm</span> <span class="token function">install</span></span>
<span class="line"><span class="token assign-left variable">SASS_BINARY_SITE</span><span class="token operator">=</span>https://npm.taobao.org/mirrors/node-sass/ <span class="token function">npm</span> <span class="token function">install</span> node-sass@4.13.0</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 安装 Angular CLI</span></span>
<span class="line"><span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> @angular/cli@1.3.2 --unsafe-perm</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="启动-luna" tabindex="-1"><a class="header-anchor" href="#启动-luna"><span>启动 Luna</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token builtin class-name">cd</span> /opt/luna-v2.12.0</span>
<span class="line"><span class="token function">nohup</span> ng serve --proxy-config proxy.conf.json <span class="token parameter variable">--host</span> <span class="token number">0.0</span>.0.0 <span class="token operator">&amp;</span></span>
<span class="line"><span class="token function">netstat</span> <span class="token parameter variable">-tunlp</span> <span class="token operator">|</span> <span class="token function">grep</span> angular  <span class="token comment"># 验证 4200 端口</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-koko-ssh-服务部署" tabindex="-1"><a class="header-anchor" href="#_5-koko-ssh-服务部署"><span>5. Koko SSH 服务部署</span></a></h2><h3 id="go-环境与-koko-安装" tabindex="-1"><a class="header-anchor" href="#go-环境与-koko-安装"><span>Go 环境与 Koko 安装</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">mkdir</span> /opt/koko-v2.12.0</span>
<span class="line"><span class="token builtin class-name">cd</span> /opt <span class="token punctuation">;</span> <span class="token function">wget</span> https://github.com/jumpserver/koko/releases/download/v2.12.0/koko-v2.12.0-linux-amd64.tar.gz</span>
<span class="line"><span class="token function">tar</span> <span class="token parameter variable">-xf</span> koko-v2.12.0-linux-amd64.tar.gz <span class="token parameter variable">-C</span> /opt/koko-v2.12.0 --strip-components <span class="token number">1</span></span>
<span class="line"></span>
<span class="line"><span class="token function">wget</span> https://golang.google.cn/dl/go1.15.linux-amd64.tar.gz</span>
<span class="line"><span class="token function">tar</span> <span class="token parameter variable">-xf</span> go1.15.linux-amd64.tar.gz</span>
<span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&#39;export PATH=$PATH:/opt/go/bin&#39;</span> <span class="token operator">&gt;&gt;</span> /etc/profile</span>
<span class="line"><span class="token builtin class-name">source</span> /etc/profile</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 配置</span></span>
<span class="line"><span class="token builtin class-name">cd</span> /opt/koko-v2.12.0</span>
<span class="line"><span class="token function">cp</span> config_example.yml config.yml</span>
<span class="line"></span>
<span class="line"><span class="token function">cat</span> <span class="token operator">&gt;</span> config.yml <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="line">CORE_HOST: http://127.0.0.1:8080</span>
<span class="line">BOOTSTRAP_TOKEN: &quot;<span class="token variable">$BOOTSTRAP_TOKEN</span>&quot;</span>
<span class="line">BIND_HOST: 0.0.0.0</span>
<span class="line">SSHD_PORT: 2222</span>
<span class="line">HTTPD_PORT: 5000</span>
<span class="line">LOG_LEVEL: DEBUG</span>
<span class="line">EOF</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启动</span></span>
<span class="line">./koko <span class="token parameter variable">-f</span> config.yml <span class="token parameter variable">-d</span></span>
<span class="line"><span class="token function">netstat</span> <span class="token parameter variable">-tunlp</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-E</span> <span class="token string">&#39;(5000|2222)&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-lion-vnc-服务部署" tabindex="-1"><a class="header-anchor" href="#_6-lion-vnc-服务部署"><span>6. Lion VNC 服务部署</span></a></h2><h3 id="guacamole-安装" tabindex="-1"><a class="header-anchor" href="#guacamole-安装"><span>Guacamole 安装</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">yum <span class="token parameter variable">-y</span> <span class="token function">install</span> cairo-devel libjpeg-devel libpng-devel uuid-devel</span>
<span class="line"></span>
<span class="line"><span class="token function">mkdir</span> /opt/guacamole-v2.12.0</span>
<span class="line"><span class="token builtin class-name">cd</span> /opt/guacamole-v2.12.0</span>
<span class="line"><span class="token function">wget</span> http://download.jumpserver.org/public/guacamole-server-1.3.0.tar.gz</span>
<span class="line"><span class="token function">tar</span> <span class="token parameter variable">-xzf</span> guacamole-server-1.3.0.tar.gz</span>
<span class="line"><span class="token builtin class-name">cd</span> guacamole-server-1.3.0/</span>
<span class="line"></span>
<span class="line">./configure --with-init-dir<span class="token operator">=</span>/etc/init.d</span>
<span class="line"><span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span></span>
<span class="line">ldconfig</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="lion-安装与配置" tabindex="-1"><a class="header-anchor" href="#lion-安装与配置"><span>Lion 安装与配置</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token builtin class-name">cd</span> /opt</span>
<span class="line"><span class="token function">wget</span> https://github.com/jumpserver/lion-release/releases/download/v2.12.0/lion-v2.12.0-linux-amd64.tar.gz</span>
<span class="line"><span class="token function">tar</span> <span class="token parameter variable">-xf</span> lion-v2.12.0-linux-amd64.tar.gz</span>
<span class="line"><span class="token builtin class-name">cd</span> lion-v2.12.0-linux-amd64</span>
<span class="line"></span>
<span class="line"><span class="token function">cp</span> config_example.yml config.yml</span>
<span class="line"></span>
<span class="line"><span class="token function">cat</span> <span class="token operator">&gt;</span> config.yml <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="line">CORE_HOST: http://127.0.0.1:8080</span>
<span class="line">BOOTSTRAP_TOKEN: &quot;<span class="token variable">$BOOTSTRAP_TOKEN</span>&quot;</span>
<span class="line">BIND_HOST: 0.0.0.0</span>
<span class="line">HTTPD_PORT: 8081</span>
<span class="line">LOG_LEVEL: DEBUG</span>
<span class="line">EOF</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启动服务</span></span>
<span class="line">/etc/init.d/guacd start</span>
<span class="line"><span class="token function">nohup</span> ./lion <span class="token parameter variable">-f</span> config.yml <span class="token operator">&amp;</span></span>
<span class="line"><span class="token function">netstat</span> <span class="token parameter variable">-tunlp</span> <span class="token operator">|</span> <span class="token function">grep</span> lion</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-nginx-整合配置" tabindex="-1"><a class="header-anchor" href="#_7-nginx-整合配置"><span>7. Nginx 整合配置</span></a></h2><h3 id="nginx-安装" tabindex="-1"><a class="header-anchor" href="#nginx-安装"><span>Nginx 安装</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/yum.repos.d/nginx.repo <span class="token operator">&lt;&lt;</span><span class="token string">EOF</span>
<span class="line">[nginx-stable]</span>
<span class="line">name=nginx stable repo</span>
<span class="line">baseurl=http://nginx.org/packages/centos/\<span class="token variable">$releasever</span>/\<span class="token variable">$basearch</span>/</span>
<span class="line">gpgcheck=1</span>
<span class="line">enabled=1</span>
<span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span>
<span class="line">EOF</span></span>
<span class="line"></span>
<span class="line">yum <span class="token function">install</span> nginx <span class="token parameter variable">-y</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="主机名解析" tabindex="-1"><a class="header-anchor" href="#主机名解析"><span>主机名解析</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token builtin class-name">echo</span> <span class="token string">&quot;10.0.0.61 luna lina core lion koko&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/hosts</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="nginx-配置文件" tabindex="-1"><a class="header-anchor" href="#nginx-配置文件"><span>Nginx 配置文件</span></a></h3><div class="language-nginx line-numbers-mode" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line"><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">listen</span> <span class="token number">80</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token directive"><span class="token keyword">client_max_body_size</span> <span class="token number">5000m</span></span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /luna/</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://luna:4200</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /media/replay/</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">add_header</span> Content-Encoding gzip</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">root</span> /opt/jumpserver-v2.12.0/data/</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /media/</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">root</span> /opt/jumpserver-v2.12.0/data/</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /static/</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">root</span> /opt/jumpserver-v2.12.0/data/</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /koko/</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://koko:5000</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_buffering</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;upgrade&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /lion/</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://lion:8081</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_buffering</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_request_buffering</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token variable">$http_connection</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_ignore_client_abort</span> <span class="token boolean">on</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_connect_timeout</span> <span class="token number">600</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_send_timeout</span> <span class="token number">600</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_read_timeout</span> <span class="token number">600</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">send_timeout</span> <span class="token number">6000</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /ws/</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://core:8070</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_http_version</span> 1.1</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_buffering</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;upgrade&quot;</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /api/</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://core:8080</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /core/</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://core:8080</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /ui/</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_pass</span> http://lina:9528</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Real-IP <span class="token variable">$remote_addr</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> Host <span class="token variable">$host</span></span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">proxy_set_header</span> X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span></span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    </span>
<span class="line">    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token directive"><span class="token keyword">rewrite</span> ^/(.*)$ /ui/<span class="token variable">$1</span> last</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="重启-nginx" tabindex="-1"><a class="header-anchor" href="#重启-nginx"><span>重启 Nginx</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line">nginx <span class="token parameter variable">-t</span></span>
<span class="line">systemctl restart nginx</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-访问与验证" tabindex="-1"><a class="header-anchor" href="#_8-访问与验证"><span>8. 访问与验证</span></a></h2><h3 id="访问地址" tabindex="-1"><a class="header-anchor" href="#访问地址"><span>访问地址</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">http://10.0.0.61</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="默认登录信息" tabindex="-1"><a class="header-anchor" href="#默认登录信息"><span>默认登录信息</span></a></h3><ul><li>用户名：admin</li><li>密码：admin（首次登录后需修改）</li></ul><h3 id="组件端口验证" tabindex="-1"><a class="header-anchor" href="#组件端口验证"><span>组件端口验证</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Core 后端</span></span>
<span class="line"><span class="token function">netstat</span> <span class="token parameter variable">-tunlp</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-E</span> <span class="token string">&#39;8080|8070|5555&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Lina 前端</span></span>
<span class="line"><span class="token function">netstat</span> <span class="token parameter variable">-tunlp</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">9528</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Luna 前端</span></span>
<span class="line"><span class="token function">netstat</span> <span class="token parameter variable">-tunlp</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">4200</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Koko</span></span>
<span class="line"><span class="token function">netstat</span> <span class="token parameter variable">-tunlp</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-E</span> <span class="token string">&#39;5000|2222&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># Lion</span></span>
<span class="line"><span class="token function">netstat</span> <span class="token parameter variable">-tunlp</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token number">8081</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9-重启后的启动顺序" tabindex="-1"><a class="header-anchor" href="#_9-重启后的启动顺序"><span>9. 重启后的启动顺序</span></a></h2><p>如果服务器重启，需要按以下顺序启动服务：</p><ol><li><p><strong>数据库服务器 (db-51)</strong></p><p>bash</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">systemctl start mysqld</span>
<span class="line">systemctl start redis</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>管理服务器 (master-61)</strong></p><p>bash</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"># Core 后端</span>
<span class="line">source /opt/venv_py3/bin/activate</span>
<span class="line">cd /opt/jumpserver-v2.12.0</span>
<span class="line">./jms start all -d</span>
<span class="line">deactivate</span>
<span class="line"></span>
<span class="line"># Lina 前端</span>
<span class="line">cd /opt/lina-v2.12.0</span>
<span class="line">nohup yarn serve &amp;</span>
<span class="line"></span>
<span class="line"># Luna 前端</span>
<span class="line">cd /opt/luna-v2.12.0</span>
<span class="line">nohup ng serve --proxy-config proxy.conf.json --host 0.0.0.0 &amp;</span>
<span class="line"></span>
<span class="line"># Koko</span>
<span class="line">cd /opt/koko-v2.12.0</span>
<span class="line">./koko -f config.yml -d</span>
<span class="line"></span>
<span class="line"># Lion</span>
<span class="line">/etc/init.d/guacd start</span>
<span class="line">cd /opt/lion-v2.12.0-linux-amd64</span>
<span class="line">nohup ./lion -f config.yml &amp;</span>
<span class="line"></span>
<span class="line"># Nginx</span>
<span class="line">systemctl restart nginx</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h2 id="部署要点总结" tabindex="-1"><a class="header-anchor" href="#部署要点总结"><span>部署要点总结</span></a></h2><ol><li><strong>组件分离</strong>：数据库、Redis 与核心服务分离部署，提高系统稳定性</li><li><strong>虚拟环境</strong>：Python 项目使用虚拟环境隔离依赖</li><li><strong>端口管理</strong>：各组件使用不同端口，通过 Nginx 统一代理</li><li><strong>服务注册</strong>：首次启动需要生成并配置密钥，组件间通过 Token 认证</li><li><strong>依赖管理</strong>：Python 使用 pip，Node.js 使用 yarn/npm，确保依赖版本正确</li><li><strong>配置文件</strong>：所有组件都有配置文件，注意 YAML 格式和变量引用</li><li><strong>启动顺序</strong>：数据库 → Core → 前端 → 代理组件 → Nginx</li></ol><p>这个部署过程涉及多种技术栈（Python、Node.js、Golang、Nginx、MySQL、Redis），是典型的现代化 Web 应用部署案例。每个步骤都需要仔细检查，特别是配置文件格式和依赖版本。</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav" aria-label="page navigation"><!----><a class="route-link auto-link next" href="/10-%E5%A0%A1%E5%9E%92%E6%9C%BA%E8%BF%90%E7%BB%B4/01-%E5%A0%A1%E5%9E%92%E6%9C%BA%E8%BF%90%E7%BB%B4/%E5%A0%A1%E5%9E%92%E6%9C%BA%E5%BA%94%E7%94%A8%E5%AE%9E%E8%B7%B5.html" aria-label="堡垒机应用实践"><!--[--><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span class="external-link">堡垒机应用实践</span></div><!--]--></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DtXLoKBz.js" defer></script>
  </body>
</html>
